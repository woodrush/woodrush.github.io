<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>LambdaLisp - A Lisp Interpreter That Runs on Lambda Calculus | Woodrush’s Blog</title>
<meta name="generator" content="Jekyll v4.2.2" />
<meta property="og:title" content="LambdaLisp - A Lisp Interpreter That Runs on Lambda Calculus" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="A Lisp interpreter written as an untyped lambda calculus term" />
<meta property="og:description" content="A Lisp interpreter written as an untyped lambda calculus term" />
<link rel="canonical" href="https://woodrush.github.io/blog/lambdalisp.html" />
<meta property="og:url" content="https://woodrush.github.io/blog/lambdalisp.html" />
<meta property="og:site_name" content="Woodrush’s Blog" />
<meta property="og:image" content="https://woodrush.github.io/blog/assets/posts/2022-09-17/lambdalisp.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-09-17T23:00:00+09:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="https://woodrush.github.io/blog/assets/posts/2022-09-17/lambdalisp.png" />
<meta property="twitter:title" content="LambdaLisp - A Lisp Interpreter That Runs on Lambda Calculus" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-09-17T23:00:00+09:00","datePublished":"2022-09-17T23:00:00+09:00","description":"A Lisp interpreter written as an untyped lambda calculus term","headline":"LambdaLisp - A Lisp Interpreter That Runs on Lambda Calculus","image":"https://woodrush.github.io/blog/assets/posts/2022-09-17/lambdalisp.png","mainEntityOfPage":{"@type":"WebPage","@id":"https://woodrush.github.io/blog/lambdalisp.html"},"url":"https://woodrush.github.io/blog/lambdalisp.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/blog/assets/css/main.css">
  
    
    <link rel="stylesheet" href="/blog/assets/css/syntax-highlight.css">
    
  <link type="application/atom+xml" rel="alternate" href="https://woodrush.github.io/blog/feed.xml" title="Woodrush&apos;s Blog" />
  <!--KaTeX-->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js" integrity="sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4" crossorigin="anonymous"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js" integrity="sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC+Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa" crossorigin="anonymous"></script>
  <script>
      document.addEventListener("DOMContentLoaded", function() {
          renderMathInElement(document.body, {
          });
      });
  </script>
  
</head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/blog/">Woodrush&#39;s Blog</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>


        <div class="trigger">
          <a class="page-link" href="https://woodrush.github.io/">Home</a>
        </div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">LambdaLisp - A Lisp Interpreter That Runs on Lambda Calculus</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2022-09-17T23:00:00+09:00" itemprop="datePublished">Sep 17, 2022
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <div align="center">
<a href="/blog/assets/posts/2022-09-17/lambdalisp_logo.png">
  <img src="/blog/assets/posts/2022-09-17/lambdalisp_logo.png" alt="LambdaLisp - A Lisp Interpreter Written as an Untyped Lambda Calculus Term" style="margin-bottom: 50px; margin-top: 50px;" />
</a>
</div>
<p><br />
<a href="https://github.com/woodrush/lambdalisp/actions/workflows/test.yml"><img src="https://github.com/woodrush/lambdalisp/actions/workflows/test.yml/badge.svg?branch=main" alt="test" /></a></p>

<p>LambdaLisp is a Lisp interpreter written as an untyped lambda calculus term.
The input and output text is encoded into closed lambda terms using the <a href="https://en.wikipedia.org/wiki/Mogensen%E2%80%93Scott_encoding">Mogensen-Scott encoding</a>, so the entire computation process solely consists of the beta-reduction of lambda calculus terms.</p>

<p>When run on a lambda calculus interpreter that runs on the terminal, it presents a REPL where you can interactively define and evaluate Lisp expressions. Supported interpreters are:</p>

<ul>
  <li>The <a href="https://justine.lol/lambda/">521-byte lambda calculus interpreter</a> SectorLambda written by Justine Tunney</li>
  <li>The <a href="https://www.ioccc.org/">IOCCC</a> 2012 <a href="https://www.ioccc.org/2012/tromp/hint.html">“Most functional”</a> interpreter written by John Tromp
(the <a href="https://www.ioccc.org/2012/tromp/tromp.c">source</a> is in the shape of a λ)</li>
  <li>Universal Lambda interpreter <a href="https://github.com/irori/clamb">clamb</a> and Lazy K interpreter <a href="https://github.com/irori/lazyk">lazyk</a> written by Kunihiko Sakamoto</li>
</ul>

<p>Supported features are:</p>

<ul>
  <li>Signed 32-bit integers</li>
  <li>Strings</li>
  <li>Closures, lexical scopes, and persistent bindings with <code class="language-html highlighter-rouge">let</code></li>
  <li>Object-oriented programming feature with class inheritance</li>
  <li>Reader macros with <code class="language-html highlighter-rouge">set-macro-character</code></li>
  <li>Access to the interpreter’s virtual heap memory with <code class="language-html highlighter-rouge">malloc</code>, <code class="language-html highlighter-rouge">memread</code>, and <code class="language-html highlighter-rouge">memwrite</code></li>
  <li>Show the call stack trace when an error is invoked</li>
  <li>Garbage collection during macro evaluation</li>
</ul>

<p>and much more.</p>

<p>LambdaLisp can be used to write interactive programs.
Execution speed is fast as well, and the <a href="https://github.com/woodrush/lambdalisp/blob/main/examples/number-guessing-game.cl">number guessing game</a> runs on the terminal with an almost instantaneous response speed.</p>

<p>Here is a PDF showing its entire lambda term, which is 42 pages long:</p>

<div class="pdf_preview">
  <object type="application/pdf" data="https://woodrush.github.io/lambdalisp.pdf" width="100%" height="500px">
  </object>
</div>

<p><span class="pdf_no_preview">The embedded PDF may not show on mobile.</span>
The same PDF is also available at <a href="https://woodrush.github.io/lambdalisp.pdf">https://woodrush.github.io/lambdalisp.pdf</a>.</p>

<p>Page 32 is particulary interesting, consisting entirely of <code class="language-html highlighter-rouge">(</code>s:</p>

<p><a href="/blog/assets/posts/2022-09-17/pdf_32.png"><img src="/blog/assets/posts/2022-09-17/pdf_32.png" alt="p.32 of lambdalisp.pdf." /></a></p>

<h2 class="no_toc" id="overview">Overview</h2>

<p>LambdaLisp is a Lisp interpreter written as a closed untyped lambda calculus term.
It is written as a lambda calculus term <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mi mathvariant="normal">L</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">m</mi><mi mathvariant="normal">b</mi><mi mathvariant="normal">d</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">L</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">s</mi><mi mathvariant="normal">p</mi></mrow><mo>=</mo><mi>λ</mi><mi>x</mi><mi mathvariant="normal">.</mi><mo>⋯</mo></mrow><annotation encoding="application/x-tex">{\rm LambdaLisp} = \lambda x. \cdots</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">LambdaLisp</span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">λ</span><span class="mord mathnormal">x</span><span class="mord">.</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner">⋯</span></span></span></span>
which takes a string <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span> as an input and returns a string as an output.
The input <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span> is the Lisp program and the user’s standard input,
and the output is the standard output.
Characters are encoded into lambda term representations of natural numbers using the <a href="https://en.wikipedia.org/wiki/Church_encoding">Church encoding</a>,
and strings are encoded as a list of characters with lists expressed as lambdas in the <a href="https://en.wikipedia.org/wiki/Mogensen%E2%80%93Scott_encoding">Mogensen-Scott encoding</a>,
so the entire computation process solely consists of the beta-reduction of lambda terms,
without introducing any non-lambda-type object.
In this sense, LambdaLisp operates on a “truly purely functional language” without any primitive data types except for lambda terms.</p>

<p>Supported features are closures and persistent bindings with <code class="language-html highlighter-rouge">let</code>, reader macros, 32-bit signed integers, a built-in object-oriented programming feature based on closures, and much more.
LambdaLisp is tested by running code on both Common Lisp and LambdaLisp and comparing their outputs.
The largest LambdaLisp-Common-Lisp polyglot program that has been tested is <a href="https://github.com/woodrush/lambdalisp/blob/main/examples/lambdacraft.cl">lambdacraft.cl</a>,
which runs the Lisp-to-lambda-calculus compiler <a href="https://github.com/woodrush/lambdacraft">LambdaCraft</a> I wrote for this project, also used to compile LambdaLisp itself.</p>

<p>When run on a lambda calculus interpreter that runs on the terminal,
LambdaLisp presents a REPL where you can interactively define and evaluate Lisp expressions.
These interpreters automatically process the string-to-lambda encoding for handling I/O through the terminal.</p>

<p>Lisp has been described by Alan Kay as the <a href="https://www.gnu.org/software/mes/manual/html_node/LISP-as-Maxwell_0027s-Equations-of-Software.html">Maxwell’s equations of software</a>.
In the same sense, I believe that lambda calculus is the particle physics of computation.
LambdaLisp may therefore be a gigantic electromagnetic <a href="https://en.wikipedia.org/wiki/Mathematical_formulation_of_the_Standard_Model">Lagrangian</a> that connects the realm of human-friendly programming to the origins of the notion of computation itself.</p>

<h2 class="no_toc" id="usage">Usage</h2>

<p>LambdaLisp is available on GitHub at <a href="https://github.com/woodrush/lambdalisp">https://github.com/woodrush/lambdalisp</a>.
Here we will explain how to try LambdaLisp right away on x86-64-Linux and other platforms such as Mac.</p>

<h3 class="no_toc" id="running-the-lambdalisp-repl-on-x86-64-linux">Running the LambdaLisp REPL (on x86-64-Linux)</h3>
<p>You can try the LambdaLisp REPL on x86-64-Linux by simply running:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="syntax"><code>git clone https://github.com/woodrush/lambdalisp
<span class="nb">cd </span>lambdalisp
make run-repl
</code></pre></div></div>
<p>The requirement is <code class="language-html highlighter-rouge">cc</code> which should be installed by default.
To try it on a Mac, please see the next section.</p>

<p>This will run LambdaLisp on SectorLambda, the <a href="https://justine.lol/lambda/">521-byte lambda calculus interpreter</a>.
The source code being run is <a href="https://github.com/woodrush/lambdalisp/blob/main/bin/lambdalisp.blc">lambdalisp.blc</a>,
which is the lambda calculus term shown in <a href="https://woodrush.github.io/lambdalisp.pdf">lambdalisp.pdf</a> written in <a href="https://tromp.github.io/cl/Binary_lambda_calculus.html">binary lambda calculus</a> notation.</p>

<p>SectorLambda automatically takes care of the string-to-lambda I/O encoding to run LambdaLisp on the terminal.
Interaction is done by writing LambdaLisp in continuation-passing style,
allowing a Haskell-style interactive I/O to work on lambda calculus interpreters.</p>

<p>When building SectorLambda, Make runs the following commands to get its source codes:</p>

<ul>
  <li><code class="language-html highlighter-rouge">Blc.S</code>: <code class="language-html highlighter-rouge">wget https://justine.lol/lambda/Blc.S?v=2</code></li>
  <li><code class="language-html highlighter-rouge">flat.lds</code>: <code class="language-html highlighter-rouge">wget https://justine.lol/lambda/flat.lds</code></li>
</ul>

<p>After running <code class="language-html highlighter-rouge">make run-repl</code>, the REPL can also be run as:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="syntax"><code><span class="o">(</span> <span class="nb">cat</span> ./bin/lambdalisp.blc | ./bin/asc2bin<span class="p">;</span> <span class="nb">cat</span> <span class="o">)</span> | ./bin/Blc
</code></pre></div></div>

<h3 class="no_toc" id="running-the-lambdalisp-repl-on-other-platforms">Running the LambdaLisp REPL (on Other Platforms)</h3>

<p>SectorLambda is x86-64-Linux exclusive. On other platforms such as a Mac, the following command can be used:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="syntax"><code>git clone https://github.com/woodrush/lambdalisp
<span class="nb">cd </span>lambdalisp
make run-repl-ulamb
</code></pre></div></div>
<p>This runs LambdaLisp on the lambda calculus interpreter <code class="language-html highlighter-rouge">clamb</code>.
The requirement for this is <code class="language-html highlighter-rouge">gcc</code> or <code class="language-html highlighter-rouge">cc</code>.</p>

<p>After running <code class="language-html highlighter-rouge">make run-repl-ulamb</code>, the REPL can also be run as:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="syntax"><code><span class="o">(</span> <span class="nb">cat</span> ./bin/lambdalisp.ulamb | ./bin/asc2bin<span class="p">;</span> <span class="nb">cat</span> <span class="o">)</span> | ./bin/clamb <span class="nt">-u</span>
</code></pre></div></div>

<p>LambdaLisp supports other various lambda calculus interpreters as well.
For instructions for other interpreters, please see the <a href="https://github.com/woodrush/lambdalisp">GitHub repo</a>.</p>

<h3 class="no_toc" id="playing-the-number-guessing-game">Playing the Number Guessing Game</h3>

<p>Once <code class="language-html highlighter-rouge">make run-repl</code> is run, you can play the <a href="https://github.com/woodrush/lambdalisp/blob/main/examples/number-guessing-game.cl">number guessing game</a> with:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="syntax"><code><span class="o">(</span> <span class="nb">cat</span> ./bin/lambdalisp.blc | ./bin/asc2bin<span class="p">;</span> <span class="nb">cat</span> ./examples/number-guessing-game.cl<span class="p">;</span> <span class="nb">cat</span> <span class="o">)</span> | ./bin/Blc
</code></pre></div></div>

<p>If you ran <code class="language-html highlighter-rouge">make run-repl-ulamb</code>, you can run:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="syntax"><code><span class="o">(</span> <span class="nb">cat</span> ./bin/lambdalisp.ulamb | ./bin/asc2bin<span class="p">;</span> <span class="nb">cat</span> ./examples/number-guessing-game.cl<span class="p">;</span> <span class="nb">cat</span> <span class="o">)</span> | ./bin/clamb <span class="nt">-u</span>
</code></pre></div></div>

<p>You can run the same script on Common Lisp. If you use SBCL, you can run it with:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="syntax"><code>sbcl <span class="nt">--script</span> ./examples/number-guessing-game.cl
</code></pre></div></div>

<h2 class="no_toc" id="examples">Examples</h2>

<h3 class="no_toc" id="closures">Closures</h3>

<p>The following LambdaLisp code runs right out of the box:</p>

<div class="language-lisp highlighter-rouge"><div class="highlight"><pre class="syntax"><code><span class="p">(</span><span class="nb">defun</span> <span class="nv">new-counter</span> <span class="p">(</span><span class="nv">init</span><span class="p">)</span>
  <span class="c1">;; Return a closure.</span>
  <span class="c1">;; Use the let over lambda technique for creating independent and persistent variables.</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">i</span> <span class="nv">init</span><span class="p">))</span>
    <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span> <span class="p">(</span><span class="k">setq</span> <span class="nv">i</span> <span class="p">(</span><span class="nb">+</span> <span class="mi">1</span> <span class="nv">i</span><span class="p">)))))</span>

<span class="c1">;; Instantiate counters</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">counter1</span> <span class="p">(</span><span class="nv">new-counter</span> <span class="mi">0</span><span class="p">))</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">counter2</span> <span class="p">(</span><span class="nv">new-counter</span> <span class="mi">10</span><span class="p">))</span>

<span class="p">(</span><span class="nb">print</span> <span class="p">(</span><span class="nv">counter1</span><span class="p">))</span> <span class="c1">;; =&gt; 1</span>
<span class="p">(</span><span class="nb">print</span> <span class="p">(</span><span class="nv">counter1</span><span class="p">))</span> <span class="c1">;; =&gt; 2</span>
<span class="p">(</span><span class="nb">print</span> <span class="p">(</span><span class="nv">counter2</span><span class="p">))</span> <span class="c1">;; =&gt; 11</span>
<span class="p">(</span><span class="nb">print</span> <span class="p">(</span><span class="nv">counter1</span><span class="p">))</span> <span class="c1">;; =&gt; 3</span>
<span class="p">(</span><span class="nb">print</span> <span class="p">(</span><span class="nv">counter2</span><span class="p">))</span> <span class="c1">;; =&gt; 12</span>
<span class="p">(</span><span class="nb">print</span> <span class="p">(</span><span class="nv">counter1</span><span class="p">))</span> <span class="c1">;; =&gt; 4</span>
<span class="p">(</span><span class="nb">print</span> <span class="p">(</span><span class="nv">counter1</span><span class="p">))</span> <span class="c1">;; =&gt; 5</span>
</code></pre></div></div>

<p>An equivalent JavaScript code is:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="syntax"><code><span class="c1">// Runs on the browser's console</span>
<span class="kd">function</span> <span class="nx">new_counter</span> <span class="p">(</span><span class="nx">init</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="nx">init</span><span class="p">;</span>
    <span class="k">return</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="o">++</span><span class="nx">i</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">counter1</span> <span class="o">=</span> <span class="nx">new_counter</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">counter2</span> <span class="o">=</span> <span class="nx">new_counter</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">counter1</span><span class="p">());</span> <span class="c1">// =&gt; 1</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">counter1</span><span class="p">());</span> <span class="c1">// =&gt; 2</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">counter2</span><span class="p">());</span> <span class="c1">// =&gt; 11</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">counter1</span><span class="p">());</span> <span class="c1">// =&gt; 3</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">counter2</span><span class="p">());</span> <span class="c1">// =&gt; 12</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">counter1</span><span class="p">());</span> <span class="c1">// =&gt; 4</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">counter1</span><span class="p">());</span> <span class="c1">// =&gt; 5</span>
</code></pre></div></div>

<h3 class="no_toc" id="object-oriented-programming-with-class-inheritance">Object-Oriented Programming With Class Inheritance</h3>

<p>As described in <a href="https://letoverlambda.com/">Let Over Lambda</a>,
when you have closures, you get object-oriented programming for free.
LambdaLisp has a built-in OOP feature implemented as predefined macros based on closures.
It supports Python-like classes with class inheritance:</p>

<div class="language-lisp highlighter-rouge"><div class="highlight"><pre class="syntax"><code><span class="c1">;; Runs on LambdaLisp</span>
<span class="p">(</span><span class="nb">defclass</span> <span class="nv">Counter</span> <span class="p">()</span>
  <span class="p">(</span><span class="nv">i</span> <span class="mi">0</span><span class="p">)</span>

  <span class="p">(</span><span class="nb">defmethod</span> <span class="nv">inc</span> <span class="p">()</span>
    <span class="p">(</span><span class="nb">setf</span> <span class="p">(</span><span class="o">.</span> <span class="nv">self</span> <span class="nv">i</span><span class="p">)</span> <span class="p">(</span><span class="nb">+</span> <span class="mi">1</span> <span class="p">(</span><span class="o">.</span> <span class="nv">self</span> <span class="nv">i</span><span class="p">))))</span>

  <span class="p">(</span><span class="nb">defmethod</span> <span class="nv">dec</span> <span class="p">()</span>
    <span class="p">(</span><span class="nb">setf</span> <span class="p">(</span><span class="o">.</span> <span class="nv">self</span> <span class="nv">i</span><span class="p">)</span> <span class="p">(</span><span class="nb">-</span> <span class="p">(</span><span class="o">.</span> <span class="nv">self</span> <span class="nv">i</span><span class="p">)</span> <span class="mi">1</span><span class="p">))))</span>


<span class="p">(</span><span class="nb">defclass</span> <span class="nv">Counter-add</span> <span class="p">(</span><span class="nv">Counter</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">defmethod</span> <span class="nv">*init</span> <span class="p">(</span><span class="nv">i</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">setf</span> <span class="p">(</span><span class="o">.</span> <span class="nv">self</span> <span class="nv">i</span><span class="p">)</span> <span class="nv">i</span><span class="p">))</span>

  <span class="p">(</span><span class="nb">defmethod</span> <span class="nv">add</span> <span class="p">(</span><span class="nv">n</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">setf</span> <span class="p">(</span><span class="o">.</span> <span class="nv">self</span> <span class="nv">i</span><span class="p">)</span> <span class="p">(</span><span class="nb">+</span> <span class="p">(</span><span class="o">.</span> <span class="nv">self</span> <span class="nv">i</span><span class="p">)</span> <span class="nv">n</span><span class="p">))))</span>


<span class="p">(</span><span class="nb">defparameter</span> <span class="nv">counter1</span> <span class="p">(</span><span class="nv">new</span> <span class="nv">Counter</span><span class="p">))</span>
<span class="p">(</span><span class="nb">defparameter</span> <span class="nv">counter2</span> <span class="p">(</span><span class="nv">new</span> <span class="nv">Counter-add</span> <span class="mi">100</span><span class="p">))</span>

<span class="p">((</span><span class="o">.</span> <span class="nv">counter1</span> <span class="nv">inc</span><span class="p">))</span>
<span class="p">((</span><span class="o">.</span> <span class="nv">counter2</span> <span class="nv">add</span><span class="p">)</span> <span class="mi">100</span><span class="p">)</span>

<span class="p">(</span><span class="nb">setf</span> <span class="p">(</span><span class="o">.</span> <span class="nv">counter1</span> <span class="nv">i</span><span class="p">)</span> <span class="mi">5</span><span class="p">)</span>
<span class="p">(</span><span class="nb">setf</span> <span class="p">(</span><span class="o">.</span> <span class="nv">counter2</span> <span class="nv">i</span><span class="p">)</span> <span class="mi">500</span><span class="p">)</span>
</code></pre></div></div>

<p>An equivalent Python code is:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="syntax"><code><span class="k">class</span> <span class="nc">Counter</span> <span class="p">():</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">inc</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">i</span>
    
    <span class="k">def</span> <span class="nf">dec</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">i</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">i</span>

<span class="k">class</span> <span class="nc">Counter_add</span> <span class="p">(</span><span class="n">Counter</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">i</span> <span class="o">=</span> <span class="n">i</span>
    
    <span class="k">def</span> <span class="nf">add</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">i</span> <span class="o">+=</span> <span class="n">n</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">i</span>

<span class="n">counter1</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
<span class="n">counter2</span> <span class="o">=</span> <span class="n">Counter_add</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>

<span class="n">counter1</span><span class="p">.</span><span class="n">inc</span><span class="p">()</span>
<span class="n">counter2</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>

<span class="n">counter1</span><span class="p">.</span><span class="n">i</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">counter2</span><span class="p">.</span><span class="n">i</span> <span class="o">=</span> <span class="mi">500</span>
</code></pre></div></div>

<h3 class="no_toc" id="more-examples">More Examples</h3>

<p>More examples can be found in the <a href="https://github.com/woodrush/lambdalisp">GitHub repo</a>.
The largest LambdaLisp program currently written is <a href="https://github.com/woodrush/lambdalisp/blob/main/examples/lambdacraft.cl">lambdacraft.cl</a>,
which runs the lambda calculus compiler <a href="https://github.com/woodrush/lambdacraft">LambdaCraft</a> I wrote for this project, also used to compile LambdaLisp itself.</p>

<h2 class="no_toc" id="features">Features</h2>

<p>Key features are:</p>

<ul>
  <li>Signed 32-bit integers</li>
  <li>Strings</li>
  <li>Closures, lexical scopes, and persistent bindings with <code class="language-html highlighter-rouge">let</code></li>
  <li>Object-oriented programming feature with class inheritance</li>
  <li>Reader macros with <code class="language-html highlighter-rouge">set-macro-character</code></li>
  <li>Access to the interpreter’s virtual heap memory with <code class="language-html highlighter-rouge">malloc</code>, <code class="language-html highlighter-rouge">memread</code>, and <code class="language-html highlighter-rouge">memwrite</code></li>
  <li>Show the call stack trace when an error is invoked</li>
  <li>Garbage collection during macro evaluation</li>
</ul>

<p>Supported special forms and functions are:</p>

<ul>
  <li>defun, defmacro, lambda (&amp;rest can be used)</li>
  <li>quote, atom, car, cdr, cons, eq</li>
  <li>+, -, *, /, mod, =, &gt;, &lt;, &gt;=, &lt;=, integerp</li>
  <li>read (reads Lisp expressions), print, format (supports <code class="language-html highlighter-rouge">~a</code> and <code class="language-html highlighter-rouge">~%</code>), write-to-string, intern, stringp</li>
  <li>let, let*, labels, setq, boundp</li>
  <li>progn, loop, block, return, return-from, if, cond, error</li>
  <li>list, append, reverse, length, position, mapcar</li>
  <li>make-hash-table, gethash (setf can be used)</li>
  <li>equal, and, or, not</li>
  <li>eval, apply</li>
  <li>set-macro-character, peek-char, read-char, <code class="language-html highlighter-rouge">`</code>   <code class="language-html highlighter-rouge">,</code>   <code class="language-html highlighter-rouge">,@</code>   <code class="language-html highlighter-rouge">'</code>   <code class="language-html highlighter-rouge">#\</code></li>
  <li>carstr, cdrstr, str, string comparison with =, &gt;, &lt;, &gt;=, &lt;=, string concatenation with +</li>
  <li>defun-local, defglobal, type, macro</li>
  <li>malloc, memread, memwrite</li>
  <li>new, defclass, defmethod, <code class="language-html highlighter-rouge">.</code>, field assignment by setf</li>
</ul>

<h2 class="no_toc" id="tests">Tests</h2>

<p>There are 2 types of tests written for LambdaLisp. The GitHub Actions CI runs these tests.</p>

<h3 class="no_toc" id="output-comparison-test">Output Comparison Test</h3>

<p>The files <code class="language-html highlighter-rouge">examples/*.cl</code> run both on Common Lisp and LambdaLisp producing identical results, except for the initial <code class="language-html highlighter-rouge">&gt; </code>   printed by the REPL in LambdaLisp. This test first runs <code class="language-html highlighter-rouge">*.cl</code> on both SBCL and LambdaLisp and compares their outputs.</p>

<p>The files <code class="language-html highlighter-rouge">examples/*.lisp</code> are LambdaLisp-exclusive programs. The output of these files are compared with <code class="language-html highlighter-rouge">test/*.lisp.out</code>.</p>

<h3 class="no_toc" id="lambdacraft-compiler-hosting-test">LambdaCraft Compiler Hosting Test</h3>

<p><code class="language-html highlighter-rouge">examples/lambdacraft.cl</code> runs LambdaCraft, a Common-Lisp-to-lambda-calculus compiler written in Common Lisp,
used to compile the lambda calculus source for LambdaLisp.
The script defines a binary lambda calculus (BLC) program that prints the letter <code class="language-html highlighter-rouge">A</code> and exits,
and prints the BLC source code for the defined program.</p>

<p>The LambdaCraft compiler hosting test first executes <code class="language-html highlighter-rouge">examples/lambdacraft.cl</code> on LambdaLisp, then runs the output BLC program on a BLC interpreter, and checks if it prints the letter <code class="language-html highlighter-rouge">A</code> and exits.</p>

<h3 class="no_toc" id="experimental-self-hosting-test">Experimental: Self-Hosting Test</h3>

<p>This test is currently theoretical since it requires a lot of time and memory, and is unused in <code class="language-html highlighter-rouge">make test-all</code>.
This test extends the previous LambdaCraft compiler hosting test and checks if the Common Lisp source code for LambdaLisp runs on LambdaLisp itself. Since the LambdaCraft compiler hosting test runs properly, this test should theoretically run as well, although it requires a tremendous amount of memory and time. The test is run on the binary lambda calculus interpreter Blc.</p>

<p>One concern is whether the 32-bit heap address space used internally in LambdaLisp is enough to compile this program. This can be solved by compiling LambdaLisp with an address space of 64-bit or larger, which can be done simply by replacing the literal <code class="language-html highlighter-rouge">32</code> (which only appears once in <code class="language-html highlighter-rouge">src/lambdalisp.cl</code>) with <code class="language-html highlighter-rouge">64</code>, etc.
Another concern is whether if the execution hits Blc’s maximum term limit. This can be solved by compiling Blc with a larger memory limit, by editing the rule for <code class="language-html highlighter-rouge">$(BLC)</code> in the Makefile.</p>

<h2 class="no_toc" id="how-it-works---lambdalisp-implementation-details">How it Works - LambdaLisp Implementation Details</h2>

<p>Here we will explain LambdaLisp’s implementation details.
Below is a table of contents:</p>

<ul id="markdown-toc">
  <li><a href="#general-lambda-calculus-programming" id="markdown-toc-general-lambda-calculus-programming">General Lambda Calculus Programming</a>    <ul>
      <li><a href="#handling-io-in-lambda-calculus" id="markdown-toc-handling-io-in-lambda-calculus">Handling I/O in Lambda Calculus</a></li>
      <li><a href="#lambda-calculus-based-programming-languages" id="markdown-toc-lambda-calculus-based-programming-languages">Lambda-Calculus-Based Programming Languages</a></li>
      <li><a href="#lazy-k" id="markdown-toc-lazy-k">Lazy K</a></li>
      <li><a href="#interactive-io-in-lambda-calculus-based-languages" id="markdown-toc-interactive-io-in-lambda-calculus-based-languages">Interactive I/O in Lambda-Calculus-Based Languages</a></li>
    </ul>
  </li>
  <li><a href="#lambdalisp-implementation-details" id="markdown-toc-lambdalisp-implementation-details">LambdaLisp Implementation Details</a>    <ul>
      <li><a href="#the-core-implementation-strategy" id="markdown-toc-the-core-implementation-strategy">The Core Implementation Strategy</a></li>
      <li><a href="#the-startup-phase---a-primitive-form-of-asynchronous-programming" id="markdown-toc-the-startup-phase---a-primitive-form-of-asynchronous-programming">The Startup Phase - A Primitive Form of Asynchronous Programming</a></li>
      <li><a href="#the-basic-evaluation-loop" id="markdown-toc-the-basic-evaluation-loop">The Basic Evaluation Loop</a></li>
      <li><a href="#basic-data-structures" id="markdown-toc-basic-data-structures">Basic Data Structures</a></li>
      <li><a href="#virtual-heap-memory-ram" id="markdown-toc-virtual-heap-memory-ram">Virtual Heap Memory (RAM)</a></li>
      <li><a href="#registers-global-variables" id="markdown-toc-registers-global-variables">Registers (Global Variables)</a></li>
      <li><a href="#the-prelude-generator-and-string-compression" id="markdown-toc-the-prelude-generator-and-string-compression">The Prelude Generator and String Compression</a></li>
    </ul>
  </li>
  <li><a href="#language-features" id="markdown-toc-language-features">Language Features</a>    <ul>
      <li><a href="#the-memory-model-for-persistent-bindings" id="markdown-toc-the-memory-model-for-persistent-bindings">The Memory Model for Persistent Bindings</a></li>
      <li><a href="#garbage-collection" id="markdown-toc-garbage-collection">Garbage Collection</a></li>
      <li><a href="#macros" id="markdown-toc-macros">Macros</a></li>
      <li><a href="#object-oriented-programming" id="markdown-toc-object-oriented-programming">Object-Oriented Programming</a></li>
      <li><a href="#blocks" id="markdown-toc-blocks">Blocks</a></li>
      <li><a href="#loops" id="markdown-toc-loops">Loops</a></li>
      <li><a href="#error-invocation-and-stack-traces" id="markdown-toc-error-invocation-and-stack-traces">Error Invocation and Stack Traces</a></li>
    </ul>
  </li>
  <li><a href="#other-general-lambda-calculus-programming-techniques" id="markdown-toc-other-general-lambda-calculus-programming-techniques">Other General Lambda Calculus Programming Techniques</a>    <ul>
      <li><a href="#mutual-recursion" id="markdown-toc-mutual-recursion">Mutual Recursion</a></li>
      <li><a href="#deriving-isnil" id="markdown-toc-deriving-isnil">Deriving ‘isnil’</a></li>
      <li><a href="#lambdacrafts-do-macro" id="markdown-toc-lambdacrafts-do-macro">LambdaCraft’s ‘do’ Macro</a></li>
      <li><a href="#print-debugging" id="markdown-toc-print-debugging">Print Debugging</a></li>
      <li><a href="#type-checking-with-macro-call-signatures" id="markdown-toc-type-checking-with-macro-call-signatures">Type Checking with Macro Call Signatures</a></li>
    </ul>
  </li>
  <li><a href="#appendix" id="markdown-toc-appendix">Appendix</a>    <ul>
      <li><a href="#javascript-examples-of-continuation-passing-style-code" id="markdown-toc-javascript-examples-of-continuation-passing-style-code">JavaScript Examples of Continuation-Passing Style Code</a></li>
      <li><a href="#the-binary-lambda-calculus-notation" id="markdown-toc-the-binary-lambda-calculus-notation">The Binary Lambda Calculus Notation</a></li>
    </ul>
  </li>
  <li><a href="#about-the-logo" id="markdown-toc-about-the-logo">About the Logo</a></li>
  <li><a href="#credits" id="markdown-toc-credits">Credits</a></li>
</ul>

<h2 id="general-lambda-calculus-programming">General Lambda Calculus Programming</h2>
<p>Before introducing LambdaLisp-specific implementation details,
we’ll cover some general topics about programming in lambda calculus.</p>

<h3 id="handling-io-in-lambda-calculus">Handling I/O in Lambda Calculus</h3>
<p>LambdaLisp is written as a function <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mi mathvariant="normal">L</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">m</mi><mi mathvariant="normal">b</mi><mi mathvariant="normal">d</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">L</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">s</mi><mi mathvariant="normal">p</mi></mrow><mo>=</mo><mi>λ</mi><mi>x</mi><mi mathvariant="normal">.</mi><mo>⋯</mo></mrow><annotation encoding="application/x-tex">{\rm LambdaLisp} = \lambda x. \cdots</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">LambdaLisp</span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">λ</span><span class="mord mathnormal">x</span><span class="mord">.</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner">⋯</span></span></span></span>
which takes one string as an input and returns one string as an output.
The input represents the Lisp program and the user’s standard input (the <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span> is the input string),
and the output represents the standard output.
A string is represented as a list of bits of its ASCII representation.
In untyped lambda calculus, a method called the <a href="https://en.wikipedia.org/wiki/Mogensen%E2%80%93Scott_encoding">Mogensen-Scott encoding</a>
can be used to express a list of lambda terms as a pure untyped lambda calculus term, without the help of introducing a non-lambda-type object.</p>

<p>Bits are encoded as:</p>

<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mi>λ</mi><mi>x</mi><mi mathvariant="normal">.</mi><mi>λ</mi><mi>y</mi><mi mathvariant="normal">.</mi><mi>x</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mi>λ</mi><mi>x</mi><mi mathvariant="normal">.</mi><mi>λ</mi><mi>y</mi><mi mathvariant="normal">.</mi><mi>y</mi></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned}
0 &amp;= \lambda x. \lambda y. x \\
1 &amp;= \lambda x. \lambda y. y \\
\end{aligned}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3em;vertical-align:-1.25em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.75em;"><span style="top:-3.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.25em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.75em;"><span style="top:-3.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal">λ</span><span class="mord mathnormal">x</span><span class="mord">.</span><span class="mord mathnormal">λ</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord">.</span><span class="mord mathnormal">x</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal">λ</span><span class="mord mathnormal">x</span><span class="mord">.</span><span class="mord mathnormal">λ</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord">.</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.25em;"><span></span></span></span></span></span></span></span></span></span></span></span>

<p>Lists are made using the list constructor and terminator <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">c</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">s</mi></mrow><annotation encoding="application/x-tex">{\rm cons}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">cons</span></span></span></span></span></span> and <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">n</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">l</mi></mrow><annotation encoding="application/x-tex">{\rm nil}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">nil</span></span></span></span></span></span>:</p>

<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi mathvariant="normal">c</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">s</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mi>λ</mi><mi>x</mi><mi mathvariant="normal">.</mi><mi>λ</mi><mi>y</mi><mi mathvariant="normal">.</mi><mi>λ</mi><mi>f</mi><mi mathvariant="normal">.</mi><mo stretchy="false">(</mo><mi>f</mi><mi>x</mi><mi>y</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi mathvariant="normal">n</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">l</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mi>λ</mi><mi>x</mi><mi mathvariant="normal">.</mi><mi>λ</mi><mi>y</mi><mi mathvariant="normal">.</mi><mi>y</mi></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned}
{\rm cons} &amp;= \lambda x. \lambda y. \lambda f. (f x y) \\
{\rm nil} &amp;= \lambda x. \lambda y. y
\end{aligned}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3em;vertical-align:-1.25em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.75em;"><span style="top:-3.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathrm">cons</span></span></span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathrm">nil</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.25em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.75em;"><span style="top:-3.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal">λ</span><span class="mord mathnormal">x</span><span class="mord">.</span><span class="mord mathnormal">λ</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord">.</span><span class="mord mathnormal">λ</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord">.</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal">x</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal">λ</span><span class="mord mathnormal">x</span><span class="mord">.</span><span class="mord mathnormal">λ</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord">.</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.25em;"><span></span></span></span></span></span></span></span></span></span></span></span>

<p>Note that <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>=</mo><mrow><mi mathvariant="normal">n</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">l</mi></mrow></mrow><annotation encoding="application/x-tex">1 = {\rm nil}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">nil</span></span></span></span></span></span>.
Under these rules, the bit sequence <code class="language-html highlighter-rouge">0101</code> can be expressed as a composition of lambda terms:</p>

<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mo stretchy="false">(</mo><mrow><mi mathvariant="normal">c</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">s</mi></mrow><mtext> </mtext><mn>0</mn><mtext> </mtext><mo stretchy="false">(</mo><mrow><mi mathvariant="normal">c</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">s</mi></mrow><mtext> </mtext><mn>1</mn><mtext> </mtext><mo stretchy="false">(</mo><mrow><mi mathvariant="normal">c</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">s</mi></mrow><mtext> </mtext><mn>0</mn><mtext> </mtext><mo stretchy="false">(</mo><mrow><mi mathvariant="normal">c</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">s</mi></mrow><mtext> </mtext><mn>1</mn><mtext> </mtext><mrow><mi mathvariant="normal">n</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">l</mi></mrow><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">({\rm cons} ~ 0 ~ ({\rm cons} ~ 1 ~ ({\rm cons} ~ 0 ~ ({\rm cons} ~ 1 ~ {\rm nil}))))</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord mathrm">cons</span></span></span><span class="mspace nobreak"> </span><span class="mord">0</span><span class="mspace nobreak"> </span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord mathrm">cons</span></span></span><span class="mspace nobreak"> </span><span class="mord">1</span><span class="mspace nobreak"> </span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord mathrm">cons</span></span></span><span class="mspace nobreak"> </span><span class="mord">0</span><span class="mspace nobreak"> </span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord mathrm">cons</span></span></span><span class="mspace nobreak"> </span><span class="mord">1</span><span class="mspace nobreak"> </span><span class="mord"><span class="mord"><span class="mord mathrm">nil</span></span></span><span class="mclose">))))</span></span></span></span></span>

<p>which is exactly the same as how lists are constructed in Lisp.
This beta-reduces to:</p>

<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>λ</mi><mi>f</mi><mi mathvariant="normal">.</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo stretchy="false">(</mo><mi>f</mi><mo stretchy="false">(</mo><mi>λ</mi><mi>x</mi><mi mathvariant="normal">.</mi><mi>λ</mi><mi>y</mi><mi mathvariant="normal">.</mi><mi>x</mi><mo stretchy="false">)</mo><mi>λ</mi><mi>g</mi><mi mathvariant="normal">.</mi><mo stretchy="false">(</mo><mi>g</mi><mo stretchy="false">(</mo><mi>λ</mi><mi>x</mi><mi mathvariant="normal">.</mi><mi>λ</mi><mi>y</mi><mi mathvariant="normal">.</mi><mi>y</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mi>λ</mi><mi>h</mi><mi mathvariant="normal">.</mi><mo stretchy="false">(</mo><mi>h</mi><mo stretchy="false">(</mo><mi>λ</mi><mi>x</mi><mi mathvariant="normal">.</mi><mi>λ</mi><mi>y</mi><mi mathvariant="normal">.</mi><mi>x</mi><mo stretchy="false">)</mo><mi>λ</mi><mi>i</mi><mi mathvariant="normal">.</mi><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">(</mo><mi>λ</mi><mi>x</mi><mi mathvariant="normal">.</mi><mi>λ</mi><mi>y</mi><mi mathvariant="normal">.</mi><mi>y</mi><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mi>λ</mi><mi>x</mi><mi mathvariant="normal">.</mi><mi>λ</mi><mi>y</mi><mi mathvariant="normal">.</mi><mi>y</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned}
\lambda f. &amp;(f (\lambda x.\lambda y.x) \lambda g.(g (\lambda x.\lambda y.y) \\
           &amp;\lambda h.(h (\lambda x.\lambda y.x) \lambda i.(i (\lambda x.\lambda y.y) (\lambda x.\lambda y.y)))))
\end{aligned}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3em;vertical-align:-1.25em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.75em;"><span style="top:-3.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">λ</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord">.</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.25em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.75em;"><span style="top:-3.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathnormal">λ</span><span class="mord mathnormal">x</span><span class="mord">.</span><span class="mord mathnormal">λ</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord">.</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mord mathnormal">λ</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord">.</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mopen">(</span><span class="mord mathnormal">λ</span><span class="mord mathnormal">x</span><span class="mord">.</span><span class="mord mathnormal">λ</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord">.</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mord mathnormal">λh</span><span class="mord">.</span><span class="mopen">(</span><span class="mord mathnormal">h</span><span class="mopen">(</span><span class="mord mathnormal">λ</span><span class="mord mathnormal">x</span><span class="mord">.</span><span class="mord mathnormal">λ</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord">.</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mord mathnormal">λi</span><span class="mord">.</span><span class="mopen">(</span><span class="mord mathnormal">i</span><span class="mopen">(</span><span class="mord mathnormal">λ</span><span class="mord mathnormal">x</span><span class="mord">.</span><span class="mord mathnormal">λ</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord">.</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span><span class="mopen">(</span><span class="mord mathnormal">λ</span><span class="mord mathnormal">x</span><span class="mord">.</span><span class="mord mathnormal">λ</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord">.</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)))))</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.25em;"><span></span></span></span></span></span></span></span></span></span></span></span>

<p>Using this method, both the standard input and output strings can entirely be encoded into pure lambda calculus terms,
letting LambdaLisp to operate with beta reduction of lambda terms as its sole rule of computation,
without the requirement of introducing any non-lambda-type object.</p>

<p>The LambdaLisp execution flow is thus as follows: you first encode the input string (Lisp program and stdin)
as lambda terms, apply it to <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mi mathvariant="normal">L</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">m</mi><mi mathvariant="normal">b</mi><mi mathvariant="normal">d</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">L</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">s</mi><mi mathvariant="normal">p</mi></mrow><mo>=</mo><mi>λ</mi><mi>x</mi><mi mathvariant="normal">.</mi><mo>⋯</mo></mrow><annotation encoding="application/x-tex">{\rm LambdaLisp} = \lambda x. \cdots</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">LambdaLisp</span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">λ</span><span class="mord mathnormal">x</span><span class="mord">.</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner">⋯</span></span></span></span>, beta-reduce it until it is in beta normal form,
and parse the output lambda term as a Mogensen-Scott-encoded list of bits
(inspecting the equivalence of lambda terms is quite simple in this case since it is in beta normal form).
This rather complex flow is supported exactly as is in 3 lambda-calculus-based programming languages:
Binary Lambda Calculus, Universal Lambda, and Lazy K.</p>

<h3 id="lambda-calculus-based-programming-languages">Lambda-Calculus-Based Programming Languages</h3>
<p>Binary Lambda Calculus (BLC) and Universal Lambda (UL) are programming languages with the exact same I/O strategy described above -
a program is expressed as one pure lambda term that takes a Church-Mogensen-Scott-encoded string and returns a Church-Mogensen-Scott-encoded string.
When the interpreters for these languages <code class="language-html highlighter-rouge">Blc</code> and <code class="language-html highlighter-rouge">clamb</code> are run on the terminal,
the interpreter automatically encodes the input bytestream to lambda terms, performs beta-reduction,
parses the output lambda term as a list of bits, and prints the output as a string in the terminal.</p>

<p>The differences in BLC and UL are in a slight difference in the method for encoding the I/O.
Otherwise, both of these languages follow the same principle, where lambda terms are the solely available object types in the language.</p>

<p>In BLC and UL, lambda terms are written in a notation called <a href="https://tromp.github.io/cl/Binary_lambda_calculus.html">binary lambda calculus</a>.
Details on the BLC notation is described in the Appendix.</p>

<h3 id="lazy-k">Lazy K</h3>
<p>Lazy K is a language with the same I/O strategy with BLC and UL except programs are written as
<a href="https://en.wikipedia.org/wiki/SKI_combinator_calculus">SKI combinator calculus</a> terms instead of lambda terms.
The SKI combinator calculus is a system equivalent to lambda calculus,
where there are only 3 functions:</p>

<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mi>S</mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mi>λ</mi><mi>x</mi><mi mathvariant="normal">.</mi><mi>λ</mi><mi>y</mi><mi mathvariant="normal">.</mi><mi>λ</mi><mi>z</mi><mi mathvariant="normal">.</mi><mo stretchy="false">(</mo><mi>x</mi><mi>z</mi><mo stretchy="false">(</mo><mi>y</mi><mi>z</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mi>K</mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mi>λ</mi><mi>x</mi><mi mathvariant="normal">.</mi><mi>λ</mi><mi>y</mi><mi mathvariant="normal">.</mi><mi>x</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mi>I</mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mi>λ</mi><mi>x</mi><mi mathvariant="normal">.</mi><mi>x</mi></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned}
S &amp;= \lambda x.\lambda y.\lambda z.(x z (y z)) \\
K &amp;= \lambda x.\lambda y.x \\
I &amp;= \lambda x.x
\end{aligned}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:4.5em;vertical-align:-2em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.5em;"><span style="top:-4.66em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span></span></span><span style="top:-3.16em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span></span></span><span style="top:-1.66em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">I</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.5em;"><span style="top:-4.66em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal">λ</span><span class="mord mathnormal">x</span><span class="mord">.</span><span class="mord mathnormal">λ</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord">.</span><span class="mord mathnormal">λ</span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="mord">.</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.04398em;">yz</span><span class="mclose">))</span></span></span><span style="top:-3.16em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal">λ</span><span class="mord mathnormal">x</span><span class="mord">.</span><span class="mord mathnormal">λ</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord">.</span><span class="mord mathnormal">x</span></span></span><span style="top:-1.66em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal">λ</span><span class="mord mathnormal">x</span><span class="mord">.</span><span class="mord mathnormal">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2em;"><span></span></span></span></span></span></span></span></span></span></span></span>

<p>Every SKI combinator calculus term is written as a combination of these 3 functions.</p>

<p>Every SKI term can be easily be converted to an equivalent lambda calculus term by simply rewriting the term with these rules.
Very interestingly, there is a method for converting the other way around -
there is a <a href="https://en.wikipedia.org/wiki/Combinatory_logic#Completeness_of_the_S-K_basis">consistent method</a>
to convert an arbitrary lambda term with an arbitrary number of variables to an equivalent SKI combinator calculus term.
This equivalence relation with lambda calculus proves that SKI combinator calculus is Turing-complete.</p>

<p>Apart from the strong condition that only 3 predefined functions exist,
the beta-reduction rules for the SKI combinator calculus are exactly identical as that of lambda calculus,
so the computation flow and the I/O strategy for Lazy K is the same as BLC and Universal Lambda -
all programs can be written purely in SKI combinator calculus terms without the need of introducing any function other than <code class="language-html highlighter-rouge">S</code>, <code class="language-html highlighter-rouge">K</code>, and <code class="language-html highlighter-rouge">I</code>.
This allows Lazy K’s syntax to be astonishingly simple, where only 4 keywords exist - <code class="language-html highlighter-rouge">s</code>, <code class="language-html highlighter-rouge">k</code>, <code class="language-html highlighter-rouge">i</code>, and <code class="language-html highlighter-rouge">`</code> for function application.</p>

<p>As mentioned in the <a href="https://tromp.github.io/cl/lazy-k.html">original Lazy K design proposal</a>,
if <a href="https://en.wikipedia.org/wiki/Brainfuck">BF</a> captures the distilled essence of structured imperative programming,
Lazy K captures the distilled essence of functional programming.
It might as well be the assembly language of lazily evaluated functional programming.
With the simple syntax and rules orchestrating a Turing-complete language,
I find Lazy K to be a very beautiful language being one of my all-time favorites.</p>

<p>LambdaLisp is written in these 3 languages - Binary Lambda Calculus, Universal Lambda, and Lazy K.
In each of these languages, LambdaLisp is expressed as one lambda term or SKI combinator calculus term.
Therefore, to run LambdaLisp, an interpreter for one of these languages is required.
To put in a rather convoluted way, LambdaLisp is a Lisp interpreter that runs on another language’s interpreter.</p>

<h3 id="interactive-io-in-lambda-calculus-based-languages">Interactive I/O in Lambda-Calculus-Based Languages</h3>
<p>The I/O model described previously looks static - at first sight it seems as if the entire value of <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">s</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">d</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">n</mi></mrow><annotation encoding="application/x-tex">{\rm stdin}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">stdin</span></span></span></span></span></span> needs to be pre-supplied beforehand on execution, making interactive programs be impossible.
However, this is not the case. The interpreter handles interactive I/O by the following clever combination of input buffering and lazy evaluation:</p>

<ul>
  <li>The input string is buffered into the memory. Its values are lazily evaluated - execution proceeds
until the last moment an input needs to be referenced in order for beta reduction to proceed.</li>
  <li>
    <p>The output string is printed as soon as the interpreter deduces the first characters of the output string.</p>

    <!-- - While eager evaluation evaluates the innermost expressions first,
  lazy evaluation evaluates the outermost expressions first.
  Since the outermost expression is the output string,
  the interpreter is able to know parts of the output string before the program terminates. -->
  </li>
</ul>

<p>As an example, consider the BLC program <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">R</mi><mi mathvariant="normal">O</mi><mi mathvariant="normal">T</mi><mn>13</mn></mrow><annotation encoding="application/x-tex">{\rm ROT13}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">ROT13</span></span></span></span></span></span> which initially prints a prompt <code class="language-html highlighter-rouge">In&gt;</code>,
accepts standard input, then outputs the ROT13 encoding of the standard input.
After the user starts the program, the interpreter’s beta-reduction proceeds as follows:</p>

<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow><mi mathvariant="normal">R</mi><mi mathvariant="normal">O</mi><mi mathvariant="normal">T</mi><mn>13</mn></mrow><mtext> </mtext><mrow><mi mathvariant="normal">s</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">d</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">n</mi></mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mo stretchy="false">(</mo><mi>λ</mi><mi>s</mi><mi mathvariant="normal">.</mi><mrow><mi mathvariant="normal">C</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi><mi mathvariant="normal">e</mi></mrow><mtext> </mtext><mi>s</mi><mo stretchy="false">)</mo><mtext> </mtext><mrow><mi mathvariant="normal">s</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">d</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">n</mi></mrow></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mo stretchy="false">(</mo><mrow><mi mathvariant="normal">C</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi><mi mathvariant="normal">e</mi></mrow><mtext> </mtext><mrow><mi mathvariant="normal">s</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">d</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">n</mi></mrow><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mo stretchy="false">(</mo><mrow><mi mathvariant="normal">c</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">s</mi></mrow><mtext> </mtext><mover accent="true"><mi>I</mi><mo>~</mo></mover><mtext> </mtext><mo stretchy="false">(</mo><msub><mrow><mi mathvariant="normal">C</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi><mi mathvariant="normal">e</mi></mrow><mn>1</mn></msub><mtext> </mtext><mrow><mi mathvariant="normal">s</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">d</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">n</mi></mrow><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mo stretchy="false">(</mo><mrow><mi mathvariant="normal">c</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">s</mi></mrow><mtext> </mtext><mover accent="true"><mi>I</mi><mo>~</mo></mover><mtext> </mtext><mo stretchy="false">(</mo><mrow><mi mathvariant="normal">c</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">s</mi></mrow><mtext> </mtext><mover accent="true"><mi>n</mi><mo>~</mo></mover><mtext> </mtext><mo stretchy="false">(</mo><msub><mrow><mi mathvariant="normal">C</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi><mi mathvariant="normal">e</mi></mrow><mn>2</mn></msub><mtext> </mtext><mrow><mi mathvariant="normal">s</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">d</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">n</mi></mrow><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mo stretchy="false">(</mo><mrow><mi mathvariant="normal">c</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">s</mi></mrow><mtext> </mtext><mover accent="true"><mi>I</mi><mo>~</mo></mover><mtext> </mtext><mo stretchy="false">(</mo><mrow><mi mathvariant="normal">c</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">s</mi></mrow><mtext> </mtext><mover accent="true"><mi>n</mi><mo>~</mo></mover><mtext> </mtext><mo stretchy="false">(</mo><mrow><mi mathvariant="normal">c</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">s</mi></mrow><mtext> </mtext><mover accent="true"><mo>&gt;</mo><mo>~</mo></mover><mtext> </mtext><mo stretchy="false">(</mo><msub><mrow><mi mathvariant="normal">C</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi><mi mathvariant="normal">e</mi></mrow><mn>3</mn></msub><mtext> </mtext><mrow><mi mathvariant="normal">s</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">d</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">n</mi></mrow><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned}
{\rm ROT13} ~ {\rm stdin}
&amp;= (\lambda s.{\rm Code} ~ s) ~ {\rm stdin} \\
&amp;= ({\rm Code} ~ {\rm stdin}) \\
&amp;= ({\rm cons} ~ \tilde I ~ ({\rm Code}_1 ~ {\rm stdin})) \\
&amp;= ({\rm cons} ~ \tilde I ~ ({\rm cons} ~ \tilde n ~ ({\rm Code}_2 ~ {\rm stdin}))) \\
&amp;= ({\rm cons} ~ \tilde I ~ ({\rm cons} ~ \tilde n ~ ({\rm cons} ~ \tilde &gt; ~ ({\rm Code}_3 ~ {\rm stdin})))) \\
\end{aligned}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:7.7406em;vertical-align:-3.6203em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:4.1203em;"><span style="top:-6.2803em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathrm">ROT13</span></span></span><span class="mspace nobreak"> </span><span class="mord"><span class="mord"><span class="mord mathrm">stdin</span></span></span></span></span><span style="top:-4.7803em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span><span style="top:-3.2001em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span><span style="top:-1.6199em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span><span style="top:-0.0397em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:3.6203em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:4.1203em;"><span style="top:-6.2803em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mopen">(</span><span class="mord mathnormal">λ</span><span class="mord mathnormal">s</span><span class="mord">.</span><span class="mord"><span class="mord"><span class="mord mathrm">Code</span></span></span><span class="mspace nobreak"> </span><span class="mord mathnormal">s</span><span class="mclose">)</span><span class="mspace nobreak"> </span><span class="mord"><span class="mord"><span class="mord mathrm">stdin</span></span></span></span></span><span style="top:-4.7803em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord mathrm">Code</span></span></span><span class="mspace nobreak"> </span><span class="mord"><span class="mord"><span class="mord mathrm">stdin</span></span></span><span class="mclose">)</span></span></span><span style="top:-3.2001em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord mathrm">cons</span></span></span><span class="mspace nobreak"> </span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9202em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span></span><span style="top:-3.6023em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1389em;"><span class="mord">~</span></span></span></span></span></span></span><span class="mspace nobreak"> </span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathrm">Code</span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace nobreak"> </span><span class="mord"><span class="mord"><span class="mord mathrm">stdin</span></span></span><span class="mclose">))</span></span></span><span style="top:-1.6199em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord mathrm">cons</span></span></span><span class="mspace nobreak"> </span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9202em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span></span><span style="top:-3.6023em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1389em;"><span class="mord">~</span></span></span></span></span></span></span><span class="mspace nobreak"> </span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord mathrm">cons</span></span></span><span class="mspace nobreak"> </span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6679em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">n</span></span><span style="top:-3.35em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.25em;"><span class="mord">~</span></span></span></span></span></span></span><span class="mspace nobreak"> </span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathrm">Code</span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace nobreak"> </span><span class="mord"><span class="mord"><span class="mord mathrm">stdin</span></span></span><span class="mclose">)))</span></span></span><span style="top:-0.0397em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord mathrm">cons</span></span></span><span class="mspace nobreak"> </span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9202em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span></span><span style="top:-3.6023em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1389em;"><span class="mord">~</span></span></span></span></span></span></span><span class="mspace nobreak"> </span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord mathrm">cons</span></span></span><span class="mspace nobreak"> </span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6679em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">n</span></span><span style="top:-3.35em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.25em;"><span class="mord">~</span></span></span></span></span></span></span><span class="mspace nobreak"> </span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord mathrm">cons</span></span></span><span class="mspace nobreak"> </span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.776em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mrel">&gt;</span></span><span style="top:-3.4581em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.25em;"><span class="mord">~</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.0391em;"><span></span></span></span></span></span><span class="mspace nobreak"> </span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathrm">Code</span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace nobreak"> </span><span class="mord"><span class="mord"><span class="mord mathrm">stdin</span></span></span><span class="mclose">))))</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:3.6203em;"><span></span></span></span></span></span></span></span></span></span></span></span>

<p>Here, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>I</mi><mo>~</mo></mover></mrow><annotation encoding="application/x-tex">\tilde I</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9202em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9202em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span></span><span style="top:-3.6023em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1389em;"><span class="mord">~</span></span></span></span></span></span></span></span></span></span> is a lambda term representing the character <code class="language-html highlighter-rouge">I</code>.</p>

<p>As <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">C</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi><mi mathvariant="normal">e</mi></mrow><annotation encoding="application/x-tex">{\rm Code}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">Code</span></span></span></span></span></span> is beta-reduced, it “weaves out” its output string <code class="language-html highlighter-rouge">In&gt;</code> on the way.
This is somewhat akin to the central dogma of molecular biology,
where ribosomes transcribe genetic information to polypeptide chains - the program is the gene,
the interpreter is the ribosome, and the list of output characters is the polypeptide chain.</p>

<p>The interpreter continues its evaluation until further beta reduction is impossible without the knowledge of the value of <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">s</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">d</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">n</mi></mrow><annotation encoding="application/x-tex">{\rm stdin}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">stdin</span></span></span></span></span></span>,
which happens at <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mrow><mi mathvariant="normal">C</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi><mi mathvariant="normal">e</mi></mrow><mn>3</mn></msub></mrow><annotation encoding="application/x-tex">{\rm Code}_3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathrm">Code</span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>. At this point, the string <code class="language-html highlighter-rouge">In&gt;</code> is shown on the terminal since its values are already determined and available.</p>

<p>Seeing the prompt <code class="language-html highlighter-rouge">In&gt;</code>, suppose that the user types the string “Hi”. The interpreter then buffers its lambda-encoded expression into the pointer that points to <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">s</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">d</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">n</mi></mrow><annotation encoding="application/x-tex">{\rm stdin}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">stdin</span></span></span></span></span></span>,
making the evaluation proceed as:</p>

<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>r</mi><mi mathvariant="normal">.</mi><mi>h</mi><mi mathvariant="normal">.</mi><mi>s</mi><mi mathvariant="normal">.</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mo stretchy="false">(</mo><mrow><mi mathvariant="normal">c</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">s</mi></mrow><mtext> </mtext><mover accent="true"><mi>I</mi><mo>~</mo></mover><mtext> </mtext><mo stretchy="false">(</mo><mrow><mi mathvariant="normal">c</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">s</mi></mrow><mtext> </mtext><mover accent="true"><mi>n</mi><mo>~</mo></mover><mtext> </mtext><mo stretchy="false">(</mo><mrow><mi mathvariant="normal">c</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">s</mi></mrow><mtext> </mtext><mover accent="true"><mo>&gt;</mo><mo>~</mo></mover><mtext> </mtext><mo stretchy="false">(</mo><mrow><mi mathvariant="normal">c</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">s</mi></mrow><mtext> </mtext><mover accent="true"><mi>U</mi><mo>~</mo></mover><mtext> </mtext><mo stretchy="false">(</mo><msub><mrow><mi mathvariant="normal">C</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi><mi mathvariant="normal">e</mi></mrow><mn>4</mn></msub><mtext> </mtext><mrow><mi mathvariant="normal">s</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">d</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">n</mi></mrow><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mo stretchy="false">(</mo><mrow><mi mathvariant="normal">c</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">s</mi></mrow><mtext> </mtext><mover accent="true"><mi>I</mi><mo>~</mo></mover><mtext> </mtext><mo stretchy="false">(</mo><mrow><mi mathvariant="normal">c</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">s</mi></mrow><mtext> </mtext><mover accent="true"><mi>n</mi><mo>~</mo></mover><mtext> </mtext><mo stretchy="false">(</mo><mrow><mi mathvariant="normal">c</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">s</mi></mrow><mtext> </mtext><mover accent="true"><mo>&gt;</mo><mo>~</mo></mover><mtext> </mtext><mo stretchy="false">(</mo><mrow><mi mathvariant="normal">c</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">s</mi></mrow><mtext> </mtext><mover accent="true"><mi>U</mi><mo>~</mo></mover><mtext> </mtext><mo stretchy="false">(</mo><mrow><mi mathvariant="normal">c</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">s</mi></mrow><mtext> </mtext><mover accent="true"><mi>v</mi><mo>~</mo></mover><mtext> </mtext><mo stretchy="false">(</mo><msub><mrow><mi mathvariant="normal">C</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi><mi mathvariant="normal">e</mi></mrow><mn>5</mn></msub><mtext> </mtext><mrow><mi mathvariant="normal">s</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">d</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">n</mi></mrow><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned}
r.h.s.
&amp;= ({\rm cons} ~ \tilde I ~ ({\rm cons} ~ \tilde n ~ ({\rm cons} ~ \tilde &gt; ~ ({\rm cons} ~ \tilde U ~ ({\rm Code}_4 ~ {\rm stdin}))))) \\
&amp;= ({\rm cons} ~ \tilde I ~ ({\rm cons} ~ \tilde n ~ ({\rm cons} ~ \tilde &gt; ~ ({\rm cons} ~ \tilde U ~ ({\rm cons} ~ \tilde v ~ ({\rm Code}_5 ~ {\rm stdin})))))) \\
\end{aligned}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3.1604em;vertical-align:-1.3302em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8302em;"><span style="top:-3.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord">.</span><span class="mord mathnormal">h</span><span class="mord">.</span><span class="mord mathnormal">s</span><span class="mord">.</span></span></span><span style="top:-2.3298em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.3302em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8302em;"><span style="top:-3.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord mathrm">cons</span></span></span><span class="mspace nobreak"> </span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9202em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span></span><span style="top:-3.6023em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1389em;"><span class="mord">~</span></span></span></span></span></span></span><span class="mspace nobreak"> </span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord mathrm">cons</span></span></span><span class="mspace nobreak"> </span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6679em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">n</span></span><span style="top:-3.35em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.25em;"><span class="mord">~</span></span></span></span></span></span></span><span class="mspace nobreak"> </span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord mathrm">cons</span></span></span><span class="mspace nobreak"> </span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.776em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mrel">&gt;</span></span><span style="top:-3.4581em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.25em;"><span class="mord">~</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.0391em;"><span></span></span></span></span></span><span class="mspace nobreak"> </span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord mathrm">cons</span></span></span><span class="mspace nobreak"> </span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9202em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">U</span></span><span style="top:-3.6023em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">~</span></span></span></span></span></span></span><span class="mspace nobreak"> </span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathrm">Code</span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">4</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace nobreak"> </span><span class="mord"><span class="mord"><span class="mord mathrm">stdin</span></span></span><span class="mclose">)))))</span></span></span><span style="top:-2.3298em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord mathrm">cons</span></span></span><span class="mspace nobreak"> </span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9202em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span></span><span style="top:-3.6023em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1389em;"><span class="mord">~</span></span></span></span></span></span></span><span class="mspace nobreak"> </span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord mathrm">cons</span></span></span><span class="mspace nobreak"> </span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6679em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">n</span></span><span style="top:-3.35em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.25em;"><span class="mord">~</span></span></span></span></span></span></span><span class="mspace nobreak"> </span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord mathrm">cons</span></span></span><span class="mspace nobreak"> </span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.776em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mrel">&gt;</span></span><span style="top:-3.4581em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.25em;"><span class="mord">~</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.0391em;"><span></span></span></span></span></span><span class="mspace nobreak"> </span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord mathrm">cons</span></span></span><span class="mspace nobreak"> </span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9202em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">U</span></span><span style="top:-3.6023em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">~</span></span></span></span></span></span></span><span class="mspace nobreak"> </span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord mathrm">cons</span></span></span><span class="mspace nobreak"> </span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6679em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span></span><span style="top:-3.35em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">~</span></span></span></span></span></span></span><span class="mspace nobreak"> </span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathrm">Code</span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">5</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace nobreak"> </span><span class="mord"><span class="mord"><span class="mord mathrm">stdin</span></span></span><span class="mclose">))))))</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.3302em;"><span></span></span></span></span></span></span></span></span></span></span></span>

<p>On the terminal, the interaction process would look like this:</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="syntax"><code>In&gt;[**Halts; User types string**]Hi[**User types return; `Hi` is buffered into stdin**]
Uv
</code></pre></div></div>

<h2 id="lambdalisp-implementation-details">LambdaLisp Implementation Details</h2>
<p>We will now cover LambdaLisp-specific implementation details.</p>

<h3 id="the-core-implementation-strategy">The Core Implementation Strategy</h3>
<p>When viewed as a programming language, lambda calculus is a purely functional language.
This derives the following two basic programming strategies for LambdaLisp:</p>

<ul>
  <li>In order to use global variables, the global state is passed to every function that affects or relies on the global state.</li>
  <li>In order to control the evaluation flow for I/O, continuation-passing style (CPS) is used.</li>
</ul>

<p>Writing in continuation-passing style also helps the lambda calculus interpreter to prevent re-evaluating the same term multiple times.
This is very, very important and critical when writing programs for the 521-byte binary lambda calculus interpreters Blc, tromp and uni,
since it seems that they lack a memoization feature, although they readily have a garbage collection feature.
Writing in direct style gradually slows down the runtime execution speed since memoization does not occur and the same computation is repeated multiple times.
However, by carefully writing the entire program in continuation-passing style,
the evaluation flow can be controlled so that the program only proceeds when the value under attention is in beta-normal form.
In this situation, since values are already evaluated to their final form,
the need for memoization becomes unnecessary in the first place.</p>

<p>The continuation-passing style technique suddenly transforms Blc to a very, very fast and efficient lambda calculus interpreter.
In fact, the largest program <a href="https://github.com/woodrush/lambdalisp/blob/main/examples/lambdacraft.cl">lambdacraft.cl</a> runs the fastest and even the most memory-efficient on Blc,
using only about 1.7 GB of memory, while <code class="language-html highlighter-rouge">clamb</code> uses about 5GB of memory.
I suspect that the speed is due to a efficient memory configuration and the memory efficiency is due to the garbage collection feature.
I was very surprised how large of a galaxy is fit into the microcosmos of 521 bytes!
This realization that continuation-passing-style programs run very fast on Blc was what made everything possible and what motivated me to set on the journey of building LambdaCraft and LambdaLisp.</p>

<p>The difference between continuation-passing style and direct style is explained in the Appendix, with JavaScript code samples that run on the browser’s console.</p>

<h3 id="the-startup-phase---a-primitive-form-of-asynchronous-programming">The Startup Phase - A Primitive Form of Asynchronous Programming</h3>
<p>Right after LambdaLisp starts running, it runs the following steps:</p>

<ul>
  <li>The string generator decompresses the “prelude Lisp code”, and also generates keyword strings such as <code class="language-html highlighter-rouge">quote</code>.</li>
  <li>The initial prompt carret <code class="language-html highlighter-rouge">&gt; </code>   is printed.</li>
  <li>The prelude Lisp code is silently evaluated (the results are not printed).</li>
  <li>The user’s initial input is evaluated and the results are printed.</li>
  <li>The interpreter enters the basic read-eval-print-loop.</li>
</ul>

<p>The <a href="https://github.com/woodrush/lambdalisp/blob/main/src/prelude.lisp">prelude Lisp code</a> is a LambdaLisp code
that defines core functions such as <code class="language-html highlighter-rouge">defun</code> and <code class="language-html highlighter-rouge">defmacro</code> as macros.
The prelude is hard-coded as a compressed string, which is decompressed by the string generator before being passed to the interpreter.
The compression method is described later.
The LambdaLisp core code written in LambdaCraft hard-codes only the essential and speed-critical functions.
Other non-critical functions are defined through LambdaLisp code in the prelude.
A lot of the features including <code class="language-html highlighter-rouge">defun</code> and <code class="language-html highlighter-rouge">defmacro</code> which seem to look like keywords are in fact defined as macros.
Due to this implementation, it is in fact possible to override the definition of <code class="language-html highlighter-rouge">defun</code> to something else using <code class="language-html highlighter-rouge">setq</code>, but I consider that as a flexible feature.</p>

<p>There is in fact a subtle form of asynchronous programming in action in this startup phase.
Since the prelude code takes a little bit of time to evaluate since it contains a lot of code,
if the initial prompt carret <code class="language-html highlighter-rouge">&gt; </code> is shown <em>after</em> evaluating the prelude code,
it causes a slightly stressful short lag until the prelude finishes running.</p>

<p>To circumvent this, the the initial prompt carret <code class="language-html highlighter-rouge">&gt; </code> is printed <em>before</em> the prelude is loaded.
This allows the prelude code to be evaluated <em>while</em> the user is typing their initial Lisp code.
Since the input is buffered in all of the lambda calculus interpreters, their input does not get lost even when the prelude is running in the background.
If the user types very fast, there will become a little bit of waiting until the result of the inital input is shown,
but if the prelude is already loaded, their result will be shown right away.
All later inputs are evaluated faster because the prelude is only read once at initialization.
In a way, this is a primitive form of asynchronous programming, where processing the user input and the execution of some code is done concurrently.</p>

<h3 id="the-basic-evaluation-loop">The Basic Evaluation Loop</h3>
<p>After the prelude is loaded, the interpreter enters its basic read-eval-print loop.</p>

<p>As mentioned before, the basic design is that all state-affecting functions must pass the state as arguments,
and basicallly all functions are written in CPS.
This makes the core <code class="language-html highlighter-rouge">eval</code> function have the following signature:</p>

<div class="language-lisp highlighter-rouge"><div class="highlight"><pre class="syntax"><code><span class="c1">;; LambdaCraft</span>
<span class="p">(</span><span class="nv">defrec-lazy</span> <span class="nb">eval</span> <span class="p">(</span><span class="nv">expr</span> <span class="nv">state</span> <span class="nv">cont</span><span class="p">)</span>
  <span class="o">...</span><span class="p">)</span>
</code></pre></div></div>

<p>Where <code class="language-html highlighter-rouge">expr</code> is a Lisp expression, <code class="language-html highlighter-rouge">state</code> is the global state, and <code class="language-html highlighter-rouge">cont</code> is the continuation.
The comment <code class="language-html highlighter-rouge">;; LambdaCraft</code> indicates that this is the source code for the LambdaLisp interpreter written in LambdaCraft.</p>

<p>The direct return type of <code class="language-html highlighter-rouge">eval</code> is <code class="language-html highlighter-rouge">string</code>, and not <code class="language-html highlighter-rouge">expr</code> or <code class="language-html highlighter-rouge">state</code>.
This is because the entire program is expected to be a program that “takes a string and outputs a string”.
This design also allows print debugging to be written very intuitively in an imperative style as discussed later.</p>

<p>Instead of using the direct return values, the evaluation results are “returned” to later processes through the continuation <code class="language-html highlighter-rouge">cont</code>.
<code class="language-html highlighter-rouge">cont</code> is actually just a callback function that is called at the end of <code class="language-html highlighter-rouge">eval</code>,
which is called with the evaluated <code class="language-html highlighter-rouge">expr</code> and the new <code class="language-html highlighter-rouge">state</code> as its arguments.
For example, if the evaluation result is <code class="language-html highlighter-rouge">42</code> and the renewed state is <code class="language-html highlighter-rouge">state</code>, <code class="language-html highlighter-rouge">eval</code> calls the callback function <code class="language-html highlighter-rouge">cont</code> as</p>

<div class="language-lisp highlighter-rouge"><div class="highlight"><pre class="syntax"><code><span class="p">(</span><span class="nv">cont</span> <span class="nv">result</span> <span class="nv">state</span><span class="p">)</span> <span class="c1">;; Where result == 42 and state is the renewed state</span>
</code></pre></div></div>

<p>in the final step of the code. Here, two values <code class="language-html highlighter-rouge">result</code> and <code class="language-html highlighter-rouge">state</code> are “returned” to the callback function <code class="language-html highlighter-rouge">cont</code> and are used later in <code class="language-html highlighter-rouge">cont</code>.</p>

<p>Having the direct return type of <code class="language-html highlighter-rouge">eval</code> to be a string makes the implementation of <code class="language-html highlighter-rouge">exit</code> very simple. It is implemented in <code class="language-html highlighter-rouge">eval</code> as:</p>

<div class="language-lisp highlighter-rouge"><div class="highlight"><pre class="syntax"><code><span class="c1">;; LambdaCraft</span>
<span class="p">((</span><span class="nv">stringeq</span> <span class="p">(</span><span class="nv">valueof</span> <span class="nv">head</span><span class="p">)</span> <span class="nv">kExit</span><span class="p">)</span>
  <span class="no">nil</span><span class="p">)</span>
</code></pre></div></div>

<p>Here is how it works:</p>

<ul>
  <li>Normally, every successive chain of computations is evoked by calling the callback function (the continuation).
Here, since <code class="language-html highlighter-rouge">eval</code> no longer calls a continuation when <code class="language-html highlighter-rouge">exit</code> is called,
no further computation happens and the interpreter stops there.</li>
  <li><code class="language-html highlighter-rouge">eval</code>’s direct return value is set to <code class="language-html highlighter-rouge">nil</code>, which is a string terminator.
This leaves <code class="language-html highlighter-rouge">nil</code> at the end of the output string, completing the value of the output string.</li>
</ul>

<p>A similar implementation is used for <code class="language-html highlighter-rouge">read-expr</code>, which exits the interpreter when there is no more text to read:</p>

<div class="language-lisp highlighter-rouge"><div class="highlight"><pre class="syntax"><code><span class="c1">;; LambdaCraft</span>
<span class="c1">;; Exit the program when EOF is reached</span>
<span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nv">isnil</span> <span class="nv">stdin</span><span class="p">)</span>
  <span class="no">nil</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="basic-data-structures">Basic Data Structures</h3>
<p>The <code class="language-html highlighter-rouge">state</code> is a 3-tuple that contains <code class="language-html highlighter-rouge">reg</code>, <code class="language-html highlighter-rouge">heap</code> and <code class="language-html highlighter-rouge">stdin</code>. In lambda terms:</p>

<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi mathvariant="normal">s</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">e</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>:</mo><mo>=</mo><mrow><mi mathvariant="normal">c</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">s</mi><mn>3</mn></mrow><mtext> </mtext><mrow><mi mathvariant="normal">r</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">g</mi></mrow><mtext> </mtext><mrow><mi mathvariant="normal">h</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">p</mi></mrow><mtext> </mtext><mrow><mi mathvariant="normal">s</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">d</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">n</mi></mrow></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mo stretchy="false">(</mo><mi>λ</mi><mi>a</mi><mi mathvariant="normal">.</mi><mi>λ</mi><mi>b</mi><mi mathvariant="normal">.</mi><mi>λ</mi><mi>c</mi><mi mathvariant="normal">.</mi><mi>λ</mi><mi>f</mi><mi mathvariant="normal">.</mi><mo stretchy="false">(</mo><mi>f</mi><mtext> </mtext><mi>a</mi><mtext> </mtext><mi>b</mi><mtext> </mtext><mi>c</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mtext> </mtext><mrow><mi mathvariant="normal">r</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">g</mi></mrow><mtext> </mtext><mrow><mi mathvariant="normal">h</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">p</mi></mrow><mtext> </mtext><mrow><mi mathvariant="normal">s</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">d</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">n</mi></mrow></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mi>λ</mi><mi>f</mi><mi mathvariant="normal">.</mi><mtext> </mtext><mo stretchy="false">(</mo><mi>f</mi><mtext> </mtext><mrow><mi mathvariant="normal">r</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">g</mi></mrow><mtext> </mtext><mrow><mi mathvariant="normal">h</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">p</mi></mrow><mtext> </mtext><mrow><mi mathvariant="normal">s</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">d</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">n</mi></mrow><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned}
{\rm state}
&amp;:= {\rm cons3} ~ {\rm reg} ~ {\rm heap} ~ {\rm stdin} \\
&amp;= (\lambda a. \lambda b. \lambda c. \lambda f. (f~a~b~c)) ~ {\rm reg} ~ {\rm heap} ~ {\rm stdin} \\
&amp;= \lambda f. ~ (f ~ {\rm reg} ~ {\rm heap} ~ {\rm stdin})
\end{aligned}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:4.5em;vertical-align:-2em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.5em;"><span style="top:-4.66em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathrm">state</span></span></span></span></span><span style="top:-3.16em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span><span style="top:-1.66em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.5em;"><span style="top:-4.66em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">cons3</span></span></span><span class="mspace nobreak"> </span><span class="mord"><span class="mord"><span class="mord mathrm" style="margin-right:0.01389em;">reg</span></span></span><span class="mspace nobreak"> </span><span class="mord"><span class="mord"><span class="mord mathrm">heap</span></span></span><span class="mspace nobreak"> </span><span class="mord"><span class="mord"><span class="mord mathrm">stdin</span></span></span></span></span><span style="top:-3.16em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mopen">(</span><span class="mord mathnormal">λa</span><span class="mord">.</span><span class="mord mathnormal">λb</span><span class="mord">.</span><span class="mord mathnormal">λ</span><span class="mord mathnormal">c</span><span class="mord">.</span><span class="mord mathnormal">λ</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord">.</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mspace nobreak"> </span><span class="mord mathnormal">a</span><span class="mspace nobreak"> </span><span class="mord mathnormal">b</span><span class="mspace nobreak"> </span><span class="mord mathnormal">c</span><span class="mclose">))</span><span class="mspace nobreak"> </span><span class="mord"><span class="mord"><span class="mord mathrm" style="margin-right:0.01389em;">reg</span></span></span><span class="mspace nobreak"> </span><span class="mord"><span class="mord"><span class="mord mathrm">heap</span></span></span><span class="mspace nobreak"> </span><span class="mord"><span class="mord"><span class="mord mathrm">stdin</span></span></span></span></span><span style="top:-1.66em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal">λ</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord">.</span><span class="mspace nobreak"> </span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mspace nobreak"> </span><span class="mord"><span class="mord"><span class="mord mathrm" style="margin-right:0.01389em;">reg</span></span></span><span class="mspace nobreak"> </span><span class="mord"><span class="mord"><span class="mord mathrm">heap</span></span></span><span class="mspace nobreak"> </span><span class="mord"><span class="mord"><span class="mord mathrm">stdin</span></span></span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2em;"><span></span></span></span></span></span></span></span></span></span></span></span>

<p><code class="language-html highlighter-rouge">reg</code> is used to store values of global variables used internally by the interpreter.
<code class="language-html highlighter-rouge">heap</code> is a virtual heap memory used to store the <code class="language-html highlighter-rouge">let</code> and <code class="language-html highlighter-rouge">lambda</code> bindings caused by the code.
<code class="language-html highlighter-rouge">stdin</code> is the pointer to the standard input provided by the interpreter.</p>

<p>Similar with <code class="language-html highlighter-rouge">cons</code>, <code class="language-html highlighter-rouge">state</code> is a <em>function</em> that accepts a callback function and applies it with the values it’s storing.
Therefore, the contents of <code class="language-html highlighter-rouge">state</code> can be extracted by passing a callback function to <code class="language-html highlighter-rouge">state</code>:</p>

<div class="language-lisp highlighter-rouge"><div class="highlight"><pre class="syntax"><code><span class="c1">;; LambdaCraft</span>
<span class="p">(</span><span class="nv">state</span>
  <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">reg</span> <span class="nv">heap</span> <span class="nv">stdin</span><span class="p">)</span>
    <span class="nv">[do</span> <span class="nv">something</span> <span class="nv">with</span> <span class="nv">reg/heap/stdin]</span><span class="p">))</span>
</code></pre></div></div>

<p>which is continuation-passing style code, since we are using callback functions that accept values and describes what to do with those values.</p>

<p><code class="language-html highlighter-rouge">expr</code> is a Lisp expression. Expressions in LambdaLisp belong to one of the following 5 types: atom, cons, lambda, integer, and string.
All expressions are a 2-tuple with a type tag and its value:</p>

<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mrow><mi mathvariant="normal">e</mi><mi mathvariant="normal">x</mi><mi mathvariant="normal">p</mi><mi mathvariant="normal">r</mi></mrow><mo>=</mo><mrow><mi mathvariant="normal">c</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">s</mi></mrow><mtext> </mtext><mrow><mi mathvariant="normal">t</mi><mi mathvariant="normal">y</mi><mi mathvariant="normal">p</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">g</mi></mrow><mtext> </mtext><mrow><mi mathvariant="normal">v</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">l</mi><mi mathvariant="normal">u</mi><mi mathvariant="normal">e</mi></mrow><mo>=</mo><mi>λ</mi><mi>f</mi><mi mathvariant="normal">.</mi><mtext> </mtext><mo stretchy="false">(</mo><mi>f</mi><mtext> </mtext><mrow><mi mathvariant="normal">t</mi><mi mathvariant="normal">y</mi><mi mathvariant="normal">p</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">g</mi></mrow><mtext> </mtext><mrow><mi mathvariant="normal">v</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">l</mi><mi mathvariant="normal">u</mi><mi mathvariant="normal">e</mi></mrow><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">{\rm expr}
= {\rm cons} ~ {\rm typetag} ~ {\rm value}
= \lambda f. ~ (f ~ {\rm typetag} ~ {\rm value})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">expr</span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">cons</span></span></span><span class="mspace nobreak"> </span><span class="mord"><span class="mord"><span class="mord mathrm" style="margin-right:0.01389em;">typetag</span></span></span><span class="mspace nobreak"> </span><span class="mord"><span class="mord"><span class="mord mathrm">value</span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">λ</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord">.</span><span class="mspace nobreak"> </span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mspace nobreak"> </span><span class="mord"><span class="mord"><span class="mord mathrm" style="margin-right:0.01389em;">typetag</span></span></span><span class="mspace nobreak"> </span><span class="mord"><span class="mord"><span class="mord mathrm">value</span></span></span><span class="mclose">)</span></span></span></span></span>

<p>The structure of <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">v</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">l</mi><mi mathvariant="normal">u</mi><mi mathvariant="normal">e</mi></mrow><annotation encoding="application/x-tex">{\rm value}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">value</span></span></span></span></span></span> depends on the type.
For all types, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">t</mi><mi mathvariant="normal">y</mi><mi mathvariant="normal">p</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">g</mi></mrow><annotation encoding="application/x-tex">{\rm typetag}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8095em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm" style="margin-right:0.01389em;">typetag</span></span></span></span></span></span> is a selector for a 5-tuple:</p>

<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi mathvariant="normal">t</mi><mi mathvariant="normal">y</mi><mi mathvariant="normal">p</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">_</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">m</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mi>λ</mi><mi>a</mi><mi mathvariant="normal">.</mi><mi>λ</mi><mi>b</mi><mi mathvariant="normal">.</mi><mi>λ</mi><mi>c</mi><mi mathvariant="normal">.</mi><mi>λ</mi><mi>d</mi><mi mathvariant="normal">.</mi><mi>λ</mi><mi>e</mi><mi mathvariant="normal">.</mi><mi>a</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi mathvariant="normal">t</mi><mi mathvariant="normal">y</mi><mi mathvariant="normal">p</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">_</mi><mi mathvariant="normal">c</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">s</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mi>λ</mi><mi>a</mi><mi mathvariant="normal">.</mi><mi>λ</mi><mi>b</mi><mi mathvariant="normal">.</mi><mi>λ</mi><mi>c</mi><mi mathvariant="normal">.</mi><mi>λ</mi><mi>d</mi><mi mathvariant="normal">.</mi><mi>λ</mi><mi>e</mi><mi mathvariant="normal">.</mi><mi>b</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi mathvariant="normal">t</mi><mi mathvariant="normal">y</mi><mi mathvariant="normal">p</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">_</mi><mi mathvariant="normal">l</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">m</mi><mi mathvariant="normal">b</mi><mi mathvariant="normal">d</mi><mi mathvariant="normal">a</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mi>λ</mi><mi>a</mi><mi mathvariant="normal">.</mi><mi>λ</mi><mi>b</mi><mi mathvariant="normal">.</mi><mi>λ</mi><mi>c</mi><mi mathvariant="normal">.</mi><mi>λ</mi><mi>d</mi><mi mathvariant="normal">.</mi><mi>λ</mi><mi>e</mi><mi mathvariant="normal">.</mi><mi>c</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi mathvariant="normal">t</mi><mi mathvariant="normal">y</mi><mi mathvariant="normal">p</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">_</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">g</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">r</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mi>λ</mi><mi>a</mi><mi mathvariant="normal">.</mi><mi>λ</mi><mi>b</mi><mi mathvariant="normal">.</mi><mi>λ</mi><mi>c</mi><mi mathvariant="normal">.</mi><mi>λ</mi><mi>d</mi><mi mathvariant="normal">.</mi><mi>λ</mi><mi>e</mi><mi mathvariant="normal">.</mi><mi>d</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi mathvariant="normal">t</mi><mi mathvariant="normal">y</mi><mi mathvariant="normal">p</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">_</mi><mi mathvariant="normal">s</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">r</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">g</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mi>λ</mi><mi>a</mi><mi mathvariant="normal">.</mi><mi>λ</mi><mi>b</mi><mi mathvariant="normal">.</mi><mi>λ</mi><mi>c</mi><mi mathvariant="normal">.</mi><mi>λ</mi><mi>d</mi><mi mathvariant="normal">.</mi><mi>λ</mi><mi>e</mi><mi mathvariant="normal">.</mi><mi>e</mi></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned}
{\rm type\_ atom} &amp;= \lambda a.\lambda b.\lambda c.\lambda d.\lambda e. a \\
{\rm type\_ cons} &amp;= \lambda a.\lambda b.\lambda c.\lambda d.\lambda e. b \\
{\rm type\_ lambda} &amp;= \lambda a.\lambda b.\lambda c.\lambda d.\lambda e. c \\
{\rm type\_ integer} &amp;= \lambda a.\lambda b.\lambda c.\lambda d.\lambda e. d \\
{\rm type\_ string} &amp;= \lambda a.\lambda b.\lambda c.\lambda d.\lambda e. e \\
\end{aligned}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:7.5em;vertical-align:-3.5em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:4em;"><span style="top:-6.16em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathrm">type_atom</span></span></span></span></span><span style="top:-4.66em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathrm">type_cons</span></span></span></span></span><span style="top:-3.16em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathrm">type_lambda</span></span></span></span></span><span style="top:-1.66em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathrm">type_integer</span></span></span></span></span><span style="top:-0.16em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathrm" style="margin-right:0.01389em;">type_string</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:3.5em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:4em;"><span style="top:-6.16em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal">λa</span><span class="mord">.</span><span class="mord mathnormal">λb</span><span class="mord">.</span><span class="mord mathnormal">λ</span><span class="mord mathnormal">c</span><span class="mord">.</span><span class="mord mathnormal">λ</span><span class="mord mathnormal">d</span><span class="mord">.</span><span class="mord mathnormal">λ</span><span class="mord mathnormal">e</span><span class="mord">.</span><span class="mord mathnormal">a</span></span></span><span style="top:-4.66em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal">λa</span><span class="mord">.</span><span class="mord mathnormal">λb</span><span class="mord">.</span><span class="mord mathnormal">λ</span><span class="mord mathnormal">c</span><span class="mord">.</span><span class="mord mathnormal">λ</span><span class="mord mathnormal">d</span><span class="mord">.</span><span class="mord mathnormal">λ</span><span class="mord mathnormal">e</span><span class="mord">.</span><span class="mord mathnormal">b</span></span></span><span style="top:-3.16em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal">λa</span><span class="mord">.</span><span class="mord mathnormal">λb</span><span class="mord">.</span><span class="mord mathnormal">λ</span><span class="mord mathnormal">c</span><span class="mord">.</span><span class="mord mathnormal">λ</span><span class="mord mathnormal">d</span><span class="mord">.</span><span class="mord mathnormal">λ</span><span class="mord mathnormal">e</span><span class="mord">.</span><span class="mord mathnormal">c</span></span></span><span style="top:-1.66em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal">λa</span><span class="mord">.</span><span class="mord mathnormal">λb</span><span class="mord">.</span><span class="mord mathnormal">λ</span><span class="mord mathnormal">c</span><span class="mord">.</span><span class="mord mathnormal">λ</span><span class="mord mathnormal">d</span><span class="mord">.</span><span class="mord mathnormal">λ</span><span class="mord mathnormal">e</span><span class="mord">.</span><span class="mord mathnormal">d</span></span></span><span style="top:-0.16em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal">λa</span><span class="mord">.</span><span class="mord mathnormal">λb</span><span class="mord">.</span><span class="mord mathnormal">λ</span><span class="mord mathnormal">c</span><span class="mord">.</span><span class="mord mathnormal">λ</span><span class="mord mathnormal">d</span><span class="mord">.</span><span class="mord mathnormal">λ</span><span class="mord mathnormal">e</span><span class="mord">.</span><span class="mord mathnormal">e</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:3.5em;"><span></span></span></span></span></span></span></span></span></span></span></span>

<p>This way, we can do type matching by writing:</p>

<div class="language-lisp highlighter-rouge"><div class="highlight"><pre class="syntax"><code><span class="p">(</span><span class="nv">typetag</span>
  <span class="nv">[code</span> <span class="nv">for</span> <span class="nb">atom</span> <span class="nv">case]</span>
  <span class="nv">[code</span> <span class="nv">for</span> <span class="nb">cons</span> <span class="nv">case]</span>
  <span class="nv">[code</span> <span class="nv">for</span> <span class="k">lambda</span> <span class="nv">case]</span>
  <span class="nv">[code</span> <span class="nv">for</span> <span class="nc">integer</span> <span class="nv">case]</span>
  <span class="nv">[code</span> <span class="nv">for</span> <span class="nb">string</span> <span class="nv">case]</span><span class="p">)</span>
</code></pre></div></div>

<p>Type matching ensures that the <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">v</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">l</mi><mi mathvariant="normal">u</mi><mi mathvariant="normal">e</mi></mrow><annotation encoding="application/x-tex">{\rm value}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">value</span></span></span></span></span></span> for each type is always processed correctly according to its type.
Since each tag is a selector of a 5-tuple, the tag will select the code that will be executed next.
Since all codes are lazily evaluated, the codes for the unselected cases will not be evaluated.</p>

<p>As in the case of <code class="language-html highlighter-rouge">state</code>, the type and value can be extracted by passing a callback to <code class="language-html highlighter-rouge">expr</code>:</p>

<div class="language-lisp highlighter-rouge"><div class="highlight"><pre class="syntax"><code><span class="c1">;; LambdaCraft</span>
<span class="p">(</span><span class="nv">expr</span>
  <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">dtype</span> <span class="nv">value</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">dtype</span>
      <span class="nv">[do</span> <span class="nv">something</span> <span class="nv">with</span> <span class="o">`</span><span class="nv">value</span><span class="o">`</span><span class="nv">]</span><span class="p">)))</span>
</code></pre></div></div>

<h3 id="virtual-heap-memory-ram">Virtual Heap Memory (RAM)</h3>
<p>The virtual heap memory (RAM) is expressed as a binary tree constructed by the tuple constructor <code class="language-html highlighter-rouge">cons</code>.
The idea of using a binary tree data structure for expressing a RAM unit is borrowed from <a href="https://github.com/irori">irori</a>’s <a href="https://irori.hatenablog.com/entry/elvm-unlambda-part1">Unlambda VM</a> (in Japanese).
The implementation of the binary tree is modified from this definition so that the tree could be initialized as <code class="language-html highlighter-rouge">nil</code>.</p>

<p>One RAM cell can store a value of any size and any type - Lisp terms, strings, or even the interpreter’s current continuation.
This is because the RAM can actually only store one type, lambdas, but everything in lambda calculus belongs to that one type.</p>

<p>Trees are constructed using the same constructor <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mi mathvariant="normal">c</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">s</mi></mrow><mo>=</mo><mi>λ</mi><mi>x</mi><mi mathvariant="normal">.</mi><mi>λ</mi><mi>y</mi><mi mathvariant="normal">.</mi><mi>λ</mi><mi>f</mi><mi mathvariant="normal">.</mi><mo stretchy="false">(</mo><mi>f</mi><mi>x</mi><mi>y</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">{\rm cons} = \lambda x. \lambda y. \lambda f. (f x y)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">cons</span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">λ</span><span class="mord mathnormal">x</span><span class="mord">.</span><span class="mord mathnormal">λ</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord">.</span><span class="mord mathnormal">λ</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord">.</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal">x</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span></span></span></span> as lists.
A list <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi></mrow><annotation encoding="application/x-tex">L</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">L</span></span></span></span> containing <code class="language-html highlighter-rouge">A B C</code> can be written using <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">c</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">s</mi></mrow><annotation encoding="application/x-tex">{\rm cons}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">cons</span></span></span></span></span></span> as:</p>

<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>L</mi><mo>=</mo><mo stretchy="false">(</mo><mrow><mi mathvariant="normal">c</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">s</mi></mrow><mtext> </mtext><mi>A</mi><mtext> </mtext><mo stretchy="false">(</mo><mrow><mi mathvariant="normal">c</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">s</mi></mrow><mtext> </mtext><mi>B</mi><mtext> </mtext><mo stretchy="false">(</mo><mrow><mi mathvariant="normal">c</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">s</mi><mtext> </mtext><mi mathvariant="normal">C</mi><mtext> </mtext><mrow><mi mathvariant="normal">n</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">l</mi></mrow><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex">L = ({\rm cons} ~ A ~ ({\rm cons} ~ B ~ (\rm cons ~ C ~ {\rm nil})))</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">L</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord mathrm">cons</span></span></span><span class="mspace nobreak"> </span><span class="mord mathnormal">A</span><span class="mspace nobreak"> </span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord mathrm">cons</span></span></span><span class="mspace nobreak"> </span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mspace nobreak"> </span><span class="mopen">(</span><span class="mord"><span class="mord mathrm">cons</span><span class="mspace nobreak"> </span><span class="mord mathrm">C</span><span class="mspace nobreak"> </span><span class="mord"><span class="mord"><span class="mord mathrm">nil</span></span></span><span class="mclose">)))</span></span></span></span></span></span>

<p>Using the same mechanism, the following binary tree <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi></mrow><annotation encoding="application/x-tex">T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span></span></span></span>,</p>

<div class="graphviz-wrapper">

<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: G Pages: 1 -->
<svg role="img" aria-label="graphviz-a05dd097a19b5eb598d30d9d1accd6ea" width="278pt" height="186pt" viewBox="0.00 0.00 278.00 185.60">
<title>graphviz-a05dd097a19b5eb598d30d9d1accd6ea</title>
<desc>
digraph G {
  bgcolor=&quot;transparent&quot;
  n0 [shape=point]
  n1 [shape=point]
  root -&gt; n0 [label=0]
  root -&gt; n1 [label=1]
  n0 -&gt; A [label = 0]
  n0 -&gt; B [label = 1]
  n1 -&gt; C [label = 0]
  n1 -&gt; D [label = 1]
}
</desc>

<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 181.6)">
<title>G</title>
<!-- n0 -->
<g id="node1" class="node">
<title>n0</title>
<ellipse fill="black" stroke="black" cx="99" cy="-88.8" rx="1.8" ry="1.8" />
</g>
<!-- A -->
<g id="node4" class="node">
<title>A</title>
<ellipse fill="none" stroke="black" cx="27" cy="-18" rx="27" ry="18" />
<text text-anchor="middle" x="27" y="-14.3" font-family="Times,serif" font-size="14.00">A</text>
</g>
<!-- n0&#45;&gt;A -->
<g id="edge3" class="edge">
<title>n0&#45;&gt;A</title>
<path fill="none" stroke="black" d="M98.19,-87.03C93.41,-82.46 68.42,-58.57 49.38,-40.38" />
<polygon fill="black" stroke="black" points="51.57,-37.63 41.92,-33.26 46.73,-42.69 51.57,-37.63" />
<text text-anchor="middle" x="83" y="-57.8" font-family="Times,serif" font-size="14.00">0</text>
</g>
<!-- B -->
<g id="node5" class="node">
<title>B</title>
<ellipse fill="none" stroke="black" cx="99" cy="-18" rx="27" ry="18" />
<text text-anchor="middle" x="99" y="-14.3" font-family="Times,serif" font-size="14.00">B</text>
</g>
<!-- n0&#45;&gt;B -->
<g id="edge4" class="edge">
<title>n0&#45;&gt;B</title>
<path fill="none" stroke="black" d="M99,-86.83C99,-82.34 99,-63.11 99,-46.27" />
<polygon fill="black" stroke="black" points="102.5,-46.24 99,-36.24 95.5,-46.24 102.5,-46.24" />
<text text-anchor="middle" x="104" y="-57.8" font-family="Times,serif" font-size="14.00">1</text>
</g>
<!-- n1 -->
<g id="node2" class="node">
<title>n1</title>
<ellipse fill="black" stroke="black" cx="171" cy="-88.8" rx="1.8" ry="1.8" />
</g>
<!-- C -->
<g id="node6" class="node">
<title>C</title>
<ellipse fill="none" stroke="black" cx="171" cy="-18" rx="27" ry="18" />
<text text-anchor="middle" x="171" y="-14.3" font-family="Times,serif" font-size="14.00">C</text>
</g>
<!-- n1&#45;&gt;C -->
<g id="edge5" class="edge">
<title>n1&#45;&gt;C</title>
<path fill="none" stroke="black" d="M171,-86.83C171,-82.34 171,-63.11 171,-46.27" />
<polygon fill="black" stroke="black" points="174.5,-46.24 171,-36.24 167.5,-46.24 174.5,-46.24" />
<text text-anchor="middle" x="176" y="-57.8" font-family="Times,serif" font-size="14.00">0</text>
</g>
<!-- D -->
<g id="node7" class="node">
<title>D</title>
<ellipse fill="none" stroke="black" cx="243" cy="-18" rx="27" ry="18" />
<text text-anchor="middle" x="243" y="-14.3" font-family="Times,serif" font-size="14.00">D</text>
</g>
<!-- n1&#45;&gt;D -->
<g id="edge6" class="edge">
<title>n1&#45;&gt;D</title>
<path fill="none" stroke="black" d="M171.81,-87.03C176.59,-82.46 201.58,-58.57 220.62,-40.38" />
<polygon fill="black" stroke="black" points="223.27,-42.69 228.08,-33.26 218.43,-37.63 223.27,-42.69" />
<text text-anchor="middle" x="210" y="-57.8" font-family="Times,serif" font-size="14.00">1</text>
</g>
<!-- root -->
<g id="node3" class="node">
<title>root</title>
<ellipse fill="none" stroke="black" cx="125" cy="-159.6" rx="29.8" ry="18" />
<text text-anchor="middle" x="125" y="-155.9" font-family="Times,serif" font-size="14.00">root</text>
</g>
<!-- root&#45;&gt;n0 -->
<g id="edge1" class="edge">
<title>root&#45;&gt;n0</title>
<path fill="none" stroke="black" d="M118.71,-141.95C113.8,-128.97 107.15,-111.36 102.96,-100.29" />
<polygon fill="black" stroke="black" points="106.11,-98.72 99.3,-90.6 99.56,-101.19 106.11,-98.72" />
<text text-anchor="middle" x="117" y="-112.4" font-family="Times,serif" font-size="14.00">0</text>
</g>
<!-- root&#45;&gt;n1 -->
<g id="edge2" class="edge">
<title>root&#45;&gt;n1</title>
<path fill="none" stroke="black" d="M135.67,-142.64C144.71,-129.12 157.37,-110.19 164.82,-99.04" />
<polygon fill="black" stroke="black" points="167.8,-100.88 170.45,-90.62 161.98,-96.99 167.8,-100.88" />
<text text-anchor="middle" x="163" y="-112.4" font-family="Times,serif" font-size="14.00">1</text>
</g>
</g>
</svg>
</div>

<p>can be expressed using <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">c</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">s</mi></mrow><annotation encoding="application/x-tex">{\rm cons}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">cons</span></span></span></span></span></span> cells as follows:</p>

<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>T</mi><mo>=</mo><mo stretchy="false">(</mo><mrow><mi mathvariant="normal">c</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">s</mi></mrow><mtext> </mtext><mo stretchy="false">(</mo><mrow><mi mathvariant="normal">c</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">s</mi></mrow><mtext> </mtext><mi>A</mi><mtext> </mtext><mi>B</mi><mo stretchy="false">)</mo><mtext> </mtext><mo stretchy="false">(</mo><mrow><mi mathvariant="normal">c</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">s</mi></mrow><mtext> </mtext><mi>C</mi><mtext> </mtext><mi>D</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">T = ({\rm cons} ~ ({\rm cons} ~ A ~ B) ~ ({\rm cons} ~ C ~ D))</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord mathrm">cons</span></span></span><span class="mspace nobreak"> </span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord mathrm">cons</span></span></span><span class="mspace nobreak"> </span><span class="mord mathnormal">A</span><span class="mspace nobreak"> </span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mclose">)</span><span class="mspace nobreak"> </span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord mathrm">cons</span></span></span><span class="mspace nobreak"> </span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mspace nobreak"> </span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mclose">))</span></span></span></span></span>

<p>Every node where all of its leaves have unwritten values have their branch trimmed and set to <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">n</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">l</mi></mrow><annotation encoding="application/x-tex">{\rm nil}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">nil</span></span></span></span></span></span>. If all values with the address <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>∗</mo></mrow><annotation encoding="application/x-tex">1*</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span><span class="mord">∗</span></span></span></span> is unwritten, the tree would look like this:</p>

<div class="graphviz-wrapper">

<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: G Pages: 1 -->
<svg role="img" aria-label="graphviz-d01916b6478006752b5c60d3f80f7b52" width="145pt" height="218pt" viewBox="0.00 0.00 145.00 218.00">
<title>graphviz-d01916b6478006752b5c60d3f80f7b52</title>
<desc>
digraph G {
  bgcolor=&quot;transparent&quot;
  n0 [shape=point]
  root -&gt; n0 [label=0]
  root -&gt; nil [label=1]
  n0 -&gt; A [label = 0]
  n0 -&gt; B [label = 1]
}
</desc>

<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 214)">
<title>G</title>
<!-- n0 -->
<g id="node1" class="node">
<title>n0</title>
<ellipse fill="black" stroke="black" cx="63" cy="-105" rx="1.8" ry="1.8" />
</g>
<!-- A -->
<g id="node4" class="node">
<title>A</title>
<ellipse fill="none" stroke="black" cx="27" cy="-18" rx="27" ry="18" />
<text text-anchor="middle" x="27" y="-14.3" font-family="Times,serif" font-size="14.00">A</text>
</g>
<!-- n0&#45;&gt;A -->
<g id="edge3" class="edge">
<title>n0&#45;&gt;A</title>
<path fill="none" stroke="black" d="M62.6,-103.05C60.19,-97.36 47.51,-67.42 37.96,-44.88" />
<polygon fill="black" stroke="black" points="41.1,-43.31 33.97,-35.46 34.65,-46.04 41.1,-43.31" />
<text text-anchor="middle" x="53" y="-57.8" font-family="Times,serif" font-size="14.00">0</text>
</g>
<!-- B -->
<g id="node5" class="node">
<title>B</title>
<ellipse fill="none" stroke="black" cx="99" cy="-18" rx="27" ry="18" />
<text text-anchor="middle" x="99" y="-14.3" font-family="Times,serif" font-size="14.00">B</text>
</g>
<!-- n0&#45;&gt;B -->
<g id="edge4" class="edge">
<title>n0&#45;&gt;B</title>
<path fill="none" stroke="black" d="M63.4,-103.05C65.81,-97.36 78.49,-67.42 88.04,-44.88" />
<polygon fill="black" stroke="black" points="91.35,-46.04 92.03,-35.46 84.9,-43.31 91.35,-46.04" />
<text text-anchor="middle" x="88" y="-57.8" font-family="Times,serif" font-size="14.00">1</text>
</g>
<!-- root -->
<g id="node2" class="node">
<title>root</title>
<ellipse fill="none" stroke="black" cx="86" cy="-192" rx="29.8" ry="18" />
<text text-anchor="middle" x="86" y="-188.3" font-family="Times,serif" font-size="14.00">root</text>
</g>
<!-- root&#45;&gt;n0 -->
<g id="edge1" class="edge">
<title>root&#45;&gt;n0</title>
<path fill="none" stroke="black" d="M81.46,-174.21C76.85,-157.19 69.87,-131.38 65.94,-116.88" />
<polygon fill="black" stroke="black" points="69.29,-115.83 63.3,-107.09 62.53,-117.66 69.29,-115.83" />
<text text-anchor="middle" x="81" y="-144.8" font-family="Times,serif" font-size="14.00">0</text>
</g>
<!-- nil -->
<g id="node3" class="node">
<title>nil</title>
<ellipse fill="none" stroke="black" cx="110" cy="-105" rx="27" ry="18" />
<text text-anchor="middle" x="110" y="-101.3" font-family="Times,serif" font-size="14.00">nil</text>
</g>
<!-- root&#45;&gt;nil -->
<g id="edge2" class="edge">
<title>root&#45;&gt;nil</title>
<path fill="none" stroke="black" d="M90.74,-174.21C94.09,-162.33 98.66,-146.17 102.5,-132.56" />
<polygon fill="black" stroke="black" points="105.92,-133.33 105.27,-122.76 99.18,-131.43 105.92,-133.33" />
<text text-anchor="middle" x="104" y="-144.8" font-family="Times,serif" font-size="14.00">1</text>
</g>
</g>
</svg>
</div>

<p>When the tree search function encounters <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">n</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">l</mi></mrow><annotation encoding="application/x-tex">{\rm nil}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">nil</span></span></span></span></span></span>, it returns the integer zero (a list of <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi></mrow><annotation encoding="application/x-tex">N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span></span></span></span> consecutive <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span></span></span> s). The tree grows past <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">n</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">l</mi></mrow><annotation encoding="application/x-tex">{\rm nil}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">nil</span></span></span></span></span></span> only when a value is written past that address. The initial state of the RAM is <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mi mathvariant="normal">r</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">t</mi></mrow><mo>=</mo><mrow><mi mathvariant="normal">n</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">l</mi></mrow></mrow><annotation encoding="application/x-tex">{\rm root} = {\rm nil}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">root</span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">nil</span></span></span></span></span></span>, which effectively initializes the entire <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi></mrow><annotation encoding="application/x-tex">N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span></span></span></span>-bit memory space to zero without creating <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mi>N</mi></msup></mrow><annotation encoding="application/x-tex">2^N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8413em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span></span></span></span></span></span></span></span></span></span></span> nodes. Afterwards, the RAM unit only grows approximately linearly as values are written instead of growing exponentially with the machine’s bit size.</p>

<p>LambdaLisp uses a 32-bit address space for the RAM,
which is specified <a href="https://github.com/woodrush/lambdalisp/blob/main/src/lambdalisp.cl#L1812">here</a>.
The address space can be modified to an arbitrary integer by replacing the literal <code class="language-html highlighter-rouge">32</code> which shows up only once in the source code with another Church-encoded numeral.</p>

<p>LambdaLisp exposes <code class="language-html highlighter-rouge">malloc</code> and memory reading/writing to the user through the special forms <code class="language-html highlighter-rouge">malloc</code>, <code class="language-html highlighter-rouge">memread</code> and <code class="language-html highlighter-rouge">memwrite</code>. <code class="language-html highlighter-rouge">malloc</code> returns an integer indicating the pointer to the heap, which is initialized with <code class="language-html highlighter-rouge">nil</code>.
The pointer can be used with <code class="language-html highlighter-rouge">memread</code> and <code class="language-html highlighter-rouge">memwrite</code> to read and store LambdaLisp objects inside the interpreter’s heap cell.
This can be used to implement C-style arrays, as demonstrated in <a href="https://github.com/woodrush/lambdalisp/blob/main/examples/malloc.lisp">malloc.lisp</a>.</p>

<h3 id="registers-global-variables">Registers (Global Variables)</h3>
<p>The register object <code class="language-html highlighter-rouge">reg</code> uses the same binary tree data structure as the RAM,
except <code class="language-html highlighter-rouge">reg</code> uses variable-length addresses,
while <code class="language-html highlighter-rouge">heap</code> uses a fixed-length address.
The variable-length address makes the address of each cell shorter, speeding up the read and write processes.
<code class="language-html highlighter-rouge">reg</code> is used to store global variables that are frequently read out and written by the interpreter.</p>

<p>For example, we can let the register tree <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">r</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">g</mi></mrow><annotation encoding="application/x-tex">{\rm reg}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm" style="margin-right:0.01389em;">reg</span></span></span></span></span></span> have the following structure:</p>

<div class="graphviz-wrapper">

<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: G Pages: 1 -->
<svg role="img" aria-label="graphviz-adf739f41ea0ed63e19ce53a5aab2d76" width="172pt" height="305pt" viewBox="0.00 0.00 172.00 305.00">
<title>graphviz-adf739f41ea0ed63e19ce53a5aab2d76</title>
<desc>
digraph G {
  bgcolor=&quot;transparent&quot;
  rank=LR
  A B C D
  n1 [shape=point]
  n2 [shape=point]
  root -&gt; A [label=0]
  root -&gt; n1 [label=1]
  n1 -&gt; B [label = 0]
  n1 -&gt; n2 [label = 1]
  n2 -&gt; C [label = 0]
  n2 -&gt; D [label = 1]
}
</desc>

<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 301)">
<title>G</title>
<!-- A -->
<g id="node1" class="node">
<title>A</title>
<ellipse fill="none" stroke="black" cx="27" cy="-192" rx="27" ry="18" />
<text text-anchor="middle" x="27" y="-188.3" font-family="Times,serif" font-size="14.00">A</text>
</g>
<!-- B -->
<g id="node2" class="node">
<title>B</title>
<ellipse fill="none" stroke="black" cx="54" cy="-105" rx="27" ry="18" />
<text text-anchor="middle" x="54" y="-101.3" font-family="Times,serif" font-size="14.00">B</text>
</g>
<!-- C -->
<g id="node3" class="node">
<title>C</title>
<ellipse fill="none" stroke="black" cx="65" cy="-18" rx="27" ry="18" />
<text text-anchor="middle" x="65" y="-14.3" font-family="Times,serif" font-size="14.00">C</text>
</g>
<!-- D -->
<g id="node4" class="node">
<title>D</title>
<ellipse fill="none" stroke="black" cx="137" cy="-18" rx="27" ry="18" />
<text text-anchor="middle" x="137" y="-14.3" font-family="Times,serif" font-size="14.00">D</text>
</g>
<!-- n1 -->
<g id="node5" class="node">
<title>n1</title>
<ellipse fill="black" stroke="black" cx="74" cy="-192" rx="1.8" ry="1.8" />
</g>
<!-- n1&#45;&gt;B -->
<g id="edge3" class="edge">
<title>n1&#45;&gt;B</title>
<path fill="none" stroke="black" d="M73.65,-190.15C72.06,-186.29 65.48,-169.96 62,-156 60.18,-148.7 58.68,-140.68 57.49,-133.25" />
<polygon fill="black" stroke="black" points="60.94,-132.65 56.02,-123.27 54.02,-133.68 60.94,-132.65" />
<text text-anchor="middle" x="67" y="-144.8" font-family="Times,serif" font-size="14.00">0</text>
</g>
<!-- n2 -->
<g id="node6" class="node">
<title>n2</title>
<ellipse fill="black" stroke="black" cx="101" cy="-105" rx="1.8" ry="1.8" />
</g>
<!-- n1&#45;&gt;n2 -->
<g id="edge4" class="edge">
<title>n1&#45;&gt;n2</title>
<path fill="none" stroke="black" d="M74.3,-190.05C76.57,-182.9 91.01,-137.46 97.66,-116.53" />
<polygon fill="black" stroke="black" points="101.04,-117.43 100.73,-106.84 94.37,-115.31 101.04,-117.43" />
<text text-anchor="middle" x="95" y="-144.8" font-family="Times,serif" font-size="14.00">1</text>
</g>
<!-- n2&#45;&gt;C -->
<g id="edge5" class="edge">
<title>n2&#45;&gt;C</title>
<path fill="none" stroke="black" d="M100.6,-103.05C98.19,-97.36 85.51,-67.42 75.96,-44.88" />
<polygon fill="black" stroke="black" points="79.1,-43.31 71.97,-35.46 72.65,-46.04 79.1,-43.31" />
<text text-anchor="middle" x="91" y="-57.8" font-family="Times,serif" font-size="14.00">0</text>
</g>
<!-- n2&#45;&gt;D -->
<g id="edge6" class="edge">
<title>n2&#45;&gt;D</title>
<path fill="none" stroke="black" d="M101.4,-103.05C103.81,-97.36 116.49,-67.42 126.04,-44.88" />
<polygon fill="black" stroke="black" points="129.35,-46.04 130.03,-35.46 122.9,-43.31 129.35,-46.04" />
<text text-anchor="middle" x="126" y="-57.8" font-family="Times,serif" font-size="14.00">1</text>
</g>
<!-- root -->
<g id="node7" class="node">
<title>root</title>
<ellipse fill="none" stroke="black" cx="43" cy="-279" rx="29.8" ry="18" />
<text text-anchor="middle" x="43" y="-275.3" font-family="Times,serif" font-size="14.00">root</text>
</g>
<!-- root&#45;&gt;A -->
<g id="edge1" class="edge">
<title>root&#45;&gt;A</title>
<path fill="none" stroke="black" d="M38.87,-260.96C37.55,-255.26 36.14,-248.87 35,-243 33.57,-235.61 32.2,-227.57 31.01,-220.14" />
<polygon fill="black" stroke="black" points="34.45,-219.52 29.46,-210.17 27.54,-220.59 34.45,-219.52" />
<text text-anchor="middle" x="40" y="-231.8" font-family="Times,serif" font-size="14.00">0</text>
</g>
<!-- root&#45;&gt;n1 -->
<g id="edge2" class="edge">
<title>root&#45;&gt;n1</title>
<path fill="none" stroke="black" d="M49.12,-261.21C55.33,-244.19 64.74,-218.38 70.03,-203.88" />
<polygon fill="black" stroke="black" points="73.46,-204.69 73.6,-194.09 66.89,-202.29 73.46,-204.69" />
<text text-anchor="middle" x="66" y="-231.8" font-family="Times,serif" font-size="14.00">1</text>
</g>
</g>
</svg>
</div>

<p>The addresses for <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mo separator="true">,</mo><mi>B</mi><mo separator="true">,</mo><mi>C</mi><mo separator="true">,</mo><mi>D</mi></mrow><annotation encoding="application/x-tex">A, B, C, D</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">A</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span></span></span></span> becomes <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span></span></span>, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>10</mn></mrow><annotation encoding="application/x-tex">10</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">10</span></span></span></span>, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>110</mn></mrow><annotation encoding="application/x-tex">110</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">110</span></span></span></span>, and <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>111</mn></mrow><annotation encoding="application/x-tex">111</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">111</span></span></span></span>, respectively.</p>

<p>LambdaLisp uses 7 registers which are defined <a href="https://github.com/woodrush/lambdalisp/blob/main/src/lambdalisp.cl#L644">here</a>.</p>

<h3 id="the-prelude-generator-and-string-compression">The Prelude Generator and String Compression</h3>
<p>As mentioned before, the prelude is hard-coded as text that is embedded into the LambdaLisp source.
When embedding it as a lambda, the text is compressed into an efficient lambda term,
optimized for the binary lambda calculus notation.</p>

<p>The prelude is generated by consecutively applying lots and lots of characters to a function called <code class="language-html highlighter-rouge">string-concatenator</code>:</p>

<div class="language-lisp highlighter-rouge"><div class="highlight"><pre class="syntax"><code><span class="c1">;; LambdaCraft</span>
<span class="p">(</span><span class="nv">def-lazy</span> <span class="nv">prelude</span>
  <span class="p">(</span><span class="k">let</span>
    <span class="p">((</span><span class="s">"a"</span> <span class="o">...</span><span class="p">)</span>
     <span class="p">(</span><span class="s">"b"</span> <span class="o">...</span><span class="p">)</span>
     <span class="p">(</span><span class="s">"c"</span> <span class="o">...</span><span class="p">)</span>
     <span class="o">...</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">string-concatenator</span> <span class="o">...</span> <span class="s">"n"</span> <span class="s">"u"</span> <span class="s">"f"</span> <span class="s">"e"</span> <span class="s">"d"</span> <span class="s">"("</span> <span class="no">nil</span><span class="p">)))</span>

<span class="p">(</span><span class="nv">defrec-lazy</span> <span class="nv">string-concatenator</span> <span class="p">(</span><span class="nv">curstr</span> <span class="nv">x</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">cond</span>
    <span class="p">((</span><span class="nv">isnil</span> <span class="nv">x</span><span class="p">)</span>
      <span class="nv">curstr</span><span class="p">)</span>
    <span class="p">(</span><span class="no">t</span>
      <span class="p">(</span><span class="nv">string-concatenator</span> <span class="p">(</span><span class="nb">cons</span> <span class="nv">x</span> <span class="nv">curstr</span><span class="p">)))))</span>
</code></pre></div></div>

<p>The string concatenator is something close to a generator object in Python that:</p>

<ul>
  <li>When called with a character, it pushes the character to the current stack <code class="language-html highlighter-rouge">curstr</code>, and returns <code class="language-html highlighter-rouge">string-concatenator</code> itself (with a renewed <code class="language-html highlighter-rouge">curstr</code>).</li>
  <li>When called with <code class="language-html highlighter-rouge">nil</code>, it returns the stocked <code class="language-html highlighter-rouge">curstr</code> instead of returning itself.</li>
</ul>

<p>To obtain the string <code class="language-html highlighter-rouge">(aaa)</code>, you can use <code class="language-html highlighter-rouge">string-concatenator</code> as:</p>

<div class="language-lisp highlighter-rouge"><div class="highlight"><pre class="syntax"><code><span class="p">(</span><span class="nv">string-concatenator</span> <span class="s">")"</span> <span class="s">"a"</span> <span class="s">"a"</span> <span class="s">"a"</span> <span class="s">"("</span> <span class="no">nil</span><span class="p">)</span>
</code></pre></div></div>

<p>The characters are written in reverse order, since <code class="language-html highlighter-rouge">string-concatenator</code> uses a stack to create strings.</p>

<p>This helps a lot for compressing strings in binary lambda calculus notation.
The <code class="language-html highlighter-rouge">let</code> in the above code is a macro that expands to:</p>

<div class="language-lisp highlighter-rouge"><div class="highlight"><pre class="syntax"><code><span class="c1">;; LambdaCraft</span>
<span class="p">(</span><span class="nv">def-lazy</span> <span class="nv">prelude</span>
  <span class="p">((</span><span class="k">lambda</span> <span class="p">(</span><span class="s">"("</span><span class="p">)</span>
     <span class="p">((</span><span class="k">lambda</span> <span class="p">(</span><span class="s">")"</span><span class="p">)</span>
         <span class="p">((</span><span class="k">lambda</span> <span class="p">(</span><span class="s">"a"</span><span class="p">)</span>
             <span class="p">(</span><span class="nv">string-concatenator</span> <span class="s">")"</span> <span class="s">"a"</span> <span class="s">"a"</span> <span class="s">"a"</span> <span class="s">"("</span> <span class="no">nil</span><span class="p">))</span>
          <span class="nv">[definition</span> <span class="nv">of</span> <span class="s">"a"</span><span class="nv">]</span><span class="p">))</span>
      <span class="nv">[definition</span> <span class="nv">of</span> <span class="s">")"</span><span class="nv">]</span><span class="p">))</span>
   <span class="nv">[definition</span> <span class="nv">of</span> <span class="s">"("</span><span class="nv">]</span><span class="p">))</span>
</code></pre></div></div>

<p>In binary lambda calculus, the innermost expression encodes to</p>

<div class="language-lisp highlighter-rouge"><div class="highlight"><pre class="syntax"><code><span class="p">(</span><span class="nv">string-concatenator</span> <span class="s">")"</span> <span class="s">"a"</span> <span class="s">"a"</span> <span class="s">"a"</span> <span class="s">"("</span> <span class="no">nil</span><span class="p">)</span>
<span class="nb">=</span> <span class="nb">apply</span> <span class="nb">apply</span> <span class="nb">apply</span> <span class="nb">apply</span> <span class="nb">apply</span> <span class="nv">string-concatenator</span> <span class="s">")"</span> <span class="s">"a"</span> <span class="s">"a"</span> <span class="s">"a"</span> <span class="s">"("</span>
<span class="nb">=</span> <span class="mi">01</span> <span class="mi">01</span> <span class="mi">01</span> <span class="mi">01</span> <span class="mi">01</span> <span class="nv">[string-concatenator]</span> <span class="mi">110</span> <span class="mi">10</span> <span class="mi">10</span> <span class="mi">10</span> <span class="mi">1110</span>
</code></pre></div></div>

<p>Notice that the letter “a” is encoded as <code class="language-html highlighter-rouge">01 ... 10</code>, which effectively only takes 4 <em>bits</em>.
Similarly, “)” takes 5 and “)” takes 6 bits.
Since <code class="language-html highlighter-rouge">apply</code> doesn’t increase the De Bruijn indices no matter how many times it appears,
every occurrence of the same character can be encoded into the same number of bits.
Therefore, by encoding each character in the order of of appearance, its BLC notation can be optimized to a short bit notation.</p>

<p>This part of the string generator can be seen as an interesting pattern in page 33 in <a href="https://woodrush.github.io/lambdalisp.pdf">lambdalisp.pdf</a>:</p>

<p><a href="/blog/assets/posts/2022-09-17/pdf_33.png"><img src="/blog/assets/posts/2022-09-17/pdf_33.png" alt="p.33 of lambdalisp.pdf." /></a></p>

<p>Here you can see lots of variables being applied to some lambda term shown on the top line,
which actually represents <code class="language-html highlighter-rouge">string-concatenator</code>.</p>

<p>This consecutive application causes a lot of consecutive <code class="language-html highlighter-rouge">(</code>s.
This makes page 32 entirely consist of <code class="language-html highlighter-rouge">(</code>:</p>

<p><a href="/blog/assets/posts/2022-09-17/pdf_32.png"><img src="/blog/assets/posts/2022-09-17/pdf_32.png" alt="p.32 of lambdalisp.pdf." /></a></p>

<h2 id="language-features">Language Features</h2>
<h3 id="the-memory-model-for-persistent-bindings">The Memory Model for Persistent Bindings</h3>
<p><code class="language-html highlighter-rouge">let</code> bindings are stored in the <code class="language-html highlighter-rouge">heap</code> in the <code class="language-html highlighter-rouge">state</code> and passed on as persistent bindings.
Each <code class="language-html highlighter-rouge">let</code> binding holds their own environment stack, and each environment stack points to its lexical parent environment stack.
For example, the following LambdaLisp code:</p>

<div class="language-lisp highlighter-rouge"><div class="highlight"><pre class="syntax"><code><span class="c1">;; LambdaLisp</span>
<span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">x</span> <span class="mi">10</span><span class="p">)</span> <span class="p">(</span><span class="nv">y</span> <span class="mi">20</span><span class="p">))</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">x</span> <span class="mi">5</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">f</span> <span class="p">(</span><span class="k">lambda</span> <span class="o">...</span><span class="p">))</span> <span class="p">(</span><span class="nv">a</span> <span class="o">'</span><span class="p">(</span><span class="nv">a</span> <span class="nv">b</span> <span class="nv">c</span><span class="p">)))</span>
    <span class="p">(</span><span class="nb">print</span> <span class="nv">x</span><span class="p">)</span>
    <span class="o">...</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">g</span> <span class="p">(</span><span class="k">lambda</span> <span class="o">...</span><span class="p">))</span> <span class="p">(</span><span class="nv">b</span> <span class="o">'</span><span class="p">(</span><span class="nv">a</span> <span class="nv">b</span> <span class="nv">c</span><span class="p">))</span>
    <span class="p">(</span><span class="nb">print</span> <span class="nv">b</span><span class="p">)</span>
    <span class="o">...</span><span class="p">)))</span>
</code></pre></div></div>

<p>induces the following memory tree:</p>

<p><a href="/blog/assets/posts/2022-09-17/memtree.png"><img src="/blog/assets/posts/2022-09-17/memtree.png" alt="The memory tree model." width="50%" /></a></p>

<p>The node containing <code class="language-html highlighter-rouge">name = hello</code> is not relevant now.
The root node at the bottom contains bindings to basic functions initialized when running the prelude.
This memory tree is expressed in the heap as:</p>

<p><a href="/blog/assets/posts/2022-09-17/heap.png"><img src="/blog/assets/posts/2022-09-17/heap.png" alt="The heap data structure." /></a></p>

<p>Here, the virtual RAM address space is shown as 16 bits for simplicity (the actual address space is 32 bits).</p>

<p>When a <code class="language-html highlighter-rouge">let</code> binding occurs, the newest unallocated heap address is allocated my the <code class="language-html highlighter-rouge">malloc</code> function,
and the interpreter’s “current environment pointer” global variable contained in <code class="language-html highlighter-rouge">reg</code> is rewritten to the newly allocated address.
This also happens when a lambda is called, creating an environment binding the lambda arguments.</p>

<p>Each stack is initialized with a redirection pointer that points to its parent environment, shown at the bottom of the stack in the second figure.
The bindings for each variable name is then pushed on top of the stack.
On variable lookup, the lookup function first looks at the current environment’s topmost binding.
If the target variable is not contained in the stack, the lookup reaches the redirection pointer at the bottom of the stack,
where it will run the lookup again for the environment pointed by the redirection pointer.
The lookup process ends when the redirection pointer is <code class="language-html highlighter-rouge">nil</code>, where it concludes that the target variable is not bound to any value in the target environment.
The use of the redirection pointer effectively models the environments’ tree structure.</p>

<p>For example, the <code class="language-html highlighter-rouge">x</code> in the <code class="language-html highlighter-rouge">(print x)</code> in the example code will invoke a lookup for <code class="language-html highlighter-rouge">x</code>.
The lookup function first looks at the binding stack at address <code class="language-html highlighter-rouge">0x0002</code> and searches the stack until it reaches the redirection pointer to 0x0001.
The lookup function then searches the binding stack at 0x0001, where it finds the newest binding of <code class="language-html highlighter-rouge">x</code> which is <code class="language-html highlighter-rouge">x == 5</code>.
Since new bindings are pushed onto the stack, they get found before old bindings (here, <code class="language-html highlighter-rouge">x = 10</code>) are reached.</p>

<p>Variable rewriting with <code class="language-html highlighter-rouge">setq</code> is done by pushing assignments onto the stack.
The <code class="language-html highlighter-rouge">(setq x 5)</code> first searches for the variable <code class="language-html highlighter-rouge">x</code>, finds it at environment 0x0001, then pushes <code class="language-html highlighter-rouge">x = 5</code> on top of <code class="language-html highlighter-rouge">y = 20 :: x = 10</code> on the environment 0x0001.</p>

<p>The address 0x0000 represents the base environment.
It first starts out by being initialized by the function and macro definitions in the prelude.
Variables stored in the base environment behave as global variables.
This is where <code class="language-html highlighter-rouge">setq</code> and <code class="language-html highlighter-rouge">defglobal</code> behave differently.
When <code class="language-html highlighter-rouge">(setq x ...)</code> is called, <code class="language-html highlighter-rouge">setq</code> first searches for <code class="language-html highlighter-rouge">x</code> from the environment tree. If it finds <code class="language-html highlighter-rouge">x</code> somewhere in the tree,
it rewrites the found <code class="language-html highlighter-rouge">x</code> at that environment.
If it doesn’t find <code class="language-html highlighter-rouge">x</code>, it defaults to pushing a new variable <code class="language-html highlighter-rouge">x</code> to the <em>current</em> surrounding environment.
This way, <code class="language-html highlighter-rouge">setq</code> will only affect known variables or local variables.
On the other hand, <code class="language-html highlighter-rouge">defglobal</code> pushes the bindings to address 0x0000 no matter where it is called.
This way, the address 0x0000 can behave as a global environment.
The macro <code class="language-html highlighter-rouge">defun</code> is defined using <code class="language-html highlighter-rouge">defglobal</code> so that it always writes to the global environment.
The macro <code class="language-html highlighter-rouge">defun-local</code> is defined using <code class="language-html highlighter-rouge">setq</code> so that it writes in the local environment, allowing for Python and JavaScript-style local function definitions:</p>

<div class="language-lisp highlighter-rouge"><div class="highlight"><pre class="syntax"><code><span class="c1">;; LambdaLisp</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">f</span> <span class="p">(</span><span class="nv">x</span> <span class="nv">y</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">defun-local</span> <span class="nv">helper</span> <span class="p">(</span><span class="nv">z</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">*</span> <span class="nv">z</span> <span class="nv">z</span><span class="p">))</span>
  <span class="p">(</span><span class="nb">print</span> <span class="nv">helper</span><span class="p">)</span> <span class="c1">;; =&gt; @lambda</span>
  <span class="p">(</span><span class="nb">+</span> <span class="p">(</span><span class="nv">helper</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nv">helper</span> <span class="nv">y</span><span class="p">)))</span>

<span class="p">(</span><span class="nb">print</span> <span class="nv">helper</span><span class="p">)</span> <span class="c1">;; =&gt; (), since it is invisible from the global environment</span>
</code></pre></div></div>

<h3 id="garbage-collection">Garbage Collection</h3>
<p>Although there is no garbage collection for <code class="language-html highlighter-rouge">let</code> and <code class="language-html highlighter-rouge">setq</code> bindings, there is a minimal form of GC for macro expansion.
During an evaluation of a macro, there occurs 2 Lisp form evaluations:
one for constructing the expanded form, and another for evaluating the expanded form in the called environment.
Once the macro has been expanded, we know for sure that the bindings it has used will not be used again.
Therefore, macro bindings are allocated to the <em>stack</em> region which has negative addresses starting from 0xFFFF,
shown on the left half of the memory tree diagram and the heap diagram.
The stack region is freed once the macro expansion finishes.
This mechanism also supports nested macros.</p>

<p>In the memory tree in the first figure in the previous section,
the bindings for macros look the same as the bindings for lambdas,
since at evaluation time they are treated the same.
In the second figure, the environments for the macro bindings are shown on the left side of the RAM,
since they are allocated in the stack region.</p>

<p>Although the same garbage-collection feature could be implemented for lambdas,
it causes problems for lambdas that return closures.
If lambda bindings are created in the stack region,
the environment of the returned closure will point to the stack region, which will be freed right after the closure is returned.
This causes a problem when the returned closure refers to a variable defined in the global environment (for example, to basic macros defined in the prelude such as <code class="language-html highlighter-rouge">cond</code>),
since the lookup function will eventually start looking at the stack region,
which could be occupied by an old environment or some other lambda’s environment, causing the risk for bugs.
This could be circumvented by carefully writing the code to not shadow global variables in <code class="language-html highlighter-rouge">let</code> bindings,
but that would severely restrict the coding style, so I chose to allocate new bindings for each lambda call.
The growing memory can be freed by implementing a mark-and-sweep garbage collection function, which is currently not supported by LambdaLisp.</p>

<h3 id="macros">Macros</h3>
<p>Macros are implemented as first-class objects in LambdaLisp.
Both macros and lambdas are subtypes of the type <code class="language-html highlighter-rouge">lambda</code>, each annotated with a subtype tag.</p>

<p>Macros are treated the same as lambdas, except for the following differences:</p>

<ul>
  <li>The arguments are taken verbatim and are not evaluated before being bound to the argument variable names.
    <ul>
      <li>In lambdas, the arguments are evaluated before being bound.</li>
    </ul>
  </li>
  <li>Two evaluations happen during a macro evaluation. The first evaluation evaluates the macro body to build the macro-expanded expression.
The expanded expression is then evaluated in the environment which the macro was called.
    <ul>
      <li>In lambdas, only one evaluation (the latter one) happens.</li>
    </ul>
  </li>
  <li>The first evaluation always has the base environment <code class="language-html highlighter-rouge">0x00000000</code> set as its parent environment
so that expansion always happens in the global environment, as explained in the previous section.
    <ul>
      <li>The second evaluation works the same as lambdas, where the environment where the macro/lambda was called is used for evaluation.</li>
    </ul>
  </li>
  <li>The environment for the bound variables are stored in the stack region (negative addresses starting from <code class="language-html highlighter-rouge">0xFFFFFFFF</code>).
    <ul>
      <li>In lambdas, they are stored in the heap region (starting from <code class="language-html highlighter-rouge">0x00000001</code>).</li>
    </ul>
  </li>
</ul>

<p>An anonymous macro can be made with the <code class="language-html highlighter-rouge">macro</code> keyword as <code class="language-html highlighter-rouge">(macro (...) ...)</code>, in the exact same syntax as lambdas.
In the <a href="https://github.com/woodrush/lambdalisp/blob/main/src/prelude.lisp">prelude</a>, <code class="language-html highlighter-rouge">defmacro</code> is defined as the following <code class="language-html highlighter-rouge">macro</code>:</p>

<div class="language-lisp highlighter-rouge"><div class="highlight"><pre class="syntax"><code><span class="c1">;; LambdaLisp</span>
<span class="p">(</span><span class="nv">defglobal</span> <span class="nb">defmacro</span> <span class="p">(</span><span class="nv">macro</span> <span class="p">(</span><span class="nv">name</span> <span class="nv">e</span> <span class="k">&amp;rest</span> <span class="nv">b</span><span class="p">)</span>
  <span class="o">`</span><span class="p">(</span><span class="nv">defglobal</span> <span class="o">,</span><span class="nv">name</span> <span class="p">(</span><span class="nv">macro</span> <span class="o">,</span><span class="nv">e</span> <span class="p">(</span><span class="k">block</span> <span class="o">,</span><span class="nv">name</span> <span class="o">,@</span><span class="nv">b</span><span class="p">)))))</span>
</code></pre></div></div>

<h3 id="object-oriented-programming">Object-Oriented Programming</h3>
<p>In <a href="https://letoverlambda.com/">Let Over Lambda</a>, it is mentioned that object-oriented programming can be implemented by using closures (<a href="https://letoverlambda.com/index.cl/guest/chap2.html#sec_1">Chapter 2</a>).
A primitive example is the counter example we’ve seen at the beginning:</p>

<div class="language-lisp highlighter-rouge"><div class="highlight"><pre class="syntax"><code><span class="p">(</span><span class="nb">defun</span> <span class="nv">new-counter</span> <span class="p">(</span><span class="nv">init</span><span class="p">)</span>
  <span class="c1">;; Return a closure.</span>
  <span class="c1">;; Use the let over lambda technique for creating independent and persistent variables.</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">i</span> <span class="nv">init</span><span class="p">))</span>
    <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span> <span class="p">(</span><span class="k">setq</span> <span class="nv">i</span> <span class="p">(</span><span class="nb">+</span> <span class="mi">1</span> <span class="nv">i</span><span class="p">)))))</span>

<span class="c1">;; Instantiate counters</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">counter1</span> <span class="p">(</span><span class="nv">new-counter</span> <span class="mi">0</span><span class="p">))</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">counter2</span> <span class="p">(</span><span class="nv">new-counter</span> <span class="mi">10</span><span class="p">))</span>

<span class="p">(</span><span class="nb">print</span> <span class="p">(</span><span class="nv">counter1</span><span class="p">))</span> <span class="c1">;; =&gt; 1</span>
<span class="p">(</span><span class="nb">print</span> <span class="p">(</span><span class="nv">counter1</span><span class="p">))</span> <span class="c1">;; =&gt; 2</span>
<span class="p">(</span><span class="nb">print</span> <span class="p">(</span><span class="nv">counter2</span><span class="p">))</span> <span class="c1">;; =&gt; 11</span>
<span class="p">(</span><span class="nb">print</span> <span class="p">(</span><span class="nv">counter1</span><span class="p">))</span> <span class="c1">;; =&gt; 3</span>
<span class="p">(</span><span class="nb">print</span> <span class="p">(</span><span class="nv">counter2</span><span class="p">))</span> <span class="c1">;; =&gt; 12</span>
<span class="p">(</span><span class="nb">print</span> <span class="p">(</span><span class="nv">counter1</span><span class="p">))</span> <span class="c1">;; =&gt; 4</span>
<span class="p">(</span><span class="nb">print</span> <span class="p">(</span><span class="nv">counter1</span><span class="p">))</span> <span class="c1">;; =&gt; 5</span>
</code></pre></div></div>

<p>LambdaLisp extends this concept and implements OOP as a predefined macro in the <a href="https://github.com/woodrush/lambdalisp/blob/main/src/prelude.lisp">prelude</a>.
LambdaLisp supports the following Python-like object system with class inheritance:</p>

<div class="language-lisp highlighter-rouge"><div class="highlight"><pre class="syntax"><code><span class="p">(</span><span class="nb">defclass</span> <span class="nv">Counter</span> <span class="p">()</span>
  <span class="p">(</span><span class="nv">i</span> <span class="mi">0</span><span class="p">)</span>

  <span class="p">(</span><span class="nb">defmethod</span> <span class="nv">inc</span> <span class="p">()</span>
    <span class="p">(</span><span class="nb">setf</span> <span class="p">(</span><span class="o">.</span> <span class="nv">self</span> <span class="nv">i</span><span class="p">)</span> <span class="p">(</span><span class="nb">+</span> <span class="mi">1</span> <span class="p">(</span><span class="o">.</span> <span class="nv">self</span> <span class="nv">i</span><span class="p">))))</span>

  <span class="p">(</span><span class="nb">defmethod</span> <span class="nv">dec</span> <span class="p">()</span>
    <span class="p">(</span><span class="nb">setf</span> <span class="p">(</span><span class="o">.</span> <span class="nv">self</span> <span class="nv">i</span><span class="p">)</span> <span class="p">(</span><span class="nb">-</span> <span class="p">(</span><span class="o">.</span> <span class="nv">self</span> <span class="nv">i</span><span class="p">)</span> <span class="mi">1</span><span class="p">))))</span>


<span class="p">(</span><span class="nb">defclass</span> <span class="nv">Counter-add</span> <span class="p">(</span><span class="nv">Counter</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">defmethod</span> <span class="nv">*init</span> <span class="p">(</span><span class="nv">i</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">setf</span> <span class="p">(</span><span class="o">.</span> <span class="nv">self</span> <span class="nv">i</span><span class="p">)</span> <span class="nv">i</span><span class="p">))</span>

  <span class="p">(</span><span class="nb">defmethod</span> <span class="nv">add</span> <span class="p">(</span><span class="nv">n</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">setf</span> <span class="p">(</span><span class="o">.</span> <span class="nv">self</span> <span class="nv">i</span><span class="p">)</span> <span class="p">(</span><span class="nb">+</span> <span class="p">(</span><span class="o">.</span> <span class="nv">self</span> <span class="nv">i</span><span class="p">)</span> <span class="nv">n</span><span class="p">))))</span>


<span class="p">(</span><span class="nb">defclass</span> <span class="nv">Counter-addsub</span> <span class="p">(</span><span class="nv">Counter-add</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">defmethod</span> <span class="nv">*init</span> <span class="p">(</span><span class="nv">c</span><span class="p">)</span>
    <span class="p">((</span><span class="o">.</span> <span class="p">(</span><span class="o">.</span> <span class="nv">self</span> <span class="nv">super</span><span class="p">)</span> <span class="nv">*init</span><span class="p">)</span> <span class="nv">c</span><span class="p">))</span>

  <span class="p">(</span><span class="nb">defmethod</span> <span class="nv">sub</span> <span class="p">(</span><span class="nv">n</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">setf</span> <span class="p">(</span><span class="o">.</span> <span class="nv">self</span> <span class="nv">i</span><span class="p">)</span> <span class="p">(</span><span class="nb">-</span> <span class="p">(</span><span class="o">.</span> <span class="nv">self</span> <span class="nv">i</span><span class="p">)</span> <span class="nv">n</span><span class="p">))))</span>


<span class="p">(</span><span class="nb">defparameter</span> <span class="nv">counter1</span> <span class="p">(</span><span class="nv">new</span> <span class="nv">Counter</span><span class="p">))</span>
<span class="p">(</span><span class="nb">defparameter</span> <span class="nv">counter2</span> <span class="p">(</span><span class="nv">new</span> <span class="nv">Counter-add</span> <span class="mi">100</span><span class="p">))</span>
<span class="p">(</span><span class="nb">defparameter</span> <span class="nv">counter3</span> <span class="p">(</span><span class="nv">new</span> <span class="nv">Counter-addsub</span> <span class="mi">10000</span><span class="p">))</span>

<span class="p">((</span><span class="o">.</span> <span class="nv">counter1</span> <span class="nv">inc</span><span class="p">))</span>
<span class="p">((</span><span class="o">.</span> <span class="nv">counter2</span> <span class="nv">add</span><span class="p">)</span> <span class="mi">100</span><span class="p">)</span>
<span class="p">((</span><span class="o">.</span> <span class="nv">counter3</span> <span class="nv">sub</span><span class="p">)</span> <span class="mi">10000</span><span class="p">)</span>

<span class="p">(</span><span class="nb">setf</span> <span class="p">(</span><span class="o">.</span> <span class="nv">counter1</span> <span class="nv">i</span><span class="p">)</span> <span class="mi">5</span><span class="p">)</span>
<span class="p">(</span><span class="nb">setf</span> <span class="p">(</span><span class="o">.</span> <span class="nv">counter2</span> <span class="nv">i</span><span class="p">)</span> <span class="mi">500</span><span class="p">)</span>
<span class="p">(</span><span class="nb">setf</span> <span class="p">(</span><span class="o">.</span> <span class="nv">counter3</span> <span class="nv">i</span><span class="p">)</span> <span class="mi">50000</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="blocks">Blocks</h3>
<p>The notion of blocks in LambdaLisp is a feature borrowed from Common Lisp, close to <code class="language-html highlighter-rouge">for</code> and <code class="language-html highlighter-rouge">break</code> in C and Java.
A <code class="language-html highlighter-rouge">block</code> creates a code block that can be escaped by running <code class="language-html highlighter-rouge">(return [value])</code> or <code class="language-html highlighter-rouge">(return-from [name] [value])</code>.</p>

<p>For example:</p>
<div class="language-lisp highlighter-rouge"><div class="highlight"><pre class="syntax"><code><span class="c1">;; LambdaLisp</span>
<span class="p">(</span><span class="k">block</span> <span class="nv">block-a</span>
  <span class="p">(</span><span class="k">if</span> <span class="nv">some-condition</span>
    <span class="p">(</span><span class="k">return-from</span> <span class="nv">block-a</span> <span class="nv">some-value</span><span class="p">))</span>
  <span class="o">...</span>
  <span class="nv">some-other-value</span><span class="p">)</span>
</code></pre></div></div>

<p>Here, when <code class="language-html highlighter-rouge">some-condition</code> is true, the <code class="language-html highlighter-rouge">return-from</code> lets the control immediately break from <code class="language-html highlighter-rouge">block-a</code>,
setting the value of the <code class="language-html highlighter-rouge">block</code> to <code class="language-html highlighter-rouge">some-value</code>.
If <code class="language-html highlighter-rouge">some-condition</code> is false, the program proceeds until the end, and the value of the <code class="language-html highlighter-rouge">block</code> becomes <code class="language-html highlighter-rouge">some-other-value</code>,
which is the same behavior as <code class="language-html highlighter-rouge">progn</code>. Nested blocks are also possible, as shown in <a href="https://github.com/woodrush/lambdalisp/blob/main/examples/block.cl">examples/block.cl</a>.</p>

<p><code class="language-html highlighter-rouge">defun</code> is defined to wrap its content with an implicit block, you can write <code class="language-html highlighter-rouge">return-from</code> statements with the function name:</p>

<div class="language-lisp highlighter-rouge"><div class="highlight"><pre class="syntax"><code><span class="c1">;; LambdaLisp</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">f</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span>
  <span class="p">(</span><span class="k">if</span> <span class="nv">some-condition</span>
    <span class="p">(</span><span class="k">return-from</span> <span class="nv">f</span> <span class="nv">some-value</span><span class="p">))</span>
  <span class="p">(</span><span class="k">if</span> <span class="nv">some-condition2</span>
    <span class="p">(</span><span class="k">return-from</span> <span class="nv">f</span> <span class="nv">some-value2</span><span class="p">)</span>
  <span class="o">...</span><span class="p">))</span>
</code></pre></div></div>

<p>Here is the definition of <code class="language-html highlighter-rouge">defun</code> in the <a href="https://github.com/woodrush/lambdalisp/blob/main/src/prelude.lisp">prelude</a>:</p>

<div class="language-lisp highlighter-rouge"><div class="highlight"><pre class="syntax"><code><span class="c1">;; LambdaLisp</span>
<span class="p">(</span><span class="nb">defmacro</span> <span class="nb">defun</span> <span class="p">(</span><span class="nv">name</span> <span class="nv">e</span> <span class="k">&amp;rest</span> <span class="nv">b</span><span class="p">)</span>
  <span class="o">`</span><span class="p">(</span><span class="nv">defglobal</span> <span class="o">,</span><span class="nv">name</span> <span class="p">(</span><span class="k">lambda</span> <span class="o">,</span><span class="nv">e</span> <span class="p">(</span><span class="k">block</span> <span class="o">,</span><span class="nv">name</span> <span class="o">,@</span><span class="nv">b</span><span class="p">))))</span>
</code></pre></div></div>

<p>In order to implement blocks, the interpreter keeps track of the name and the returning point of each block.
This is done by preparing a global variable <code class="language-html highlighter-rouge">reg-block-cont</code> in the register,
used as a stack to push and pop name-returning-point pairs.
Since LambdaCraft is written in continuation-passing style, the returning point is explicitly given as the callback function <code class="language-html highlighter-rouge">cont</code>
at any time in the <code class="language-html highlighter-rouge">eval</code> function.
Using this feature, when a <code class="language-html highlighter-rouge">block</code> form appears,
the interpreter first pushes the name and the current <code class="language-html highlighter-rouge">cont</code> to the <code class="language-html highlighter-rouge">reg-block-cont</code> global variable.
The pushed <code class="language-html highlighter-rouge">cont</code> is a continuation that expects the return value of the <code class="language-html highlighter-rouge">block</code> to be applied as its argument.
Whenever a <code class="language-html highlighter-rouge">(return-from [name] [value])</code> form is called, the interpreter searches the <code class="language-html highlighter-rouge">reg-block-cont</code> stack for the specified <code class="language-html highlighter-rouge">[name]</code>.
Since the searched <code class="language-html highlighter-rouge">cont</code> expects the return value of the <code class="language-html highlighter-rouge">block</code> to be applied,
the block escape control flow can be realized by applying <code class="language-html highlighter-rouge">[value]</code> to <code class="language-html highlighter-rouge">cont</code>, after popping the <code class="language-html highlighter-rouge">reg-block-cont</code> stack.</p>

<h3 id="loops">Loops</h3>
<p>A <code class="language-html highlighter-rouge">loop</code> is a special form equivalent to <code class="language-html highlighter-rouge">while (true)</code> in languages such as C, used to create infinite loops.
A <code class="language-html highlighter-rouge">loop</code> creates an implicit block with the name <code class="language-html highlighter-rouge">()</code>, and can be exited by running <code class="language-html highlighter-rouge">(return)</code> inside:</p>

<div class="language-lisp highlighter-rouge"><div class="highlight"><pre class="syntax"><code><span class="c1">;; LambdaLisp</span>
<span class="p">(</span><span class="nb">defparameter</span> <span class="nv">i</span> <span class="mi">0</span><span class="p">)</span>
<span class="p">(</span><span class="nb">loop</span>
  <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">=</span> <span class="nv">i</span> <span class="mi">10</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">return</span><span class="p">))</span>
  <span class="p">(</span><span class="nb">print</span> <span class="nv">i</span><span class="p">)</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">i</span> <span class="p">(</span><span class="nb">+</span> <span class="nv">i</span> <span class="mi">1</span><span class="p">)))</span>
</code></pre></div></div>

<p>Loops can also be exited by surrounding it with a <code class="language-html highlighter-rouge">block</code>:</p>

<div class="language-lisp highlighter-rouge"><div class="highlight"><pre class="syntax"><code><span class="c1">;; LambdaLisp</span>
<span class="p">(</span><span class="nb">defparameter</span> <span class="nv">i</span> <span class="mi">0</span><span class="p">)</span>
<span class="p">(</span><span class="k">block</span> <span class="nv">loop-block</span>
  <span class="p">(</span><span class="nb">loop</span>
    <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">=</span> <span class="nv">i</span> <span class="mi">10</span><span class="p">)</span>
      <span class="p">(</span><span class="k">return-from</span> <span class="nv">loop-block</span><span class="p">))</span>
    <span class="p">(</span><span class="nb">print</span> <span class="nv">i</span><span class="p">)</span>
    <span class="p">(</span><span class="k">setq</span> <span class="nv">i</span> <span class="p">(</span><span class="nb">+</span> <span class="nv">i</span> <span class="mi">1</span><span class="p">))))</span>
</code></pre></div></div>

<p>Loops are implemented by passing a self-referenced continuation that runs the contents of <code class="language-html highlighter-rouge">loop</code> again.</p>

<h3 id="error-invocation-and-stack-traces">Error Invocation and Stack Traces</h3>
<p>Some examples of situations when errors are invoked in LambdaLisp are:</p>

<ul>
  <li>In <code class="language-html highlighter-rouge">read-expr</code>:
    <ul>
      <li>When an unexpected <code class="language-html highlighter-rouge">)</code> is seen</li>
    </ul>
  </li>
  <li>In <code class="language-html highlighter-rouge">eval</code>:
    <ul>
      <li>When an unbound variable is being referenced</li>
    </ul>
  </li>
  <li>In <code class="language-html highlighter-rouge">eval-apply</code> (used when lambdas or macros are called):
    <ul>
      <li>When the value in the function cell does not belong to a subtype of <code class="language-html highlighter-rouge">lambda</code></li>
    </ul>
  </li>
</ul>

<p>When an error occurs during <code class="language-html highlighter-rouge">eval</code>, <code class="language-html highlighter-rouge">read-expr</code> or any function, the interpreter does the following:</p>

<ul>
  <li>It immediately stops what it’s doing</li>
  <li>It shows an error message</li>
  <li>It shows the function call stack trace</li>
  <li>It returns to the REPL, awaiting the user’s input</li>
</ul>

<p>Immediately stopping the current task and returning to the REPL is implemented very simply thanks to continuation-passing style.
When an error is invoked, instead of calling the continuation (the callback), the <code class="language-html highlighter-rouge">repl</code> function is called - this simple implementation allows error invocation.</p>

<p>Since invoking an error calls <code class="language-html highlighter-rouge">repl</code>,
and <code class="language-html highlighter-rouge">repl</code> calls <code class="language-html highlighter-rouge">read-expr</code>, <code class="language-html highlighter-rouge">eval</code> and <code class="language-html highlighter-rouge">eval-apply</code>,
this makes the four functions
<code class="language-html highlighter-rouge">read-expr</code>, <code class="language-html highlighter-rouge">eval</code>, <code class="language-html highlighter-rouge">eval-apply</code> and <code class="language-html highlighter-rouge">repl</code> be mutually recursive functions.
How mutually recursive functions are implemented in LambdaLisp is described later in the next section.</p>

<p>The function call stack trace is printed by managing a call stack in one of the interpreter’s global variables.
Every time a lambda or a macro is called, the interpreter pushes the expression that invoked the function call to the call stack. When the function call exits properly, the call stack is popped.
When an error is invoked during a function call, the interpreter prints the contents of the call stack.</p>

<h2 id="other-general-lambda-calculus-programming-techniques">Other General Lambda Calculus Programming Techniques</h2>
<p>Below are some other general lambda calclus programming techniques used in LambdaLisp.</p>

<h3 id="mutual-recursion">Mutual Recursion</h3>

<p>In LambdaCraft, recursive functions can be defined using <code class="language-html highlighter-rouge">defrec-lazy</code> as follows:</p>

<div class="language-lisp highlighter-rouge"><div class="highlight"><pre class="syntax"><code><span class="c1">;; LambdaCraft</span>
<span class="p">(</span><span class="nv">defrec-lazy</span> <span class="nv">fact</span> <span class="p">(</span><span class="nv">n</span><span class="p">)</span>
  <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">&lt;=</span> <span class="nv">n</span> <span class="mi">0</span><span class="p">)</span>
    <span class="mi">1</span>
    <span class="p">(</span><span class="nb">*</span> <span class="nv">n</span> <span class="p">(</span><span class="nv">fact</span> <span class="p">(</span><span class="nb">-</span> <span class="nv">n</span> <span class="mi">1</span><span class="p">)))))</span>
</code></pre></div></div>

<p><code class="language-html highlighter-rouge">defrec-lazy</code> uses the <a href="https://en.wikipedia.org/wiki/Fixed-point_combinator">Y combinator</a> to implement <a href="https://en.wikipedia.org/wiki/Anonymous_recursion">anonymous recursion</a>,
a technique used to write self-referencing functions under the absence of a named function feature.
Since LambdaLisp is based on macro expansion, when a self-referencing function is written using <code class="language-html highlighter-rouge">defun-lazy</code>,
the function body becomes infinitely expanded, causing the program to not compile.
LambdaCraft shows an error message in this case.
Using the Y combinator through <code class="language-html highlighter-rouge">defrec-lazy</code> prevents this infinite expansion from happening.</p>

<p>Things get more complex in the case of what is called mutual recursion.
In LambdaLisp, the functions <code class="language-html highlighter-rouge">read-expr</code>, <code class="language-html highlighter-rouge">eval</code>, <code class="language-html highlighter-rouge">eval-apply</code>, and <code class="language-html highlighter-rouge">repl</code> are mutually recursive,
meaning that these functions call each other inside their definitions.
Although using the normal Y combinator would still make the code compilable in this case,
it makes the same function be inlined over and over again, severely expanding the total output lambda term size.</p>

<p>The redundant inlining problem can be solved if each function held a reference to each other. This can be done by implementing a multiple-function version of the Y combinator.
The derivation of a fixed point combinator for mutual recursion is described very intuitively in
Wessel Bruinsma’s blog post, <a href="https://invenia.github.io/blog/2018/08/20/ycombinator/">A Short Note on The Y Combinator</a>,
in the section “Deriving the Y Combinator”.
Below is a summary of the derivation process introduced in this post.</p>

<p>Suppose that we have two functions <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi></mrow><annotation encoding="application/x-tex">f</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span></span></span></span> and <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi></mrow><annotation encoding="application/x-tex">g</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span></span></span></span> that are mutually recursive.
Since they reference each other in their definitions, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi></mrow><annotation encoding="application/x-tex">f</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span></span></span></span> and <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi></mrow><annotation encoding="application/x-tex">g</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span></span></span></span> can be defined in terms of some function <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>h</mi><mi>f</mi></msub></mrow><annotation encoding="application/x-tex">h_f</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9805em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span> and <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>h</mi><mi>g</mi></msub></mrow><annotation encoding="application/x-tex">h_g</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9805em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">g</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span>, which takes the definitions of <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi></mrow><annotation encoding="application/x-tex">f</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span></span></span></span> and <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi></mrow><annotation encoding="application/x-tex">g</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span></span></span></span> as its arguments:</p>

<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left right" columnspacing="0em 1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mi>f</mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>:</mo><mo>=</mo><msub><mi>h</mi><mi>f</mi></msub><mi>f</mi><mi>g</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mo stretchy="false">(</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mi>g</mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>:</mo><mo>=</mo><msub><mi>h</mi><mi>g</mi></msub><mi>f</mi><mi>g</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mo stretchy="false">(</mo><mn>2</mn><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned}
f &amp;:= h_f f g &amp; (1)\\
g &amp;:= h_g f g &amp; (2)\\
\end{aligned}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3em;vertical-align:-1.25em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.75em;"><span style="top:-3.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">g</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.25em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.75em;"><span style="top:-3.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">g</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.25em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:1em;"></span><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.75em;"><span style="top:-3.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mopen">(</span><span class="mord">1</span><span class="mclose">)</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mopen">(</span><span class="mord">2</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.25em;"><span></span></span></span></span></span></span></span></span></span></span></span>

<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>h</mi><mi>f</mi></msub></mrow><annotation encoding="application/x-tex">h_f</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9805em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span> and <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>h</mi><mi>g</mi></msub></mrow><annotation encoding="application/x-tex">h_g</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9805em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">g</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span> looks something like:</p>

<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><msub><mi>h</mi><mi>f</mi></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mi>λ</mi><msup><mi>f</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mi mathvariant="normal">.</mi><mi>λ</mi><msup><mi>g</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mi mathvariant="normal">.</mi><mi>λ</mi><mi>x</mi><mi mathvariant="normal">.</mi><msub><mi>k</mi><mi>f</mi></msub><mo stretchy="false">[</mo><msup><mi>f</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo separator="true">,</mo><msup><mi>g</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo separator="true">,</mo><mi>x</mi><mo stretchy="false">]</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><msub><mi>h</mi><mi>g</mi></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mi>λ</mi><msup><mi>f</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mi mathvariant="normal">.</mi><mi>λ</mi><msup><mi>g</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mi mathvariant="normal">.</mi><mi>λ</mi><mi>x</mi><mi mathvariant="normal">.</mi><msub><mi>k</mi><mi>g</mi></msub><mo stretchy="false">[</mo><msup><mi>f</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo separator="true">,</mo><msup><mi>g</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo separator="true">,</mo><mi>x</mi><mo stretchy="false">]</mo></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned}
h_f &amp;= \lambda f&#x27;. \lambda g&#x27;. \lambda x. k_f [f&#x27;,g&#x27;,x] \\
h_g &amp;= \lambda f&#x27;. \lambda g&#x27;. \lambda x. k_g [f&#x27;,g&#x27;,x] \\
\end{aligned}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3em;vertical-align:-1.25em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.75em;"><span style="top:-3.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">g</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.25em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.75em;"><span style="top:-3.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal">λ</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8019em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mord">.</span><span class="mord mathnormal">λ</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8019em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mord">.</span><span class="mord mathnormal">λ</span><span class="mord mathnormal">x</span><span class="mord">.</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0315em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mopen">[</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8019em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8019em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">x</span><span class="mclose">]</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal">λ</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8019em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mord">.</span><span class="mord mathnormal">λ</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8019em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mord">.</span><span class="mord mathnormal">λ</span><span class="mord mathnormal">x</span><span class="mord">.</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0315em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">g</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mopen">[</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8019em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8019em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">x</span><span class="mclose">]</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.25em;"><span></span></span></span></span></span></span></span></span></span></span></span>

<p>Where <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>k</mi><mo>∗</mo></msub><mo stretchy="false">[</mo><msup><mi>f</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo separator="true">,</mo><msup><mi>g</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo separator="true">,</mo><mi>x</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">k_* [f&#x27;,g&#x27;,x]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0019em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1757em;"><span style="top:-2.55em;margin-left:-0.0315em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">∗</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">[</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">x</span><span class="mclose">]</span></span></span></span> is a term containing <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>f</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo separator="true">,</mo><msup><mi>g</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></mrow><annotation encoding="application/x-tex">f&#x27;, g&#x27;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9463em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span> and <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span>.</p>

<p>Now suppose that <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi></mrow><annotation encoding="application/x-tex">f</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span></span></span></span> and <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi></mrow><annotation encoding="application/x-tex">g</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span></span></span></span> could be written using some unknown function <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>f</mi><mo>^</mo></mover></mrow><annotation encoding="application/x-tex">\hat f</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1523em;vertical-align:-0.1944em;"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9579em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span></span><span style="top:-3.2634em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.0833em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span></span></span></span></span></span></span></span></span> and <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>g</mi><mo>^</mo></mover></mrow><annotation encoding="application/x-tex">\hat g</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span></span></span></span></span></span></span></span></span> as:</p>

<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mi>f</mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>:</mo><mo>=</mo><mover accent="true"><mi>f</mi><mo>^</mo></mover><mover accent="true"><mi>f</mi><mo>^</mo></mover><mover accent="true"><mi>g</mi><mo>^</mo></mover></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mi>g</mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>:</mo><mo>=</mo><mover accent="true"><mi>g</mi><mo>^</mo></mover><mover accent="true"><mi>f</mi><mo>^</mo></mover><mover accent="true"><mi>g</mi><mo>^</mo></mover></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned}
f &amp;:= \hat f \hat f \hat g \\
g &amp;:= \hat g \hat f \hat g
\end{aligned}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3.2358em;vertical-align:-1.3679em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8679em;"><span style="top:-3.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span></span></span><span style="top:-2.2921em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">g</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.3679em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8679em;"><span style="top:-3.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9579em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span></span><span style="top:-3.2634em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.0833em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span></span></span></span></span></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9579em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span></span><span style="top:-3.2634em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.0833em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span></span></span></span></span></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span></span></span></span></span></span></span></span><span style="top:-2.2921em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span></span></span></span></span></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9579em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span></span><span style="top:-3.2634em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.0833em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span></span></span></span></span></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.3679em;"><span></span></span></span></span></span></span></span></span></span></span></span>

<p>Plugging this into Equations (1) and (2),</p>

<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mover accent="true"><mi>f</mi><mo>^</mo></mover><mover accent="true"><mi>f</mi><mo>^</mo></mover><mover accent="true"><mi>g</mi><mo>^</mo></mover></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><msub><mi>h</mi><mi>f</mi></msub><mo stretchy="false">(</mo><mover accent="true"><mi>f</mi><mo>^</mo></mover><mover accent="true"><mi>f</mi><mo>^</mo></mover><mover accent="true"><mi>g</mi><mo>^</mo></mover><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mover accent="true"><mi>g</mi><mo>^</mo></mover><mover accent="true"><mi>f</mi><mo>^</mo></mover><mover accent="true"><mi>g</mi><mo>^</mo></mover><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mover accent="true"><mi>g</mi><mo>^</mo></mover><mover accent="true"><mi>f</mi><mo>^</mo></mover><mover accent="true"><mi>g</mi><mo>^</mo></mover></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><msub><mi>h</mi><mi>g</mi></msub><mo stretchy="false">(</mo><mover accent="true"><mi>f</mi><mo>^</mo></mover><mover accent="true"><mi>f</mi><mo>^</mo></mover><mover accent="true"><mi>g</mi><mo>^</mo></mover><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mover accent="true"><mi>g</mi><mo>^</mo></mover><mover accent="true"><mi>f</mi><mo>^</mo></mover><mover accent="true"><mi>g</mi><mo>^</mo></mover><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned}
\hat f \hat f \hat g  &amp;= h_f (\hat f \hat f \hat g) (\hat g \hat f \hat g ) \\
\hat g \hat f \hat g  &amp;= h_g (\hat f \hat f \hat g) (\hat g \hat f \hat g ) \\
\end{aligned}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3.2358em;vertical-align:-1.3679em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8679em;"><span style="top:-3.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9579em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span></span><span style="top:-3.2634em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.0833em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span></span></span></span></span></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9579em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span></span><span style="top:-3.2634em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.0833em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span></span></span></span></span></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span></span></span></span></span></span></span></span><span style="top:-2.2921em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span></span></span></span></span></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9579em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span></span><span style="top:-3.2634em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.0833em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span></span></span></span></span></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.3679em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8679em;"><span style="top:-3.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9579em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span></span><span style="top:-3.2634em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.0833em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span></span></span></span></span></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9579em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span></span><span style="top:-3.2634em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.0833em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span></span></span></span></span></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span></span></span></span></span></span><span class="mclose">)</span><span class="mopen">(</span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span></span></span></span></span></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9579em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span></span><span style="top:-3.2634em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.0833em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span></span></span></span></span></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span></span></span></span></span></span><span class="mclose">)</span></span></span><span style="top:-2.2921em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">g</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9579em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span></span><span style="top:-3.2634em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.0833em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span></span></span></span></span></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9579em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span></span><span style="top:-3.2634em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.0833em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span></span></span></span></span></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span></span></span></span></span></span><span class="mclose">)</span><span class="mopen">(</span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span></span></span></span></span></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9579em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span></span><span style="top:-3.2634em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.0833em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span></span></span></span></span></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span></span></span></span></span></span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.3679em;"><span></span></span></span></span></span></span></span></span></span></span></span>

<p>Which can be abstracted as</p>

<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mover accent="true"><mi>f</mi><mo>^</mo></mover><mover accent="true"><mi>f</mi><mo>^</mo></mover><mover accent="true"><mi>g</mi><mo>^</mo></mover></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mo stretchy="false">(</mo><mi>λ</mi><mi>x</mi><mi mathvariant="normal">.</mi><mi>λ</mi><mi>y</mi><mi mathvariant="normal">.</mi><msub><mi>h</mi><mi>f</mi></msub><mo stretchy="false">(</mo><mi>x</mi><mi>x</mi><mi>y</mi><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mi>y</mi><mi>x</mi><mi>y</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mover accent="true"><mi>f</mi><mo>^</mo></mover><mover accent="true"><mi>g</mi><mo>^</mo></mover></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mover accent="true"><mi>g</mi><mo>^</mo></mover><mover accent="true"><mi>f</mi><mo>^</mo></mover><mover accent="true"><mi>g</mi><mo>^</mo></mover></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mo stretchy="false">(</mo><mi>λ</mi><mi>x</mi><mi mathvariant="normal">.</mi><mi>λ</mi><mi>y</mi><mi mathvariant="normal">.</mi><msub><mi>h</mi><mi>g</mi></msub><mo stretchy="false">(</mo><mi>x</mi><mi>x</mi><mi>y</mi><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mi>y</mi><mi>x</mi><mi>y</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mover accent="true"><mi>f</mi><mo>^</mo></mover><mover accent="true"><mi>g</mi><mo>^</mo></mover></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned}
\hat f \hat f \hat g  &amp;= (\lambda x. \lambda y. h_f (x x y) (y x y)) \hat f \hat g \\
\hat g \hat f \hat g  &amp;= (\lambda x. \lambda y. h_g (x x y) (y x y)) \hat f \hat g \\
\end{aligned}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3.2358em;vertical-align:-1.3679em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8679em;"><span style="top:-3.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9579em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span></span><span style="top:-3.2634em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.0833em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span></span></span></span></span></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9579em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span></span><span style="top:-3.2634em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.0833em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span></span></span></span></span></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span></span></span></span></span></span></span></span><span style="top:-2.2921em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span></span></span></span></span></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9579em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span></span><span style="top:-3.2634em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.0833em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span></span></span></span></span></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.3679em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8679em;"><span style="top:-3.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mopen">(</span><span class="mord mathnormal">λ</span><span class="mord mathnormal">x</span><span class="mord">.</span><span class="mord mathnormal">λ</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord">.</span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">xx</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord mathnormal">x</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">))</span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9579em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span></span><span style="top:-3.2634em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.0833em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span></span></span></span></span></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span></span></span></span></span></span></span></span><span style="top:-2.2921em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mopen">(</span><span class="mord mathnormal">λ</span><span class="mord mathnormal">x</span><span class="mord">.</span><span class="mord mathnormal">λ</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord">.</span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">g</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">xx</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord mathnormal">x</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">))</span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9579em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span></span><span style="top:-3.2634em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.0833em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span></span></span></span></span></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.3679em;"><span></span></span></span></span></span></span></span></span></span></span></span>

<p>Comparing both sides, we have</p>

<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mover accent="true"><mi>f</mi><mo>^</mo></mover></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mi>λ</mi><mi>x</mi><mi mathvariant="normal">.</mi><mi>λ</mi><mi>y</mi><mi mathvariant="normal">.</mi><msub><mi>h</mi><mi>f</mi></msub><mo stretchy="false">(</mo><mi>x</mi><mi>x</mi><mi>y</mi><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mi>y</mi><mi>x</mi><mi>y</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mover accent="true"><mi>g</mi><mo>^</mo></mover></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mi>λ</mi><mi>x</mi><mi mathvariant="normal">.</mi><mi>λ</mi><mi>y</mi><mi mathvariant="normal">.</mi><msub><mi>h</mi><mi>g</mi></msub><mo stretchy="false">(</mo><mi>x</mi><mi>x</mi><mi>y</mi><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mi>y</mi><mi>x</mi><mi>y</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned}
\hat f &amp;= \lambda x. \lambda y. h_f (x x y) (y x y) \\
\hat g &amp;= \lambda x. \lambda y. h_g (x x y) (y x y) \\
\end{aligned}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3.1179em;vertical-align:-1.3089em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8089em;"><span style="top:-3.8511em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9579em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span></span><span style="top:-3.2634em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.0833em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span></span></span></span></span></span></span></span><span style="top:-2.3511em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.3089em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8089em;"><span style="top:-3.8511em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal">λ</span><span class="mord mathnormal">x</span><span class="mord">.</span><span class="mord mathnormal">λ</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord">.</span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">xx</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord mathnormal">x</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span></span></span><span style="top:-2.3511em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal">λ</span><span class="mord mathnormal">x</span><span class="mord">.</span><span class="mord mathnormal">λ</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord">.</span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">g</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">xx</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord mathnormal">x</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.3089em;"><span></span></span></span></span></span></span></span></span></span></span></span>

<p>which are closed-form lambda expressions.
Plugging this into our definitions
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo>:</mo><mo>=</mo><mover accent="true"><mi>f</mi><mo>^</mo></mover><mover accent="true"><mi>f</mi><mo>^</mo></mover><mover accent="true"><mi>g</mi><mo>^</mo></mover></mrow><annotation encoding="application/x-tex">f := \hat f \hat f \hat g</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.1523em;vertical-align:-0.1944em;"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9579em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span></span><span style="top:-3.2634em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.0833em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span></span></span></span></span></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9579em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span></span><span style="top:-3.2634em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.0833em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span></span></span></span></span></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span></span></span></span></span></span></span></span></span> and <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi><mo>:</mo><mo>=</mo><mover accent="true"><mi>g</mi><mo>^</mo></mover><mover accent="true"><mi>f</mi><mo>^</mo></mover><mover accent="true"><mi>g</mi><mo>^</mo></mover></mrow><annotation encoding="application/x-tex">g := \hat g \hat f \hat g</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.1523em;vertical-align:-0.1944em;"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span></span></span></span></span></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9579em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span></span><span style="top:-3.2634em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.0833em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span></span></span></span></span></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span></span></span></span></span></span></span></span></span>,
we get the mutually recursive definitions of <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi></mrow><annotation encoding="application/x-tex">f</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span></span></span></span> and <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi></mrow><annotation encoding="application/x-tex">g</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span></span></span></span>.</p>

<p>A 4-function version of this mutual recursion setup is used in the <code class="language-html highlighter-rouge">init</code> function in LambdaLisp to define
<code class="language-html highlighter-rouge">repl</code>, <code class="language-html highlighter-rouge">eval-apply</code>, <code class="language-html highlighter-rouge">read-expr</code>, and <code class="language-html highlighter-rouge">eval</code>:</p>

<div class="language-lisp highlighter-rouge"><div class="highlight"><pre class="syntax"><code><span class="c1">;; LambdaCraft</span>
<span class="p">(</span><span class="k">let*</span> <span class="nv">read-expr-hat</span>  <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">x</span> <span class="nv">y</span> <span class="nv">z</span> <span class="nv">w</span><span class="p">)</span> <span class="p">(</span><span class="nv">def-read-expr</span>  <span class="p">(</span><span class="nv">x</span> <span class="nv">x</span> <span class="nv">y</span> <span class="nv">z</span> <span class="nv">w</span><span class="p">)</span> <span class="p">(</span><span class="nv">y</span> <span class="nv">x</span> <span class="nv">y</span> <span class="nv">z</span> <span class="nv">w</span><span class="p">)</span> <span class="p">(</span><span class="nv">z</span> <span class="nv">x</span> <span class="nv">y</span> <span class="nv">z</span> <span class="nv">w</span><span class="p">)</span> <span class="p">(</span><span class="nv">w</span> <span class="nv">x</span> <span class="nv">y</span> <span class="nv">z</span> <span class="nv">w</span><span class="p">))))</span>
<span class="p">(</span><span class="k">let*</span> <span class="nv">eval-hat</span>       <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">x</span> <span class="nv">y</span> <span class="nv">z</span> <span class="nv">w</span><span class="p">)</span> <span class="p">(</span><span class="nv">def-eval</span>       <span class="p">(</span><span class="nv">x</span> <span class="nv">x</span> <span class="nv">y</span> <span class="nv">z</span> <span class="nv">w</span><span class="p">)</span> <span class="p">(</span><span class="nv">y</span> <span class="nv">x</span> <span class="nv">y</span> <span class="nv">z</span> <span class="nv">w</span><span class="p">)</span> <span class="p">(</span><span class="nv">z</span> <span class="nv">x</span> <span class="nv">y</span> <span class="nv">z</span> <span class="nv">w</span><span class="p">)</span> <span class="p">(</span><span class="nv">w</span> <span class="nv">x</span> <span class="nv">y</span> <span class="nv">z</span> <span class="nv">w</span><span class="p">))))</span>
<span class="p">(</span><span class="k">let*</span> <span class="nv">eval-apply-hat</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">x</span> <span class="nv">y</span> <span class="nv">z</span> <span class="nv">w</span><span class="p">)</span> <span class="p">(</span><span class="nv">def-eval-apply</span> <span class="p">(</span><span class="nv">x</span> <span class="nv">x</span> <span class="nv">y</span> <span class="nv">z</span> <span class="nv">w</span><span class="p">)</span> <span class="p">(</span><span class="nv">y</span> <span class="nv">x</span> <span class="nv">y</span> <span class="nv">z</span> <span class="nv">w</span><span class="p">)</span> <span class="p">(</span><span class="nv">z</span> <span class="nv">x</span> <span class="nv">y</span> <span class="nv">z</span> <span class="nv">w</span><span class="p">)</span> <span class="p">(</span><span class="nv">w</span> <span class="nv">x</span> <span class="nv">y</span> <span class="nv">z</span> <span class="nv">w</span><span class="p">))))</span>
<span class="p">(</span><span class="k">let*</span> <span class="nv">repl-hat</span>       <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">x</span> <span class="nv">y</span> <span class="nv">z</span> <span class="nv">w</span><span class="p">)</span> <span class="p">(</span><span class="nv">def-repl</span>       <span class="p">(</span><span class="nv">x</span> <span class="nv">x</span> <span class="nv">y</span> <span class="nv">z</span> <span class="nv">w</span><span class="p">)</span> <span class="p">(</span><span class="nv">y</span> <span class="nv">x</span> <span class="nv">y</span> <span class="nv">z</span> <span class="nv">w</span><span class="p">)</span> <span class="p">(</span><span class="nv">z</span> <span class="nv">x</span> <span class="nv">y</span> <span class="nv">z</span> <span class="nv">w</span><span class="p">)</span> <span class="p">(</span><span class="nv">w</span> <span class="nv">x</span> <span class="nv">y</span> <span class="nv">z</span> <span class="nv">w</span><span class="p">))))</span>
<span class="p">(</span><span class="k">let*</span> <span class="nv">repl</span>       <span class="p">(</span><span class="nv">repl-hat</span>       <span class="nv">read-expr-hat</span> <span class="nv">eval-hat</span> <span class="nv">eval-apply-hat</span> <span class="nv">repl-hat</span><span class="p">))</span>
<span class="p">(</span><span class="k">let*</span> <span class="nv">eval-apply</span> <span class="p">(</span><span class="nv">eval-apply-hat</span> <span class="nv">read-expr-hat</span> <span class="nv">eval-hat</span> <span class="nv">eval-apply-hat</span> <span class="nv">repl-hat</span><span class="p">))</span>
<span class="p">(</span><span class="k">let*</span> <span class="nv">read-expr</span>  <span class="p">(</span><span class="nv">read-expr-hat</span>  <span class="nv">read-expr-hat</span> <span class="nv">eval-hat</span> <span class="nv">eval-apply-hat</span> <span class="nv">repl-hat</span><span class="p">))</span>
<span class="p">(</span><span class="k">let*</span> <span class="nb">eval</span>       <span class="p">(</span><span class="nv">eval-hat</span>       <span class="nv">read-expr-hat</span> <span class="nv">eval-hat</span> <span class="nv">eval-apply-hat</span> <span class="nv">repl-hat</span><span class="p">))</span>
</code></pre></div></div>

<p>The functions <code class="language-html highlighter-rouge">*-hat</code> and <code class="language-html highlighter-rouge">def-*</code>
each correspond to <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mo>∗</mo><mo>^</mo></mover></mrow><annotation encoding="application/x-tex">\hat *</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7287em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7287em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mbin">∗</span></span><span style="top:-3.0343em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.25em;"><span class="mord">^</span></span></span></span></span></span></span></span></span></span> and <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>h</mi><mo>∗</mo></msub></mrow><annotation encoding="application/x-tex">h_*</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1757em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">∗</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> in the derivation.
The final functions <code class="language-html highlighter-rouge">repl eval-apply read-expr eval</code>
are defined in terms of these auxiliary functions.</p>

<p>The functions <code class="language-html highlighter-rouge">def-*</code> are defined in a separate location.
<code class="language-html highlighter-rouge">def-eval</code>, used to define <code class="language-html highlighter-rouge">eval</code>, is defined as follows:</p>

<div class="language-lisp highlighter-rouge"><div class="highlight"><pre class="syntax"><code><span class="c1">;; LambdaCraft</span>
<span class="p">(</span><span class="nv">defun-lazy</span> <span class="nv">def-eval</span> <span class="p">(</span><span class="nv">read-expr</span> <span class="nb">eval</span> <span class="nv">eval-apply</span> <span class="nv">repl</span> <span class="nv">expr</span> <span class="nv">state</span> <span class="nv">cont</span><span class="p">)</span>
  <span class="o">...</span><span class="p">)</span>
</code></pre></div></div>

<p><code class="language-html highlighter-rouge">def-eval</code> is defined as a non-recursive function using <code class="language-html highlighter-rouge">defun-lazy</code>,
taking the four mutually dependent functions <code class="language-html highlighter-rouge">read-expr eval eval-apply repl</code> as the first four arguments,
followed by its “actual” arguments <code class="language-html highlighter-rouge">expr state cont</code>.
The first four arguments are occupied in the expression <code class="language-html highlighter-rouge">(def-read-expr (x x y z w) (y x y z w) (z x y z w) (w x y z w))</code> in the definition of <code class="language-html highlighter-rouge">read-expr-hat</code>. By currying, this lets <code class="language-html highlighter-rouge">eval</code> only take the 3 remaining unbound arguments, <code class="language-html highlighter-rouge">expr state cont</code>.</p>

<h3 id="deriving-isnil">Deriving ‘isnil’</h3>
<p><code class="language-html highlighter-rouge">isnil</code> is one of the most important functions in <code class="language-html highlighter-rouge">cons</code>-based lambda calculus programming,
bearing the importance comparable to the <code class="language-html highlighter-rouge">atom</code> special form in McCarthy’s original pure Lisp.</p>

<p>Consider the following function <code class="language-html highlighter-rouge">reverse</code> that reverses a <code class="language-html highlighter-rouge">cons</code>-based list:</p>

<div class="language-lisp highlighter-rouge"><div class="highlight"><pre class="syntax"><code><span class="c1">;; LambdaCraft</span>
<span class="p">(</span><span class="nv">defrec-lazy</span> <span class="nb">reverse</span> <span class="p">(</span><span class="nv">l</span> <span class="nv">tail</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">do</span>
    <span class="p">(</span><span class="nv">if-then-return</span> <span class="p">(</span><span class="nv">isnil</span> <span class="nv">l</span><span class="p">)</span>
      <span class="nv">tail</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">&lt;-</span> <span class="p">(</span><span class="nv">car-l</span> <span class="nv">cdr-l</span><span class="p">)</span> <span class="p">(</span><span class="nv">l</span><span class="p">))</span>
    <span class="p">(</span><span class="nb">reverse</span> <span class="nv">cdr-l</span> <span class="p">(</span><span class="nb">cons</span> <span class="nv">car-l</span> <span class="nv">tail</span><span class="p">))))</span>
</code></pre></div></div>

<p><code class="language-html highlighter-rouge">reverse</code> is a recursive function that reverses a <code class="language-html highlighter-rouge">nil</code>-terminated list made of <code class="language-html highlighter-rouge">cons</code> cells.
The base case used to end the recursion for <code class="language-html highlighter-rouge">reverse</code> is when <code class="language-html highlighter-rouge">l</code> is <code class="language-html highlighter-rouge">nil</code>,
decided by <code class="language-html highlighter-rouge">(isnil l)</code>.</p>

<p>Basically, any recursive function that takes a <code class="language-html highlighter-rouge">cons</code>-based list must check if the incoming list is either a <code class="language-html highlighter-rouge">cons</code> or a <code class="language-html highlighter-rouge">nil</code> to write its base case. However, these data types have very different definitions:</p>

<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow><mi mathvariant="normal">c</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">s</mi></mrow><mtext> </mtext><mi>A</mi><mtext> </mtext><mi>B</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>:</mo><mo>=</mo><mi>λ</mi><mi>f</mi><mi mathvariant="normal">.</mi><mo stretchy="false">(</mo><mi>f</mi><mtext> </mtext><mi>A</mi><mtext> </mtext><mi>B</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi mathvariant="normal">n</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">l</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>:</mo><mo>=</mo><mi>λ</mi><mi>x</mi><mi mathvariant="normal">.</mi><mi>λ</mi><mi>y</mi><mi mathvariant="normal">.</mi><mi>y</mi></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned}
{\rm cons} ~ A ~ B &amp;:= \lambda f. (f ~ A ~ B) \\
{\rm nil} &amp;:= \lambda x. \lambda y. y
\end{aligned}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3em;vertical-align:-1.25em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.75em;"><span style="top:-3.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathrm">cons</span></span></span><span class="mspace nobreak"> </span><span class="mord mathnormal">A</span><span class="mspace nobreak"> </span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathrm">nil</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.25em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.75em;"><span style="top:-3.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal">λ</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord">.</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mspace nobreak"> </span><span class="mord mathnormal">A</span><span class="mspace nobreak"> </span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mclose">)</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal">λ</span><span class="mord mathnormal">x</span><span class="mord">.</span><span class="mord mathnormal">λ</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord">.</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.25em;"><span></span></span></span></span></span></span></span></span></span></span></span>

<p>The function <code class="language-html highlighter-rouge">isnil</code> must return <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mi mathvariant="normal">t</mi><mi mathvariant="normal">r</mi><mi mathvariant="normal">u</mi><mi mathvariant="normal">e</mi></mrow><mo>:</mo><mo>=</mo><mi>λ</mi><mi>x</mi><mi mathvariant="normal">.</mi><mi>λ</mi><mi>y</mi><mi mathvariant="normal">.</mi><mi>x</mi></mrow><annotation encoding="application/x-tex">{\rm true} := \lambda x. \lambda y. x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">true</span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">λ</span><span class="mord mathnormal">x</span><span class="mord">.</span><span class="mord mathnormal">λ</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord">.</span><span class="mord mathnormal">x</span></span></span></span> when its argument is <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">n</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">l</mi></mrow><annotation encoding="application/x-tex">{\rm nil}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">nil</span></span></span></span></span></span>,
and return <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">n</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">l</mi></mrow><annotation encoding="application/x-tex">{\rm nil}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">nil</span></span></span></span></span></span> when the argument is any <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">c</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">s</mi></mrow><annotation encoding="application/x-tex">{\rm cons}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">cons</span></span></span></span></span></span> cell.
At first sight, it seems that this is impossible since there is no general way to check the equivalence of two given <em>general</em> lambda terms. Moreover, <code class="language-html highlighter-rouge">cons</code> cells are a <em>class</em> of lambda terms that have the form <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>λ</mi><mi>f</mi><mi mathvariant="normal">.</mi><mo stretchy="false">(</mo><mi>f</mi><mtext> </mtext><mi>A</mi><mtext> </mtext><mi>B</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\lambda f. (f ~ A ~ B)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">λ</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord">.</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mspace nobreak"> </span><span class="mord mathnormal">A</span><span class="mspace nobreak"> </span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mclose">)</span></span></span></span>.</p>

<p>While checking the equivalence of <em>general</em> lambda terms is impossible due to the halting problem (c.f. <a href="https://weblogs.asp.net/dixin/lambda-calculus-via-c-sharp-24-undecidability-of-equivalence">here</a>),
it is possible for some cases of comparing between lambdas with predefined function signatures.
This is also the case for <code class="language-html highlighter-rouge">isnil</code>, where we can derive its concrete definition as follows.</p>

<p>First observe that a <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">c</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">s</mi></mrow><annotation encoding="application/x-tex">{\rm cons}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">cons</span></span></span></span></span></span> cell is a function that takes one callback function and applies to it the two values that it holds. On the other hand, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">n</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">l</mi></mrow><annotation encoding="application/x-tex">{\rm nil}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">nil</span></span></span></span></span></span> is a function that takes two functions as its argument.
This difference makes the following sequence of applications to turn out differently for <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">c</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">s</mi></mrow><annotation encoding="application/x-tex">{\rm cons}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">cons</span></span></span></span></span></span> and <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">n</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">l</mi></mrow><annotation encoding="application/x-tex">{\rm nil}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">nil</span></span></span></span></span></span>:</p>

<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mo stretchy="false">(</mo><mrow><mi mathvariant="normal">c</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">s</mi></mrow><mtext> </mtext><mi>A</mi><mtext> </mtext><mi>B</mi><mo stretchy="false">)</mo><mtext> </mtext><mo stretchy="false">(</mo><mi>λ</mi><mi>a</mi><mi mathvariant="normal">.</mi><mi>λ</mi><mi>b</mi><mi mathvariant="normal">.</mi><mi>x</mi><mo stretchy="false">)</mo><mtext> </mtext><mi>c</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mo stretchy="false">(</mo><mi>λ</mi><mi>f</mi><mi mathvariant="normal">.</mi><mo stretchy="false">(</mo><mi>f</mi><mtext> </mtext><mi>A</mi><mtext> </mtext><mi>B</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mtext> </mtext><mo stretchy="false">(</mo><mi>λ</mi><mi>a</mi><mi mathvariant="normal">.</mi><mi>λ</mi><mi>b</mi><mi mathvariant="normal">.</mi><mi>x</mi><mo stretchy="false">)</mo><mtext> </mtext><mi>c</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mi>x</mi><mtext> </mtext><mi>c</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow><mi mathvariant="normal">n</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">l</mi></mrow><mtext> </mtext><mo stretchy="false">(</mo><mi>λ</mi><mi>a</mi><mi mathvariant="normal">.</mi><mi>λ</mi><mi>b</mi><mi mathvariant="normal">.</mi><mi>x</mi><mo stretchy="false">)</mo><mtext> </mtext><mi>c</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mo stretchy="false">(</mo><mi>λ</mi><mi>x</mi><mi mathvariant="normal">.</mi><mi>λ</mi><mi>y</mi><mi mathvariant="normal">.</mi><mi>y</mi><mo stretchy="false">)</mo><mtext> </mtext><mo stretchy="false">(</mo><mi>λ</mi><mi>a</mi><mi mathvariant="normal">.</mi><mi>λ</mi><mi>b</mi><mi mathvariant="normal">.</mi><mi>x</mi><mo stretchy="false">)</mo><mtext> </mtext><mi>c</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mi>c</mi></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned}
({\rm cons} ~ A ~ B) ~ (\lambda a. \lambda b. x) ~ c
&amp;= (\lambda f. (f ~ A ~ B)) ~ (\lambda a. \lambda b. x) ~ c \\
&amp;= x ~ c \\
{\rm nil} ~ (\lambda a. \lambda b. x) ~ c
&amp;= (\lambda x. \lambda y. y) ~ (\lambda a. \lambda b. x) ~ c  \\
&amp;= c  \\
\end{aligned}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:6em;vertical-align:-2.75em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.25em;"><span style="top:-5.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord mathrm">cons</span></span></span><span class="mspace nobreak"> </span><span class="mord mathnormal">A</span><span class="mspace nobreak"> </span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mclose">)</span><span class="mspace nobreak"> </span><span class="mopen">(</span><span class="mord mathnormal">λa</span><span class="mord">.</span><span class="mord mathnormal">λb</span><span class="mord">.</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace nobreak"> </span><span class="mord mathnormal">c</span></span></span><span style="top:-3.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathrm">nil</span></span></span><span class="mspace nobreak"> </span><span class="mopen">(</span><span class="mord mathnormal">λa</span><span class="mord">.</span><span class="mord mathnormal">λb</span><span class="mord">.</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace nobreak"> </span><span class="mord mathnormal">c</span></span></span><span style="top:-0.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.75em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.25em;"><span style="top:-5.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mopen">(</span><span class="mord mathnormal">λ</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord">.</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mspace nobreak"> </span><span class="mord mathnormal">A</span><span class="mspace nobreak"> </span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mclose">))</span><span class="mspace nobreak"> </span><span class="mopen">(</span><span class="mord mathnormal">λa</span><span class="mord">.</span><span class="mord mathnormal">λb</span><span class="mord">.</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace nobreak"> </span><span class="mord mathnormal">c</span></span></span><span style="top:-3.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal">x</span><span class="mspace nobreak"> </span><span class="mord mathnormal">c</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mopen">(</span><span class="mord mathnormal">λ</span><span class="mord mathnormal">x</span><span class="mord">.</span><span class="mord mathnormal">λ</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord">.</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span><span class="mspace nobreak"> </span><span class="mopen">(</span><span class="mord mathnormal">λa</span><span class="mord">.</span><span class="mord mathnormal">λb</span><span class="mord">.</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace nobreak"> </span><span class="mord mathnormal">c</span></span></span><span style="top:-0.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal">c</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.75em;"><span></span></span></span></span></span></span></span></span></span></span></span>

<p>Here, we applied <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>λ</mi><mi>a</mi><mi mathvariant="normal">.</mi><mi>λ</mi><mi>b</mi><mi mathvariant="normal">.</mi><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(\lambda a. \lambda b. x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">λa</span><span class="mord">.</span><span class="mord mathnormal">λb</span><span class="mord">.</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span> and <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi></mrow><annotation encoding="application/x-tex">c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">c</span></span></span></span> to <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mrow><mi mathvariant="normal">c</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">s</mi></mrow><mtext> </mtext><mi>A</mi><mtext> </mtext><mi>B</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">({\rm cons} ~ A ~ B)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord mathrm">cons</span></span></span><span class="mspace nobreak"> </span><span class="mord mathnormal">A</span><span class="mspace nobreak"> </span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mclose">)</span></span></span></span> and <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">n</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">l</mi></mrow><annotation encoding="application/x-tex">{\rm nil}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">nil</span></span></span></span></span></span>,
where <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span> and <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi></mrow><annotation encoding="application/x-tex">c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">c</span></span></span></span> are free variables.
Notice that the abstractions in <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>λ</mi><mi>a</mi><mi mathvariant="normal">.</mi><mi>λ</mi><mi>b</mi><mi mathvariant="normal">.</mi><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(\lambda a. \lambda b. x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">λa</span><span class="mord">.</span><span class="mord mathnormal">λb</span><span class="mord">.</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span> are used to ignore the values contained in the
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">c</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">s</mi></mrow><annotation encoding="application/x-tex">{\rm cons}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">cons</span></span></span></span></span></span> cell.</p>

<p>These sequences of applications can directly be used to define <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">i</mi><mi mathvariant="normal">s</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">l</mi></mrow><annotation encoding="application/x-tex">{\rm isnil}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">isnil</span></span></span></span></span></span>.
To implement <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">i</mi><mi mathvariant="normal">s</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">l</mi></mrow><annotation encoding="application/x-tex">{\rm isnil}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">isnil</span></span></span></span></span></span>, we want the latter expression to evaluate to <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">t</mi><mi mathvariant="normal">r</mi><mi mathvariant="normal">u</mi><mi mathvariant="normal">e</mi></mrow><annotation encoding="application/x-tex">{\rm true}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">true</span></span></span></span></span></span>.
This can be done by setting <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mo>:</mo><mo>=</mo><mrow><mi mathvariant="normal">t</mi><mi mathvariant="normal">r</mi><mi mathvariant="normal">u</mi><mi mathvariant="normal">e</mi></mrow></mrow><annotation encoding="application/x-tex">c := {\rm true}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">c</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">true</span></span></span></span></span></span>.</p>

<p>It then remains to find an <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span> where <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>x</mi><mtext> </mtext><mi>c</mi><mo stretchy="false">)</mo><mo>=</mo><mo stretchy="false">(</mo><mi>x</mi><mtext> </mtext><mrow><mi mathvariant="normal">t</mi><mi mathvariant="normal">r</mi><mi mathvariant="normal">u</mi><mi mathvariant="normal">e</mi></mrow><mo stretchy="false">)</mo><mo>:</mo><mo>=</mo><mrow><mi mathvariant="normal">n</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">l</mi></mrow></mrow><annotation encoding="application/x-tex">(x ~ c) = (x ~ {\rm true}) := {\rm nil}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mspace nobreak"> </span><span class="mord mathnormal">c</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mspace nobreak"> </span><span class="mord"><span class="mord"><span class="mord mathrm">true</span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">nil</span></span></span></span></span></span>.
From here we immediately get <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>:</mo><mo>=</mo><mi>λ</mi><mi>w</mi><mi mathvariant="normal">.</mi><mrow><mi mathvariant="normal">n</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">l</mi></mrow></mrow><annotation encoding="application/x-tex">x := \lambda w. {\rm nil}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">λ</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mord">.</span><span class="mord"><span class="mord"><span class="mord mathrm">nil</span></span></span></span></span></span>.</p>

<p>Therefore, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">i</mi><mi mathvariant="normal">s</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">l</mi></mrow><annotation encoding="application/x-tex">{\rm isnil}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">isnil</span></span></span></span></span></span> can be written by abstracting this process:</p>

<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi mathvariant="normal">i</mi><mi mathvariant="normal">s</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">l</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mi>λ</mi><mi>z</mi><mi mathvariant="normal">.</mi><mo stretchy="false">(</mo><mi>z</mi><mtext> </mtext><mo stretchy="false">(</mo><mi>λ</mi><mi>a</mi><mi mathvariant="normal">.</mi><mi>λ</mi><mi>b</mi><mi mathvariant="normal">.</mi><mi>λ</mi><mi>w</mi><mi mathvariant="normal">.</mi><mrow><mi mathvariant="normal">n</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">l</mi></mrow><mo stretchy="false">)</mo><mtext> </mtext><mrow><mi mathvariant="normal">t</mi><mi mathvariant="normal">r</mi><mi mathvariant="normal">u</mi><mi mathvariant="normal">e</mi></mrow><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mi>λ</mi><mi>z</mi><mi mathvariant="normal">.</mi><mo stretchy="false">(</mo><mi>z</mi><mtext> </mtext><mo stretchy="false">(</mo><mi>λ</mi><mi>a</mi><mi mathvariant="normal">.</mi><mi>λ</mi><mi>b</mi><mi mathvariant="normal">.</mi><mi>λ</mi><mi>w</mi><mi mathvariant="normal">.</mi><mi>λ</mi><mi>x</mi><mi mathvariant="normal">.</mi><mi>λ</mi><mi>y</mi><mi mathvariant="normal">.</mi><mi>y</mi><mo stretchy="false">)</mo><mtext> </mtext><mo stretchy="false">(</mo><mi>λ</mi><mi>x</mi><mi mathvariant="normal">.</mi><mi>λ</mi><mi>y</mi><mi mathvariant="normal">.</mi><mi>x</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned}
{\rm isnil}
&amp;= \lambda z. (z ~ (\lambda a. \lambda b. \lambda w. {\rm nil}) ~ {\rm true}) \\
&amp;= \lambda z. (z ~ (\lambda a. \lambda b. \lambda w. \lambda x. \lambda y. y) ~ (\lambda x. \lambda y. x)) \\
\end{aligned}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3em;vertical-align:-1.25em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.75em;"><span style="top:-3.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathrm">isnil</span></span></span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.25em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.75em;"><span style="top:-3.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal">λ</span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="mord">.</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="mspace nobreak"> </span><span class="mopen">(</span><span class="mord mathnormal">λa</span><span class="mord">.</span><span class="mord mathnormal">λb</span><span class="mord">.</span><span class="mord mathnormal">λ</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mord">.</span><span class="mord"><span class="mord"><span class="mord mathrm">nil</span></span></span><span class="mclose">)</span><span class="mspace nobreak"> </span><span class="mord"><span class="mord"><span class="mord mathrm">true</span></span></span><span class="mclose">)</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal">λ</span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="mord">.</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="mspace nobreak"> </span><span class="mopen">(</span><span class="mord mathnormal">λa</span><span class="mord">.</span><span class="mord mathnormal">λb</span><span class="mord">.</span><span class="mord mathnormal">λ</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mord">.</span><span class="mord mathnormal">λ</span><span class="mord mathnormal">x</span><span class="mord">.</span><span class="mord mathnormal">λ</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord">.</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span><span class="mspace nobreak"> </span><span class="mopen">(</span><span class="mord mathnormal">λ</span><span class="mord mathnormal">x</span><span class="mord">.</span><span class="mord mathnormal">λ</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord">.</span><span class="mord mathnormal">x</span><span class="mclose">))</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.25em;"><span></span></span></span></span></span></span></span></span></span></span></span>

<p>which can be used as</p>

<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow><mi mathvariant="normal">i</mi><mi mathvariant="normal">s</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">l</mi></mrow><mtext> </mtext><mo stretchy="false">(</mo><mrow><mi mathvariant="normal">c</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">s</mi></mrow><mtext> </mtext><mi>A</mi><mtext> </mtext><mi>B</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mrow><mi mathvariant="normal">n</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">l</mi></mrow></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow><mi mathvariant="normal">i</mi><mi mathvariant="normal">s</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">l</mi></mrow><mtext> </mtext><mrow><mi mathvariant="normal">n</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">l</mi></mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mrow><mi mathvariant="normal">t</mi><mi mathvariant="normal">r</mi><mi mathvariant="normal">u</mi><mi mathvariant="normal">e</mi></mrow></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned}
{\rm isnil} ~ ({\rm cons} ~ A ~ B) &amp;= {\rm nil} \\
{\rm isnil} ~ {\rm nil} &amp;= {\rm true}
\end{aligned}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3em;vertical-align:-1.25em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.75em;"><span style="top:-3.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathrm">isnil</span></span></span><span class="mspace nobreak"> </span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord mathrm">cons</span></span></span><span class="mspace nobreak"> </span><span class="mord mathnormal">A</span><span class="mspace nobreak"> </span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mclose">)</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathrm">isnil</span></span></span><span class="mspace nobreak"> </span><span class="mord"><span class="mord"><span class="mord mathrm">nil</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.25em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.75em;"><span style="top:-3.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">nil</span></span></span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">true</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.25em;"><span></span></span></span></span></span></span></span></span></span></span></span>

<p>The pattern <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>λ</mi><mi>a</mi><mi mathvariant="normal">.</mi><mi>λ</mi><mi>b</mi><mi mathvariant="normal">.</mi><mi>λ</mi><mi>w</mi><mi mathvariant="normal">.</mi><mi>λ</mi><mi>x</mi><mi mathvariant="normal">.</mi><mi>λ</mi><mi>y</mi><mi mathvariant="normal">.</mi><mi>y</mi></mrow><annotation encoding="application/x-tex">\lambda a. \lambda b. \lambda w. \lambda x. \lambda y. y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">λa</span><span class="mord">.</span><span class="mord mathnormal">λb</span><span class="mord">.</span><span class="mord mathnormal">λ</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mord">.</span><span class="mord mathnormal">λ</span><span class="mord mathnormal">x</span><span class="mord">.</span><span class="mord mathnormal">λ</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord">.</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span> is noticable in many places in <a href="https://woodrush.github.io/lambdalisp.pdf">lambdalisp.pdf</a>,
since <code class="language-html highlighter-rouge">isnil</code> is used a lot of times in LambdaLisp.</p>

<h3 id="lambdacrafts-do-macro">LambdaCraft’s ‘do’ Macro</h3>
<p>The heavy use of CPS in LambdaLisp is supported by LambdaCraft’s <code class="language-html highlighter-rouge">do</code> macro.
Writing raw code in CPS causes a heavily nested code, since CPS is based on callbacks.
The <code class="language-html highlighter-rouge">do</code> macro makes such nested code to be written as flat code,
in a syntax close to Haskell’s <code class="language-html highlighter-rouge">do</code> notation for monads.</p>

<p>Here is the <code class="language-html highlighter-rouge">do</code> notation in Haskell:</p>

<div class="language-haskell highlighter-rouge"><div class="highlight"><pre class="syntax"><code><span class="kr">do</span>
  <span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="n">f</span> <span class="n">x</span>
  <span class="n">w</span> <span class="o">&lt;-</span> <span class="n">g</span> <span class="n">y</span> <span class="n">z</span>
  <span class="n">return</span> <span class="n">w</span>
</code></pre></div></div>

<p>A similar code can be written in LambdaCraft as:</p>

<div class="language-lisp highlighter-rouge"><div class="highlight"><pre class="syntax"><code><span class="p">(</span><span class="nb">do</span>
  <span class="p">(</span><span class="nv">&lt;-</span> <span class="p">(</span><span class="nv">y</span> <span class="nv">z</span><span class="p">)</span> <span class="p">(</span><span class="nv">f</span> <span class="nv">x</span><span class="p">))</span>
  <span class="p">(</span><span class="nv">&lt;-</span> <span class="p">(</span><span class="nv">w</span><span class="p">)</span> <span class="p">(</span><span class="nv">g</span> <span class="nv">y</span> <span class="nv">z</span><span class="p">))</span>
  <span class="nv">w</span><span class="p">)</span>
</code></pre></div></div>

<p>which is macro-expanded to:</p>

<div class="language-lisp highlighter-rouge"><div class="highlight"><pre class="syntax"><code><span class="p">(</span><span class="nv">f</span> <span class="nv">x</span>
  <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">y</span> <span class="nv">z</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">g</span> <span class="nv">y</span> <span class="nv">z</span>
      <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">w</span><span class="p">)</span>
        <span class="nv">w</span><span class="p">))))</span>
</code></pre></div></div>

<p>where <code class="language-html highlighter-rouge">f, g</code> is defined in CPS:</p>

<div class="language-lisp highlighter-rouge"><div class="highlight"><pre class="syntax"><code><span class="p">(</span><span class="nv">defun-lazy</span> <span class="nv">f</span> <span class="p">(</span><span class="nv">x</span> <span class="nv">cont</span><span class="p">)</span> <span class="o">...</span><span class="p">)</span>
<span class="p">(</span><span class="nv">defun-lazy</span> <span class="nv">g</span> <span class="p">(</span><span class="nv">y</span> <span class="nv">z</span> <span class="nv">cont</span><span class="p">)</span> <span class="o">...</span><span class="p">)</span>
</code></pre></div></div>

<p>Here, the <code class="language-html highlighter-rouge">cont</code> represents the callback function, which is directly written as the inner <code class="language-html highlighter-rouge">lambda</code>s.</p>

<h3 id="print-debugging">Print Debugging</h3>
<p>The return type of <code class="language-html highlighter-rouge">eval</code> is <code class="language-html highlighter-rouge">string</code>, and not <code class="language-html highlighter-rouge">expr</code>.
This is because <code class="language-html highlighter-rouge">expr</code> is “returned” with CPS, by applying it to the provided callback:</p>

<div class="language-lisp highlighter-rouge"><div class="highlight"><pre class="syntax"><code><span class="c1">;; LambdaCraft</span>
<span class="p">(</span><span class="nb">eval</span> <span class="nv">expr</span> <span class="nv">state</span>
  <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">eval-result</span> <span class="nv">state</span><span class="p">)</span>
    <span class="nv">[do</span> <span class="nv">something</span> <span class="nv">with</span> <span class="nv">eval-result</span> <span class="nb">and</span> <span class="nv">state]</span><span class="p">))</span>
</code></pre></div></div>

<p>This is written using <code class="language-html highlighter-rouge">do</code> as:</p>

<div class="language-lisp highlighter-rouge"><div class="highlight"><pre class="syntax"><code><span class="p">(</span><span class="nb">do</span>
  <span class="p">(</span><span class="nv">&lt;-</span> <span class="p">(</span><span class="nv">eval-result</span> <span class="nv">state</span><span class="p">)</span> <span class="p">(</span><span class="nb">eval</span> <span class="nv">expr</span> <span class="nv">state</span><span class="p">)</span>
  <span class="nv">[do</span> <span class="nv">something</span> <span class="nv">with</span> <span class="nv">eval-result</span> <span class="nb">and</span> <span class="nv">state]</span><span class="p">))</span>
</code></pre></div></div>

<p>The nice part about the <code class="language-html highlighter-rouge">do</code> macro and having <code class="language-html highlighter-rouge">eval</code> return strings is that it makes print debugging very intuitive.
Since LambdaLisp is written in CPS, an arbitrary point in the <code class="language-html highlighter-rouge">eval</code> function eventually becomes the head of the current evaluation.
Therefore, at any point in the program, you can write</p>

<div class="language-lisp highlighter-rouge"><div class="highlight"><pre class="syntax"><code><span class="c1">;; LambdaCraft</span>
<span class="p">(</span><span class="nb">eval</span> <span class="nv">expr</span> <span class="nv">state</span>
  <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">eval-result</span> <span class="nv">state</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">cons</span> <span class="s">"a"</span> <span class="p">(</span><span class="nb">cons</span> <span class="s">"b"</span> <span class="p">(</span><span class="nb">cons</span> <span class="s">"c"</span> <span class="nv">[do</span> <span class="nv">something</span> <span class="nv">with</span> <span class="nv">eval-result</span> <span class="nb">and</span> <span class="nv">state]</span><span class="p">)))))</span>
</code></pre></div></div>

<p>which will make the entire expression eventually evaluate to</p>

<div class="language-lisp highlighter-rouge"><div class="highlight"><pre class="syntax"><code><span class="c1">;; LambdaCraft</span>
<span class="c1">;; The outermost expression</span>
<span class="p">(</span><span class="nb">cons</span> <span class="s">"a"</span> <span class="p">(</span><span class="nb">cons</span> <span class="s">"b"</span> <span class="p">(</span><span class="nb">cons</span> <span class="s">"c"</span> <span class="o">...</span><span class="p">)))</span>
</code></pre></div></div>

<p>which will print “abc” in the console.</p>

<p>The previous code can be written in imperative style using <code class="language-html highlighter-rouge">do</code> as</p>

<div class="language-lisp highlighter-rouge"><div class="highlight"><pre class="syntax"><code><span class="c1">;; LambdaCraft</span>
<span class="p">(</span><span class="nb">do</span>
  <span class="p">(</span><span class="nv">&lt;-</span> <span class="p">(</span><span class="nv">eval-result</span> <span class="nv">state</span><span class="p">)</span> <span class="p">(</span><span class="nv">expr</span> <span class="nv">state</span><span class="p">))</span>
  <span class="p">(</span><span class="nb">cons</span> <span class="s">"a"</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">cons</span> <span class="s">"b"</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">cons</span> <span class="s">"c"</span><span class="p">)</span>
  <span class="nv">[do</span> <span class="nv">something</span> <span class="nv">with</span> <span class="nv">eval-result</span> <span class="nb">and</span> <span class="nv">state]</span><span class="p">)</span>
</code></pre></div></div>

<p>which is virtually identical to writing <code class="language-html highlighter-rouge">(print "a")</code> in an imperative language.
Note that the default behavior of <code class="language-html highlighter-rouge">do</code> is to nest the successive argument at the end of the list, starting from the last argument, and <code class="language-html highlighter-rouge"><span class="nt">&lt;-</span></code> is a specially handled case by <code class="language-html highlighter-rouge">do</code>.</p>

<p><code class="language-html highlighter-rouge">(cons "a")</code> can be replaced with a string printing function that accepts a continuation, such as:</p>

<div class="language-lisp highlighter-rouge"><div class="highlight"><pre class="syntax"><code><span class="c1">;; LambdaCraft</span>
<span class="p">(</span><span class="nv">defun-lazy</span> <span class="nv">show-message</span> <span class="p">(</span><span class="nv">message</span> <span class="nv">state</span> <span class="nv">cont</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">do</span>
    <span class="p">(</span><span class="nv">print-string</span> <span class="nv">message</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">cons</span> <span class="s">"\\n"</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">cont</span> <span class="nv">state</span><span class="p">)))</span>
</code></pre></div></div>

<p>which will print <code class="language-html highlighter-rouge">message</code>, print a newline, and proceed with <code class="language-html highlighter-rouge">(cont state)</code>.</p>

<p>This design was very helpful during debugging, since it let you track the execution flow using print debugging.
This design and technique can be used in other general lambda-calculus based programs as well.</p>

<h3 id="type-checking-with-macro-call-signatures">Type Checking with Macro Call Signatures</h3>
<p>Another large-scale programming technique is using macro signatures as a type-checking functionality.</p>

<p>Since all lambdas defined by <code class="language-html highlighter-rouge">def-lazy</code>, <code class="language-html highlighter-rouge">defun-lazy</code> or <code class="language-html highlighter-rouge">defrec-lazy</code> are curried in LambdaCraft,
there is no simple way to tell how many arguments a lambda that is being called takes.
This is different for LambdaCraft <em>macros</em> defined by <code class="language-html highlighter-rouge">defmacro-lazy</code>,
since LambdaCraft macros are implemented as <em>Common Lisp</em> functions that run on the Common Lisp environment to expand the macro at compile time.
Therefore, when a LambdaCraft macro is called with excessive or insufficient number of arguments,
it causes a Common Lisp error at compile time.
This works as a strong macro signature type-checker which significantly helps the debugging process of LambdaCraft,
letting you know when a LambdaCraft macro is called with insufficient arguments.
This effectively works as a simple type checker for macro call signatures.
The Common Lisp call stack even tells you which line got the macro call wrong which helps debugging as well.
It is therefore convenient to use as much macros as possible when writing programs in LambdaCraft.</p>

<p>Writing in terms of macros help reduce the code size as well,
since using macros can be seen as running compile-time beta reductions beforehand of the runtime.
For example, while <code class="language-html highlighter-rouge">cons</code> can be written as a function <code class="language-html highlighter-rouge">(defun-lazy cons (x y) (lambda (f) (f x y)))</code>,
it can also be written as a macro <code class="language-html highlighter-rouge">(defmacro-lazy cons (x y) `(lambda (f) ,x ,y))</code>,
which is the beta-reduced form of the function-based definition.
Either code will evaluate the same results by writing <code class="language-html highlighter-rouge">(cons p q)</code>,
except the function-based one requires an extra beta-reduction step at runtime, affecting the performance.</p>

<h2 id="appendix">Appendix</h2>
<h3 id="javascript-examples-of-continuation-passing-style-code">JavaScript Examples of Continuation-Passing Style Code</h3>
<p>CPS causes the largest impact when extracting the values of a <code class="language-html highlighter-rouge">cons</code> cell.
This is illustrated in the JavaScript code below that runs on a browser’s JavaScript console.</p>

<p>In direct style, destructing a value of a <code class="language-html highlighter-rouge">cons</code> tuple is written as:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="syntax"><code><span class="c1">// Runs on the browser's JavaScript console</span>
<span class="kd">function</span> <span class="nx">car</span> <span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">x</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">a</span><span class="p">;</span> <span class="p">});</span>
<span class="p">}</span>
<span class="kd">function</span> <span class="nx">cdr</span> <span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">x</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">b</span><span class="p">;</span> <span class="p">});</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">cons</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">f</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">f</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="p">);</span>
    <span class="p">};</span>
<span class="p">}</span>
<span class="kd">function</span> <span class="nx">t</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">a</span><span class="p">;</span>
<span class="p">}</span>
<span class="kd">function</span> <span class="nx">nil</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">b</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">y</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">z</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">z</span><span class="p">(</span><span class="nx">z</span><span class="p">,</span> <span class="nx">z</span><span class="p">);</span>
        <span class="p">})(</span><span class="nx">car</span><span class="p">(</span><span class="nx">y</span><span class="p">));</span>
    <span class="p">})(</span><span class="nx">cdr</span><span class="p">(</span><span class="nx">x</span><span class="p">));</span>
<span class="p">})(</span><span class="nx">cons</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="nx">cons</span><span class="p">(</span><span class="nx">nil</span><span class="p">,</span> <span class="nx">t</span><span class="p">)))</span>
</code></pre></div></div>

<p>The last expression in this code first binds <code class="language-html highlighter-rouge">(cons t (cons nil t))</code> to <code class="language-html highlighter-rouge">x</code>, and calculates <code class="language-html highlighter-rouge">(car (cdr x))</code>.
Running this on the browser’s console should return the function <code class="language-html highlighter-rouge">nil</code>.</p>

<p>The <code class="language-html highlighter-rouge">car</code> and <code class="language-html highlighter-rouge">cdr</code> correspond to the following lambda terms that accept a data and return the data in the desired position:</p>

<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi mathvariant="normal">c</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">r</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mi>λ</mi><mi>x</mi><mi mathvariant="normal">.</mi><mi>λ</mi><mi>y</mi><mi mathvariant="normal">.</mi><mi>x</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi mathvariant="normal">c</mi><mi mathvariant="normal">d</mi><mi mathvariant="normal">r</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mi>λ</mi><mi>x</mi><mi mathvariant="normal">.</mi><mi>λ</mi><mi>y</mi><mi mathvariant="normal">.</mi><mi>y</mi></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned}
{\rm car} &amp;= \lambda x. \lambda y. x \\
{\rm cdr} &amp;= \lambda x. \lambda y. y \\
\end{aligned}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3em;vertical-align:-1.25em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.75em;"><span style="top:-3.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathrm">car</span></span></span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathrm">cdr</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.25em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.75em;"><span style="top:-3.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal">λ</span><span class="mord mathnormal">x</span><span class="mord">.</span><span class="mord mathnormal">λ</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord">.</span><span class="mord mathnormal">x</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal">λ</span><span class="mord mathnormal">x</span><span class="mord">.</span><span class="mord mathnormal">λ</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord">.</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.25em;"><span></span></span></span></span></span></span></span></span></span></span></span>

<p>On the other hand, in continuation-passing style, the same code is written as:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="syntax"><code><span class="c1">// Runs on the browser's JavaScript console</span>
<span class="kd">function</span> <span class="nx">cons</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">f</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">f</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="p">);</span>
    <span class="p">};</span>
<span class="p">}</span>
<span class="kd">function</span> <span class="nx">t</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">a</span><span class="p">;</span>
<span class="p">}</span>
<span class="kd">function</span> <span class="nx">nil</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">b</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">cons</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="nx">cons</span><span class="p">(</span><span class="nx">nil</span><span class="p">,</span> <span class="nx">t</span><span class="p">))(</span>            <span class="c1">// cons returns a function that accepts a callback function. We pass a callback to it</span>
    <span class="kd">function</span> <span class="p">(</span><span class="nx">tmp1</span><span class="p">,</span> <span class="nx">y</span><span class="p">){</span>           <span class="c1">// This function works as cdr; It takes the second value (and discards the first)</span>
        <span class="k">return</span> <span class="nx">y</span><span class="p">(</span>                 <span class="c1">// y == cons(nil, t) now. Inside, we write what we want to do with the y we receive via the callback. Here we pass another callback to the return value of the inner cons.</span>
            <span class="kd">function</span> <span class="p">(</span><span class="nx">z</span><span class="p">,</span> <span class="nx">tmp2</span><span class="p">)</span> <span class="p">{</span>  <span class="c1">// This function works as car; It takes the first value (and discards the second)</span>
                <span class="k">return</span> <span class="nx">z</span><span class="p">(</span><span class="nx">z</span><span class="p">,</span> <span class="nx">z</span><span class="p">);</span>   <span class="c1">// z == nil now. nil selects the second value among its arguments, which here evaluates to nil.</span>
            <span class="p">}</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">)</span>
</code></pre></div></div>

<p>Here, values are extracted without using <code class="language-html highlighter-rouge">car</code> or <code class="language-html highlighter-rouge">cdr</code> at all.
It instead uses the fact that a <code class="language-html highlighter-rouge">cons</code> cell is actually a <em>function</em> that accepts a callback function
that applies both of its contents to the provided callback.</p>

<p>This significantly improves performance when reading the <code class="language-html highlighter-rouge">stdin</code>, which is a list made from <code class="language-html highlighter-rouge">cons</code> cells:</p>

<div class="language-lisp highlighter-rouge"><div class="highlight"><pre class="syntax"><code><span class="c1">;; LambdaCraft</span>
<span class="p">(</span><span class="nv">stdin</span>
  <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">c</span> <span class="nv">cdr-stdin</span><span class="p">)</span>
    <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nv">=-bit</span> <span class="nv">c</span> <span class="s">"("</span><span class="p">)</span>
      <span class="o">...</span><span class="p">)))</span>
</code></pre></div></div>

<h3 id="the-binary-lambda-calculus-notation">The Binary Lambda Calculus Notation</h3>
<p>The interpreters Blc, tromp, and uni runs programs writen in <a href="https://tromp.github.io/cl/cl.html">binary lambda calculus</a> (BLC - also see <a href="https://tromp.github.io/cl/Binary_lambda_calculus.html">here</a>).
The difference between binary lambda calculus and ordinary lambda calculus is in the notation, i.e. how lambda terms are written, and everything else including the rules of beta reduction are the same. BLC’s notation is based on <a href="https://en.wikipedia.org/wiki/De_Bruijn_index">De Bruijn notation</a>, where variable names such as <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo separator="true">,</mo><mi>y</mi></mrow><annotation encoding="application/x-tex">x, y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span> and <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>z</mi></mrow><annotation encoding="application/x-tex">z</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span></span></span></span> are eliminated, and are instead replaced by an integer describing the relative nesting depth distances viewed from the variable’s surrounding scope.</p>

<p>The De Bruijn notation works as follows. Consider for example the term <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>λ</mi><mi>x</mi><mi mathvariant="normal">.</mi><mi>λ</mi><mi>y</mi><mi mathvariant="normal">.</mi><mi>λ</mi><mi>z</mi><mi mathvariant="normal">.</mi><mi>y</mi></mrow><annotation encoding="application/x-tex">\lambda x. \lambda y. \lambda z. y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">λ</span><span class="mord mathnormal">x</span><span class="mord">.</span><span class="mord mathnormal">λ</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord">.</span><span class="mord mathnormal">λ</span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="mord">.</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span>. Here, from the eyes of the term <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span>, the originating lambda of the variable <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span> is reached by hopping 1 abstraction <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>λ</mi><mi>z</mi></mrow><annotation encoding="application/x-tex">\lambda z</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">λ</span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span></span></span></span>, so the <em>De Bruijn index</em> for the term <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span> is 1. We can therefore rewrite as</p>

<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>λ</mi><mi>x</mi><mi mathvariant="normal">.</mi><mi>λ</mi><mi>y</mi><mi mathvariant="normal">.</mi><mi>λ</mi><mi>z</mi><mi mathvariant="normal">.</mi><mi>y</mi><mo>=</mo><mi>λ</mi><mi>x</mi><mi mathvariant="normal">.</mi><mi>λ</mi><mi>y</mi><mi mathvariant="normal">.</mi><mi>λ</mi><mi>z</mi><mi mathvariant="normal">.</mi><mn>1</mn></mrow><annotation encoding="application/x-tex">\lambda x. \lambda y. \lambda z. y = \lambda x. \lambda y. \lambda z. 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">λ</span><span class="mord mathnormal">x</span><span class="mord">.</span><span class="mord mathnormal">λ</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord">.</span><span class="mord mathnormal">λ</span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="mord">.</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">λ</span><span class="mord mathnormal">x</span><span class="mord">.</span><span class="mord mathnormal">λ</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord">.</span><span class="mord mathnormal">λ</span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="mord">.1</span></span></span></span></span>

<p>and still recover its meaning. Similarly, The index for <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span> in <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>λ</mi><mi>x</mi><mi mathvariant="normal">.</mi><mi>λ</mi><mi>y</mi><mi mathvariant="normal">.</mi><mi>λ</mi><mi>z</mi><mi mathvariant="normal">.</mi><mi>x</mi></mrow><annotation encoding="application/x-tex">\lambda x. \lambda y. \lambda z. x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">λ</span><span class="mord mathnormal">x</span><span class="mord">.</span><span class="mord mathnormal">λ</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord">.</span><span class="mord mathnormal">λ</span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="mord">.</span><span class="mord mathnormal">x</span></span></span></span> would be 2, and for <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>z</mi></mrow><annotation encoding="application/x-tex">z</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span></span></span></span> in <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>λ</mi><mi>x</mi><mi mathvariant="normal">.</mi><mi>λ</mi><mi>y</mi><mi mathvariant="normal">.</mi><mi>λ</mi><mi>z</mi><mi mathvariant="normal">.</mi><mi>z</mi></mrow><annotation encoding="application/x-tex">\lambda x. \lambda y. \lambda z. z</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">λ</span><span class="mord mathnormal">x</span><span class="mord">.</span><span class="mord mathnormal">λ</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord">.</span><span class="mord mathnormal">λ</span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="mord">.</span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span></span></span></span> would be 0 since no hops are required. This works for a more complicated setting, for example in <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>λ</mi><mi>x</mi><mi mathvariant="normal">.</mi><mo stretchy="false">(</mo><mi>x</mi><mi>λ</mi><mi>y</mi><mi mathvariant="normal">.</mi><mi>λ</mi><mi>z</mi><mi mathvariant="normal">.</mi><mo stretchy="false">(</mo><mo stretchy="false">(</mo><mi>x</mi><mi>z</mi><mo stretchy="false">)</mo><mi>y</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\lambda x. (x \lambda y. \lambda z.((x z) y))</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">λ</span><span class="mord mathnormal">x</span><span class="mord">.</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mord mathnormal">λ</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord">.</span><span class="mord mathnormal">λ</span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="mord">.</span><span class="mopen">((</span><span class="mord mathnormal">x</span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="mclose">)</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">))</span></span></span></span> the index for <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span> is 1.
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span> occurs twice in this term, and each are encoded differently in this case. The innermost <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span> has index 2 since 2 hops is required past <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>λ</mi><mi>z</mi></mrow><annotation encoding="application/x-tex">\lambda z</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">λ</span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span></span></span></span> and <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>λ</mi><mi>y</mi></mrow><annotation encoding="application/x-tex">\lambda y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">λ</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span>, but the outer <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span>’s index is 0 since no hops are required to reach <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>λ</mi><mi>x</mi></mrow><annotation encoding="application/x-tex">\lambda x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">λ</span><span class="mord mathnormal">x</span></span></span></span> in the eyes of the outermost <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span>. We can then write</p>

<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>λ</mi><mi>x</mi><mi mathvariant="normal">.</mi><mo stretchy="false">(</mo><mi>x</mi><mi>λ</mi><mi>y</mi><mi mathvariant="normal">.</mi><mi>λ</mi><mi>z</mi><mi mathvariant="normal">.</mi><mo stretchy="false">(</mo><mo stretchy="false">(</mo><mi>x</mi><mi>z</mi><mo stretchy="false">)</mo><mi>y</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo>=</mo><mi>λ</mi><mi>x</mi><mi mathvariant="normal">.</mi><mo stretchy="false">(</mo><mn>0</mn><mi>λ</mi><mi>y</mi><mi mathvariant="normal">.</mi><mi>λ</mi><mi>z</mi><mi mathvariant="normal">.</mi><mo stretchy="false">(</mo><mo stretchy="false">(</mo><mn>20</mn><mo stretchy="false">)</mo><mn>1</mn><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\lambda x. (x \lambda y. \lambda z.((x z) y)) = \lambda x. (0 \lambda y. \lambda z.((2 0) 1))</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">λ</span><span class="mord mathnormal">x</span><span class="mord">.</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mord mathnormal">λ</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord">.</span><span class="mord mathnormal">λ</span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="mord">.</span><span class="mopen">((</span><span class="mord mathnormal">x</span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="mclose">)</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">))</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">λ</span><span class="mord mathnormal">x</span><span class="mord">.</span><span class="mopen">(</span><span class="mord">0</span><span class="mord mathnormal">λ</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord">.</span><span class="mord mathnormal">λ</span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="mord">.</span><span class="mopen">((</span><span class="mord">20</span><span class="mclose">)</span><span class="mord">1</span><span class="mclose">))</span></span></span></span></span>

<p>and we can still deduce which variable each integer corresponds to.</p>

<p>We then notice that when written in De Bruijn indices, the variable names in the lambda declaration becomes entirely redundant. The expression can thus be rewritten as</p>

<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>λ</mi><mi>x</mi><mi mathvariant="normal">.</mi><mo stretchy="false">(</mo><mi>x</mi><mi>λ</mi><mi>y</mi><mi mathvariant="normal">.</mi><mi>λ</mi><mi>z</mi><mi mathvariant="normal">.</mi><mo stretchy="false">(</mo><mo stretchy="false">(</mo><mi>x</mi><mi>z</mi><mo stretchy="false">)</mo><mi>y</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mi>λ</mi><mi>x</mi><mi mathvariant="normal">.</mi><mo stretchy="false">(</mo><mn>0</mn><mi>λ</mi><mi>y</mi><mi mathvariant="normal">.</mi><mi>λ</mi><mi>z</mi><mi mathvariant="normal">.</mi><mo stretchy="false">(</mo><mo stretchy="false">(</mo><mn>20</mn><mo stretchy="false">)</mo><mn>1</mn><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mi>λ</mi><mo stretchy="false">(</mo><mn>0</mn><mi>λ</mi><mi>λ</mi><mo stretchy="false">(</mo><mo stretchy="false">(</mo><mn>20</mn><mo stretchy="false">)</mo><mn>1</mn><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned}
\lambda x. (x \lambda y. \lambda z.((x z) y))
&amp;= \lambda x. (0 \lambda y. \lambda z.((2 0) 1)) \\
&amp;= \lambda (0 \lambda \lambda ((2 0) 1))
\end{aligned}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3em;vertical-align:-1.25em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.75em;"><span style="top:-3.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">λ</span><span class="mord mathnormal">x</span><span class="mord">.</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mord mathnormal">λ</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord">.</span><span class="mord mathnormal">λ</span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="mord">.</span><span class="mopen">((</span><span class="mord mathnormal">x</span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="mclose">)</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">))</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.25em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.75em;"><span style="top:-3.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal">λ</span><span class="mord mathnormal">x</span><span class="mord">.</span><span class="mopen">(</span><span class="mord">0</span><span class="mord mathnormal">λ</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord">.</span><span class="mord mathnormal">λ</span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="mord">.</span><span class="mopen">((</span><span class="mord">20</span><span class="mclose">)</span><span class="mord">1</span><span class="mclose">))</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal">λ</span><span class="mopen">(</span><span class="mord">0</span><span class="mord mathnormal">λλ</span><span class="mopen">((</span><span class="mord">20</span><span class="mclose">)</span><span class="mord">1</span><span class="mclose">))</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.25em;"><span></span></span></span></span></span></span></span></span></span></span></span>

<p>and it would still hold the same meaning.</p>

<p>We can simplify the notation more by writing function application <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>A</mi><mi>B</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(A B)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mclose">)</span></span></span></span> as <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mi mathvariant="normal">a</mi><mi mathvariant="normal">p</mi><mi mathvariant="normal">p</mi><mi mathvariant="normal">l</mi><mi mathvariant="normal">y</mi></mrow><mtext> </mtext><mi>A</mi><mtext> </mtext><mi>B</mi></mrow><annotation encoding="application/x-tex">{\rm apply}~A~B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm" style="margin-right:0.01389em;">apply</span></span></span><span class="mspace nobreak"> </span><span class="mord mathnormal">A</span><span class="mspace nobreak"> </span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span></span></span></span>.
Doing this we get:</p>

<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>λ</mi><mi>x</mi><mi mathvariant="normal">.</mi><mo stretchy="false">(</mo><mi>x</mi><mi>λ</mi><mi>y</mi><mi mathvariant="normal">.</mi><mi>λ</mi><mi>z</mi><mi mathvariant="normal">.</mi><mo stretchy="false">(</mo><mo stretchy="false">(</mo><mi>x</mi><mi>z</mi><mo stretchy="false">)</mo><mi>y</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mi>λ</mi><mo stretchy="false">(</mo><mn>0</mn><mi>λ</mi><mi>λ</mi><mo stretchy="false">(</mo><mo stretchy="false">(</mo><mn>20</mn><mo stretchy="false">)</mo><mn>1</mn><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mi>λ</mi><mtext> </mtext><mrow><mi mathvariant="normal">a</mi><mi mathvariant="normal">p</mi><mi mathvariant="normal">p</mi><mi mathvariant="normal">l</mi><mi mathvariant="normal">y</mi></mrow><mtext> </mtext><mn>0</mn><mtext> </mtext><mi>λ</mi><mi>λ</mi><mtext> </mtext><mrow><mi mathvariant="normal">a</mi><mi mathvariant="normal">p</mi><mi mathvariant="normal">p</mi><mi mathvariant="normal">l</mi><mi mathvariant="normal">y</mi></mrow><mtext> </mtext><mrow><mi mathvariant="normal">a</mi><mi mathvariant="normal">p</mi><mi mathvariant="normal">p</mi><mi mathvariant="normal">l</mi><mi mathvariant="normal">y</mi></mrow><mtext> </mtext><mn>2</mn><mtext> </mtext><mn>0</mn><mtext> </mtext><mn>1</mn></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned}
\lambda x. (x \lambda y. \lambda z.((x z) y))
&amp;= \lambda (0 \lambda \lambda ((2 0) 1)) \\
&amp;= \lambda ~ {\rm apply} ~ 0 ~ \lambda \lambda ~{\rm apply} ~ {\rm apply} ~ 2 ~ 0 ~ 1
\end{aligned}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3em;vertical-align:-1.25em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.75em;"><span style="top:-3.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">λ</span><span class="mord mathnormal">x</span><span class="mord">.</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mord mathnormal">λ</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord">.</span><span class="mord mathnormal">λ</span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="mord">.</span><span class="mopen">((</span><span class="mord mathnormal">x</span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="mclose">)</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">))</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.25em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.75em;"><span style="top:-3.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal">λ</span><span class="mopen">(</span><span class="mord">0</span><span class="mord mathnormal">λλ</span><span class="mopen">((</span><span class="mord">20</span><span class="mclose">)</span><span class="mord">1</span><span class="mclose">))</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal">λ</span><span class="mspace nobreak"> </span><span class="mord"><span class="mord"><span class="mord mathrm" style="margin-right:0.01389em;">apply</span></span></span><span class="mspace nobreak"> </span><span class="mord">0</span><span class="mspace nobreak"> </span><span class="mord mathnormal">λλ</span><span class="mspace nobreak"> </span><span class="mord"><span class="mord"><span class="mord mathrm" style="margin-right:0.01389em;">apply</span></span></span><span class="mspace nobreak"> </span><span class="mord"><span class="mord"><span class="mord mathrm" style="margin-right:0.01389em;">apply</span></span></span><span class="mspace nobreak"> </span><span class="mord">2</span><span class="mspace nobreak"> </span><span class="mord">0</span><span class="mspace nobreak"> </span><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.25em;"><span></span></span></span></span></span></span></span></span></span></span></span>

<p>By assuming that <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">a</mi><mi mathvariant="normal">p</mi><mi mathvariant="normal">p</mi><mi mathvariant="normal">l</mi><mi mathvariant="normal">y</mi></mrow><annotation encoding="application/x-tex">{\rm apply}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm" style="margin-right:0.01389em;">apply</span></span></span></span></span></span> always takes exactly 2 parameters,
we can eliminate the need for writing parentheses to express <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">a</mi><mi mathvariant="normal">p</mi><mi mathvariant="normal">p</mi><mi mathvariant="normal">l</mi><mi mathvariant="normal">y</mi></mrow><annotation encoding="application/x-tex">{\rm apply}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm" style="margin-right:0.01389em;">apply</span></span></span></span></span></span>.</p>

<p>Binary lambda calculus then encodes this sequence as follows:</p>

<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mi>λ</mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mn>00</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi mathvariant="normal">a</mi><mi mathvariant="normal">p</mi><mi mathvariant="normal">p</mi><mi mathvariant="normal">l</mi><mi mathvariant="normal">y</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mn>01</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mi>i</mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><msup><mn>1</mn><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msup><mn>0</mn></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned}
\lambda &amp;= 00 \\
{\rm apply} &amp;= 01 \\
i &amp;= 1^{i+1}0 \\
\end{aligned}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:4.5347em;vertical-align:-2.0173em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.5173em;"><span style="top:-4.6773em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">λ</span></span></span><span style="top:-3.1773em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathrm" style="margin-right:0.01389em;">apply</span></span></span></span></span><span style="top:-1.6427em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.0173em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.5173em;"><span style="top:-4.6773em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">00</span></span></span><span style="top:-3.1773em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">01</span></span></span><span style="top:-1.6427em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord">1</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8747em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.0173em;"><span></span></span></span></span></span></span></span></span></span></span></span>

<p>We thus have</p>

<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>λ</mi><mi>x</mi><mi mathvariant="normal">.</mi><mo stretchy="false">(</mo><mi>x</mi><mi>λ</mi><mi>y</mi><mi mathvariant="normal">.</mi><mi>λ</mi><mi>z</mi><mi mathvariant="normal">.</mi><mo stretchy="false">(</mo><mo stretchy="false">(</mo><mi>x</mi><mi>z</mi><mo stretchy="false">)</mo><mi>y</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mi>λ</mi><mtext> </mtext><mrow><mi mathvariant="normal">a</mi><mi mathvariant="normal">p</mi><mi mathvariant="normal">p</mi><mi mathvariant="normal">l</mi><mi mathvariant="normal">y</mi></mrow><mtext> </mtext><mn>0</mn><mtext> </mtext><mi>λ</mi><mi>λ</mi><mtext> </mtext><mrow><mi mathvariant="normal">a</mi><mi mathvariant="normal">p</mi><mi mathvariant="normal">p</mi><mi mathvariant="normal">l</mi><mi mathvariant="normal">y</mi></mrow><mtext> </mtext><mrow><mi mathvariant="normal">a</mi><mi mathvariant="normal">p</mi><mi mathvariant="normal">p</mi><mi mathvariant="normal">l</mi><mi mathvariant="normal">y</mi></mrow><mtext> </mtext><mn>2</mn><mtext> </mtext><mn>0</mn><mtext> </mtext><mn>1</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mn>00</mn><mtext> </mtext><mn>01</mn><mtext> </mtext><mn>10</mn><mtext> </mtext><mn>00</mn><mtext> </mtext><mn>00</mn><mtext> </mtext><mn>01</mn><mtext> </mtext><mn>01</mn><mtext> </mtext><mn>1110</mn><mtext> </mtext><mn>10</mn><mtext> </mtext><mn>110</mn></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned}
\lambda x. (x \lambda y. \lambda z.((x z) y))
&amp;= \lambda ~ {\rm apply} ~ 0 ~ \lambda \lambda ~{\rm apply} ~ {\rm apply} ~ 2 ~ 0 ~ 1 \\
&amp;= 00~01~10~00~00~01~01~1110~10~110
\end{aligned}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3em;vertical-align:-1.25em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.75em;"><span style="top:-3.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">λ</span><span class="mord mathnormal">x</span><span class="mord">.</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mord mathnormal">λ</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord">.</span><span class="mord mathnormal">λ</span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="mord">.</span><span class="mopen">((</span><span class="mord mathnormal">x</span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="mclose">)</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">))</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.25em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.75em;"><span style="top:-3.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal">λ</span><span class="mspace nobreak"> </span><span class="mord"><span class="mord"><span class="mord mathrm" style="margin-right:0.01389em;">apply</span></span></span><span class="mspace nobreak"> </span><span class="mord">0</span><span class="mspace nobreak"> </span><span class="mord mathnormal">λλ</span><span class="mspace nobreak"> </span><span class="mord"><span class="mord"><span class="mord mathrm" style="margin-right:0.01389em;">apply</span></span></span><span class="mspace nobreak"> </span><span class="mord"><span class="mord"><span class="mord mathrm" style="margin-right:0.01389em;">apply</span></span></span><span class="mspace nobreak"> </span><span class="mord">2</span><span class="mspace nobreak"> </span><span class="mord">0</span><span class="mspace nobreak"> </span><span class="mord">1</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">00</span><span class="mspace nobreak"> </span><span class="mord">01</span><span class="mspace nobreak"> </span><span class="mord">10</span><span class="mspace nobreak"> </span><span class="mord">00</span><span class="mspace nobreak"> </span><span class="mord">00</span><span class="mspace nobreak"> </span><span class="mord">01</span><span class="mspace nobreak"> </span><span class="mord">01</span><span class="mspace nobreak"> </span><span class="mord">1110</span><span class="mspace nobreak"> </span><span class="mord">10</span><span class="mspace nobreak"> </span><span class="mord">110</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.25em;"><span></span></span></span></span></span></span></span></span></span></span></span>

<p>which completes the definition of the binary lambda calculus notation.</p>

<p>The Blc interpreter (and the Universal Lambda interpreter) accepts this bitstream and parses it to a lambda term, which then applies beta reduction to execute the program.</p>

<p>Some more examples are</p>

<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left right" columnspacing="0em 1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>λ</mi><mi>x</mi><mi mathvariant="normal">.</mi><mi>x</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mi>λ</mi><mn>0</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mo>=</mo><mn>00</mn><mtext> </mtext><mn>10</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>λ</mi><mi>x</mi><mi mathvariant="normal">.</mi><mi>λ</mi><mi>y</mi><mi mathvariant="normal">.</mi><mi>x</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mi>λ</mi><mi>λ</mi><mn>1</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mo>=</mo><mn>00</mn><mtext> </mtext><mn>00</mn><mtext> </mtext><mn>110</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mo stretchy="false">(</mo><mi>λ</mi><mi>x</mi><mi mathvariant="normal">.</mi><mi>x</mi><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mi>λ</mi><mi>x</mi><mi mathvariant="normal">.</mi><mi>x</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mrow><mi mathvariant="normal">a</mi><mi mathvariant="normal">p</mi><mi mathvariant="normal">p</mi><mi mathvariant="normal">l</mi><mi mathvariant="normal">y</mi></mrow><mtext> </mtext><mi>λ</mi><mn>0</mn><mtext> </mtext><mi>λ</mi><mn>0</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mo>=</mo><mn>01</mn><mtext> </mtext><mn>00</mn><mtext> </mtext><mn>10</mn><mtext> </mtext><mn>00</mn><mtext> </mtext><mn>10</mn></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned}
\lambda x. x
&amp;= \lambda 0
&amp;= 00~10
\\
\lambda x. \lambda y. x
&amp;= \lambda \lambda 1
&amp;= 00~00~110
\\
(\lambda x. x) (\lambda x. x)
&amp;= {\rm apply}~ \lambda 0 ~ \lambda 0
&amp;= 01~00~10~00~10
\end{aligned}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:4.5em;vertical-align:-2em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.5em;"><span style="top:-4.66em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">λ</span><span class="mord mathnormal">x</span><span class="mord">.</span><span class="mord mathnormal">x</span></span></span><span style="top:-3.16em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">λ</span><span class="mord mathnormal">x</span><span class="mord">.</span><span class="mord mathnormal">λ</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord">.</span><span class="mord mathnormal">x</span></span></span><span style="top:-1.66em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mopen">(</span><span class="mord mathnormal">λ</span><span class="mord mathnormal">x</span><span class="mord">.</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mopen">(</span><span class="mord mathnormal">λ</span><span class="mord mathnormal">x</span><span class="mord">.</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.5em;"><span style="top:-4.66em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal">λ</span><span class="mord">0</span></span></span><span style="top:-3.16em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal">λλ</span><span class="mord">1</span></span></span><span style="top:-1.66em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord"><span class="mord mathrm" style="margin-right:0.01389em;">apply</span></span></span><span class="mspace nobreak"> </span><span class="mord mathnormal">λ</span><span class="mord">0</span><span class="mspace nobreak"> </span><span class="mord mathnormal">λ</span><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:1em;"></span><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.5em;"><span style="top:-4.66em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">00</span><span class="mspace nobreak"> </span><span class="mord">10</span></span></span><span style="top:-3.16em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">00</span><span class="mspace nobreak"> </span><span class="mord">00</span><span class="mspace nobreak"> </span><span class="mord">110</span></span></span><span style="top:-1.66em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">01</span><span class="mspace nobreak"> </span><span class="mord">00</span><span class="mspace nobreak"> </span><span class="mord">10</span><span class="mspace nobreak"> </span><span class="mord">00</span><span class="mspace nobreak"> </span><span class="mord">10</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2em;"><span></span></span></span></span></span></span></span></span></span></span></span>

<p>The elegance of this notation is that it is a <a href="https://en.wikipedia.org/wiki/Prefix_code">prefix code</a>, so no delimiting characters are required - the spaces between the <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span></span></span> and <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span> can be removed in practice. Moreover, for any valid proram <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi></mrow><annotation encoding="application/x-tex">P</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span>, there exists no valid program <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mi>Q</mi></mrow><annotation encoding="application/x-tex">PQ</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">PQ</span></span></span></span> that starts with <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi></mrow><annotation encoding="application/x-tex">P</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span> followed with a nonempty <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Q</mi></mrow><annotation encoding="application/x-tex">Q</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">Q</span></span></span></span>.</p>

<p>Due to the prefix code property, the interpreter can distinguish the boundary between the program and the stdin even if they are provided as concatenated byte streams. For example, when running <code class="language-html highlighter-rouge">lambdalisp.blc</code>, we run:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="syntax"><code><span class="nb">cat </span>lambdalisp.blc | ./asc2bin <span class="o">&gt;</span> lambdalisp.blc.bin
<span class="nb">cat </span>lambdalisp.blc.bin <span class="o">[</span>filepath] | ./Blc
</code></pre></div></div>

<p>Normally, it is difficult or impossible to deduce the boundary between the binary <code class="language-html highlighter-rouge">lambdalisp.blc.bin</code> and <code class="language-html highlighter-rouge">[filepath]</code> since they are <code class="language-html highlighter-rouge">cat</code>ed together, but it is easily possible in BLC since all valid programs are prefix codes.</p>

<h2 id="about-the-logo">About the Logo</h2>

<p><a href="/blog/assets/posts/2022-09-17/lambdalisp_logo.png"><img src="/blog/assets/posts/2022-09-17/lambdalisp_logo.png" alt="LambdaLisp's logo" /></a></p>

<ul>
  <li>The rounded edges of the cube represent Lisp’s parentheses syntax.</li>
  <li>Alan Kay described Lisp in the quote, “Lisp isn’t a language, it’s a building material.”
The cube is a depiction of a block, which represents the building blocks of software.</li>
</ul>

<h2 id="credits">Credits</h2>
<p>LambdaLisp was written by Hikaru Ikuta.
The lambda calculus term compiler <a href="https://github.com/woodrush/lambdacraft">LambdaCraft</a> was written by Hikaru Ikuta,
inspired by Ben Rudiak-Gould’s Scheme program Lazier, a compiler from lambda terms written in Scheme to Lazy K.
The LambdaLisp logo was designed by Hikaru Ikuta.
The <a href="https://justine.lol/lambda/">521-byte lambda calculus interpreter</a> SectorLambda was written by Justine Tunney.
The <a href="https://www.ioccc.org/">IOCCC</a> 2012 <a href="https://www.ioccc.org/2012/tromp/hint.html">“Most functional”</a> interpreter was written by John Tromp.
The Universal Lambda interpreter <a href="https://github.com/irori/clamb">clamb</a> and Lazy K interpreter <a href="https://github.com/irori/lazyk">lazyk</a> was written by Kunihiko Sakamoto.</p>

  </div><a class="u-url" href="/blog/lambdalisp.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/blog/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Woodrush&#39;s Blog</h2>

    <div class="footer-col-wrapper">
      <!-- <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Woodrush&#39;s Blog</li></ul>
      </div> -->

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/woodrush"><svg class="svg-icon"><use xlink:href="/blog/assets/minima-social-icons.svg#github"></use></svg> <span class="username">woodrush</span></a></li><li><a href="https://www.twitter.com/woodrush924"><svg class="svg-icon"><use xlink:href="/blog/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">woodrush924</span></a></li><li><a href="https://www.linkedin.com/in/hikaru-ikuta-a2986073"><svg class="svg-icon"><use xlink:href="/blog/assets/minima-social-icons.svg#linkedin"></use></svg> <span class="username">Hikaru Ikuta</span></a></li></ul>
</div>

      <!-- <div class="footer-col footer-col-3">
        <p>A blog written by Hikaru Ikuta.</p>
      </div> -->
    </div>

  </div>

</footer>
</body>

</html>
